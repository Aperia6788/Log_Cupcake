<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ Log Cupcake</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ========== CSS ë³€ìˆ˜ (í…Œë§ˆ ì‹œìŠ¤í…œ) ========== */
        :root {
            /* ì•± UI ìƒ‰ìƒ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --app-bg: #1a1b1e;
            --panel-bg: #25262b;
            --panel-border: #373a40;
            --input-bg: #2c2e33;
            --input-border: #495057;
            --text-primary: #f1f3f5;
            --text-secondary: #adb5bd;
            --accent: #339af0;
            --accent-hover: #228be6;
            
            /* ë¡œê·¸ í”„ë¦¬ë·° ê¸°ë³¸ê°’ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --log-bg: #2c2e33;
            --log-text: #e9ecef;
            --log-width: 1000px;
            --log-radius: 16px;
            --log-font-size: 15px;
            --log-line-height: 1.7;
            
            /* ë§í’ì„  ìƒ‰ìƒ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --bubble-ai-bg: #3d4047;
            --bubble-ai-text: #e9ecef;
            --bubble-user-bg: #339af0;
            --bubble-user-text: #ffffff;
            --bubble-narration-bg: transparent;
            --bubble-narration-text: #868e96;
            
            /* ëŒ€ì‚¬/ìƒê°/í†µì‹  ìƒ‰ìƒ */
            --dialogue-color: inherit;
            --thought-color: #748ffc;
            --comm-color: #20c997;
            
            /* ì´ë¦„ ìƒ‰ìƒ */
            --name-ai-color: #495057;
            --name-user-color: #339af0;
            
            /* ì œëª© ìƒ‰ìƒ */
            --title-color: inherit;
            
            /* ê·¸ë¼ë°ì´ì…˜ */
            --log-gradient: none;
            
            /* ì™¸ê³½ í…Œë§ˆ */
            --frame-style: none;
        }
        
        /* ë¼ì´íŠ¸ëª¨ë“œ */
        body.light-mode {
            --app-bg: #edf0f2;
            --panel-bg: #f5f6f7;
            --panel-border: #d5d9dd;
            --input-bg: #e8ebee;
            --input-border: #c5ccd3;
            --text-primary: #2d3436;
            --text-secondary: #555e66;
            
            /* ë¼ì´íŠ¸ëª¨ë“œ ë¡œê·¸ ê¸°ë³¸ê°’ */
            --log-bg: #f8f9fa;
            --log-text: #2d3436;
            --bubble-ai-bg: #e9ecef;
            --bubble-ai-text: #2d3436;
        }
        
        body.light-mode .preview-wrapper {
            background-color: #e0e4e8;
            background-image: 
                linear-gradient(45deg, #d0d5da 25%, transparent 25%),
                linear-gradient(-45deg, #d0d5da 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #d0d5da 75%),
                linear-gradient(-45deg, transparent 75%, #d0d5da 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* ========== í”„ë¦¬ì…‹ í…Œë§ˆë“¤ ========== */
        /* ê¸°ë³¸ í…Œë§ˆ (ë°ì€ ë°°ê²½) */
        .theme-default {
            --log-bg: #ffffff;
            --log-text: #1d2129;
            --bubble-ai-bg: #f1f3f5;
            --bubble-ai-text: #1d2129;
            --bubble-user-bg: #339af0;
            --bubble-user-text: #ffffff;
            --thought-color: #748ffc;
            --comm-color: #20c997;
            --name-ai-color: #495057;
            --name-user-color: #339af0;
            --title-color: #1d2129;
        }
        
        .theme-ocean {
            --log-bg: #e7f5ff;
            --log-text: #1864ab;
            --bubble-ai-bg: #d0ebff;
            --bubble-ai-text: #1864ab;
            --bubble-user-bg: #228be6;
            --bubble-user-text: #ffffff;
            --thought-color: #4dabf7;
            --comm-color: #15aabf;
            --name-ai-color: #1864ab;
            --name-user-color: #228be6;
            --title-color: #1864ab;
        }
        
        .theme-forest {
            --log-bg: #ebfbee;
            --log-text: #2b8a3e;
            --bubble-ai-bg: #d3f9d8;
            --bubble-ai-text: #2b8a3e;
            --bubble-user-bg: #40c057;
            --bubble-user-text: #ffffff;
            --thought-color: #69db7c;
            --comm-color: #38d9a9;
            --name-ai-color: #2b8a3e;
            --name-user-color: #40c057;
            --title-color: #2b8a3e;
        }
        
        .theme-sunset {
            --log-bg: #fff4e6;
            --log-text: #d9480f;
            --bubble-ai-bg: #ffe8cc;
            --bubble-ai-text: #d9480f;
            --bubble-user-bg: #fd7e14;
            --bubble-user-text: #ffffff;
            --thought-color: #ffa94d;
            --comm-color: #ff922b;
            --name-ai-color: #d9480f;
            --name-user-color: #fd7e14;
            --title-color: #d9480f;
        }
        
        .theme-rose {
            --log-bg: #fff0f6;
            --log-text: #c2255c;
            --bubble-ai-bg: #ffdeeb;
            --bubble-ai-text: #c2255c;
            --bubble-user-bg: #f06595;
            --bubble-user-text: #ffffff;
            --thought-color: #f783ac;
            --comm-color: #e64980;
            --name-ai-color: #c2255c;
            --name-user-color: #f06595;
            --title-color: #c2255c;
        }
        
        .theme-lavender {
            --log-bg: #f3f0ff;
            --log-text: #5f3dc4;
            --bubble-ai-bg: #e5dbff;
            --bubble-ai-text: #5f3dc4;
            --bubble-user-bg: #7950f2;
            --bubble-user-text: #ffffff;
            --thought-color: #9775fa;
            --comm-color: #845ef7;
            --name-ai-color: #5f3dc4;
            --name-user-color: #7950f2;
            --title-color: #5f3dc4;
        }
        
        /* ë¯¸ë“œë‚˜ì‡ - ë”¥ í¼í”Œ/ë¸”ë£¨ ê³„ì—´ */
        .theme-midnight {
            --log-bg: #0f0e17;
            --log-text: #a7a9be;
            --bubble-ai-bg: #1a1825;
            --bubble-ai-text: #fffffe;
            --bubble-user-bg: #7f5af0;
            --bubble-user-text: #fffffe;
            --thought-color: #9d8cff;
            --comm-color: #2cb67d;
            --name-ai-color: #fffffe;
            --name-user-color: #7f5af0;
            --title-color: #fffffe;
        }
        
        /* ê·¸ë˜íŒŒì´íŠ¸ - ì›Œë¯¸/ë¸Œë¼ìš´ ê³„ì—´ */
        .theme-graphite {
            --log-bg: #1c1917;
            --log-text: #d6d3d1;
            --bubble-ai-bg: #292524;
            --bubble-ai-text: #fafaf9;
            --bubble-user-bg: #c2410c;
            --bubble-user-text: #ffffff;
            --thought-color: #fb923c;
            --comm-color: #4ade80;
            --name-ai-color: #fafaf9;
            --name-user-color: #fb923c;
            --title-color: #fafaf9;
        }

        /* ë””ìŠ¤ì½”ë“œ - ì‹¤ì œ ë””ìŠ¤ì½”ë“œ ìƒ‰ìƒ */
        .theme-discord {
            --log-bg: #313338;
            --log-text: #dbdee1;
            --bubble-ai-bg: #2b2d31;
            --bubble-ai-text: #f2f3f5;
            --bubble-user-bg: #5865f2;
            --bubble-user-text: #ffffff;
            --thought-color: #949ba4;
            --comm-color: #23a559;
            --name-ai-color: #f2f3f5;
            --name-user-color: #5865f2;
            --title-color: #f2f3f5;
        }

        .theme-kakao {
            --log-bg: #b2c7d9;
            --log-text: #1e1e1e;
            --bubble-ai-bg: #ffffff;
            --bubble-ai-text: #1e1e1e;
            --bubble-user-bg: #fee500;
            --bubble-user-text: #1e1e1e;
            --thought-color: #5a5a5a;
            --comm-color: #3182f6;
            --name-ai-color: #1e1e1e;
            --name-user-color: #3182f6;
            --title-color: #1e1e1e;
        }

        /* ========== ê¸°ë³¸ ë¦¬ì…‹ & ë ˆì´ì•„ì›ƒ ========== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--app-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ========== í†µí•© í—¤ë” ========== */
        .app-header {
            padding: 12px 24px;
            height: 56px;
            border-bottom: 1px solid var(--panel-border);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: var(--panel-bg);
            flex-shrink: 0;
            box-sizing: border-box;
            z-index: 100;
        }
        
        .app-header .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-header h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #a18cd1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }
        
        .app-header .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .app-header .header-actions .btn {
            padding: 8px 14px;
            font-size: 13px;
        }
        
        .app-header .header-divider {
            width: 1px;
            height: 24px;
            background: var(--panel-border);
            margin: 0 8px;
        }
        
        .app-header .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-header .preview-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* ========== ì•± ë°”ë”” (ì‚¬ì´ë“œë°” + ë©”ì¸) ========== */
        .app-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ========== ì‚¬ì´ë“œë°” (ì„¤ì • íŒ¨ë„) ========== */
        .sidebar {
            width: 40%;
            min-width: 400px;
            max-width: 600px;
            background: var(--panel-bg);
            border-right: 1px solid var(--panel-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
        }

        /* ========== ì„¹ì…˜ ìŠ¤íƒ€ì¼ ========== */
        .section {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--accent);
            border-radius: 2px;
        }

        /* ========== í…Œë§ˆ ì„ íƒ ê·¸ë¦¬ë“œ ========== */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }

        .theme-btn {
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            min-height: 50px;
        }

        .theme-btn:hover {
            transform: scale(1.05);
        }

        .theme-btn.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(51, 154, 240, 0.3);
        }

        .theme-btn span {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: rgba(0,0,0,0.7);
            background: rgba(255,255,255,0.85);
            padding: 1px 4px;
            border-radius: 3px;
            white-space: nowrap;
        }

        /* í…Œë§ˆ ë²„íŠ¼ ê°œë³„ ìƒ‰ìƒ */
        .theme-btn[data-theme="default"] { background: linear-gradient(135deg, #339af0, #748ffc); }
        .theme-btn[data-theme="ocean"] { background: linear-gradient(135deg, #228be6, #15aabf); }
        .theme-btn[data-theme="forest"] { background: linear-gradient(135deg, #40c057, #38d9a9); }
        .theme-btn[data-theme="sunset"] { background: linear-gradient(135deg, #fd7e14, #ffc078); }
        .theme-btn[data-theme="rose"] { background: linear-gradient(135deg, #f06595, #e64980); }
        .theme-btn[data-theme="lavender"] { background: linear-gradient(135deg, #7950f2, #9775fa); }
        .theme-btn[data-theme="midnight"] { background: linear-gradient(135deg, #25262b, #4c6ef5); }
        .theme-btn[data-theme="graphite"] { background: linear-gradient(135deg, #343a40, #495057); }
        .theme-btn[data-theme="discord"] { background: linear-gradient(135deg, #5865f2, #36393f); }
        .theme-btn[data-theme="kakao"] { background: linear-gradient(135deg, #fee500, #b2c7d9); }

        /* ========== ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ========== */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .input-row .input-group {
            margin-bottom: 0;
        }
        
        /* ìƒ‰ìƒ ê·¸ë¦¬ë“œ (3ì—´) */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .color-grid .color-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .color-grid .color-item label {
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .color-grid input[type="color"] {
            width: 100%;
            height: 32px;
        }
        
        .input-group {
            margin-bottom: 12px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            background: var(--panel-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            line-height: 1.6;
        }

        input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-row input[type="text"] {
            flex: 1;
        }

        /* ========== ë²„íŠ¼ ìŠ¤íƒ€ì¼ ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--input-border);
        }

        .btn-secondary:hover {
            background: var(--panel-border);
        }

        .btn-success {
            background: #40c057;
            color: white;
        }

        .btn-success:hover {
            background: #37b24d;
        }

        /* ì¶”ê°€ ìºë¦­í„° ìŠ¤íƒ€ì¼ */
        .extra-char-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: var(--input-bg);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .extra-char-item input[type="text"] {
            flex: 1;
            padding: 8px;
            background: var(--panel-bg);
            border: 1px solid var(--input-border);
            border-radius: 6px;
            color: var(--text-primary);
        }
        .extra-char-item .char-id {
            font-size: 11px;
            color: var(--text-secondary);
            min-width: 60px;
        }
        .extra-char-item .btn-color-edit {
            padding: 6px 10px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        .extra-char-item .btn-delete-char {
            padding: 6px 10px;
            background: #e03131;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .char-color-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 0;
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .char-color-popup .popup-drag-header {
            padding: 15px 20px;
            background: var(--input-bg);
            border-radius: 12px 12px 0 0;
            cursor: move;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--panel-border);
        }
        .char-color-popup .popup-drag-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 16px;
        }
        .char-color-popup .popup-drag-header .drag-hint {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.7;
        }
        .char-color-popup .popup-content {
            padding: 20px;
        }
        .char-color-popup .color-row {
            margin-bottom: 10px;
        }
        .char-color-popup .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* ========== ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ ========== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-wrapper {
            flex: 1;
            overflow: auto;
            padding: 40px;
            /* íˆ¬ëª… ì²´í¬ë³´ë“œ íŒ¨í„´ - ë‹¤í¬ëª¨ë“œ */
            background-color: #1a1b1e;
            background-image: 
                linear-gradient(45deg, #252629 25%, transparent 25%),
                linear-gradient(-45deg, #252629 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #252629 75%),
                linear-gradient(-45deg, transparent 75%, #252629 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .preview-wrapper.html-mode {
            background: var(--input-bg);
            background-image: none;
        }
        
        .html-code-view {
            display: none;
            width: 100%;
            max-width: 1000px;
            height: 100%;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary);
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-all;
            border: 1px solid var(--panel-border);
        }
        
        .preview-wrapper.html-mode .html-code-view {
            display: block;
        }
        
        .preview-wrapper.html-mode #log-preview {
            display: none;
        }
        
        .preview-toggle.active {
            background: var(--accent) !important;
            color: white !important;
        }

        /* ========== ë¡œê·¸ í”„ë¦¬ë·° ì˜ì—­ ========== */
        #log-preview {
            width: var(--log-width);
            min-height: 400px;
            background: var(--log-bg);
            color: var(--log-text);
            border-radius: var(--log-radius);
            padding: 32px;
            font-size: var(--log-font-size);
            line-height: var(--log-line-height);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05);
            position: relative;
        }
        
        /* ì™¸ê³½ í…Œë§ˆ ìŠ¤íƒ€ì¼ - ìƒ‰ìƒ ì˜í–¥ ì—†ì´ í…Œë‘ë¦¬ë§Œ */
        
        /* í¸ì§€ì§€ - ìš°ì•„í•œ ë”ë¸” í…Œë‘ë¦¬ + ê½ƒë¬´ëŠ¬ ì½”ë„ˆ */
        #log-preview.frame-letter {
            border: 3px double rgba(180, 140, 100, 0.5);
            box-shadow: 
                0 0 0 8px rgba(180, 140, 100, 0.08),
                0 0 0 12px rgba(180, 140, 100, 0.15),
                0 8px 32px rgba(0,0,0,0.12);
            position: relative;
        }
        #log-preview.frame-letter::before,
        #log-preview.frame-letter::after {
            content: 'ğŸŒ¸';
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
        }
        #log-preview.frame-letter::before { top: 12px; left: 12px; }
        #log-preview.frame-letter::after { bottom: 12px; right: 12px; content: 'ğŸŒ¼'; }
        
        /* ë‹¤ì´ì–´ë¦¬ - ê¹¨ë—í•œ ì¤„ë¬´ëŠ¬ + ìŠ¤í”„ë§ ë°”ì¸ë” */
        #log-preview.frame-diary {
            border-left: none;
            border-radius: 4px 16px 16px 4px;
            box-shadow: 
                -4px 0 0 #e8e0d5,
                -8px 0 0 #dc8a78,
                0 4px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        #log-preview.frame-diary::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, rgba(220,138,120,0.3) 10%, rgba(220,138,120,0.3) 90%, transparent);
        }
        
        /* ë©”ëª¨ì§€ - ì—¬ëŸ¬ ì¥ ìŒ“ì¸ ëŠë‚Œ */
        #log-preview.frame-memo {
            border: none;
            border-radius: 2px;
            box-shadow: 
                0 1px 1px rgba(0,0,0,0.08),
                2px 2px 0 #fff,
                3px 3px 1px rgba(0,0,0,0.06),
                5px 5px 0 #fefefe,
                6px 6px 1px rgba(0,0,0,0.04),
                8px 8px 0 #fdfdfd,
                9px 9px 1px rgba(0,0,0,0.03);
            position: relative;
        }
        #log-preview.frame-memo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 10%, 
                rgba(255,200,100,0.6) 10%, 
                rgba(255,200,100,0.6) 12%, 
                transparent 12%,
                transparent 50%,
                rgba(100,180,255,0.6) 50%,
                rgba(100,180,255,0.6) 52%,
                transparent 52%);
        }
        #log-preview.frame-memo::after {
            content: 'ğŸ“Œ';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }
        
        /* ê¸ˆë°• - ê³ ê¸‰ ì•¡ì í”„ë ˆì„ */
        #log-preview.frame-gold {
            border: none;
            box-shadow: 
                inset 0 0 0 1px rgba(212,175,55,0.5),
                inset 0 0 0 4px rgba(255,248,220,0.4),
                inset 0 0 0 5px rgba(212,175,55,0.6),
                inset 0 0 0 8px rgba(255,248,220,0.3),
                inset 0 0 0 9px rgba(184,134,11,0.5),
                0 10px 40px rgba(0,0,0,0.15);
            position: relative;
        }
        #log-preview.frame-gold::before {
            content: '';
            position: absolute;
            inset: 16px;
            border: 1px solid rgba(212,175,55,0.3);
            pointer-events: none;
        }
        #log-preview.frame-gold::after {
            content: '';
            position: absolute;
            top: 12px; left: 12px; right: 12px; bottom: 12px;
            border: 1px solid rgba(212,175,55,0.15);
            pointer-events: none;
        }
        
        /* ì¥ì‹ - ì•„ë¥´ë°ì½” ì½”ë„ˆ íŒ¨í„´ */
        #log-preview.frame-ornate {
            border: 1px solid rgba(120, 80, 200, 0.3);
            box-shadow: 
                0 0 0 6px transparent,
                0 8px 32px rgba(120, 80, 200, 0.15);
            position: relative;
        }
        #log-preview.frame-ornate::before,
        #log-preview.frame-ornate::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(120, 80, 200, 0.4);
        }
        #log-preview.frame-ornate::before {
            top: 8px; left: 8px;
            border-right: none; border-bottom: none;
            border-radius: 8px 0 0 0;
        }
        #log-preview.frame-ornate::after {
            bottom: 8px; right: 8px;
            border-left: none; border-top: none;
            border-radius: 0 0 8px 0;
        }
        
        /* ì²´í¬ë¬´ëŠ¬ - ë§ˆë¦„ëª¨ */
        #log-preview.frame-check {
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
        }
        #log-preview.frame-check::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.02) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.02) 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            border-radius: inherit;
            pointer-events: none;
        }
        
        /* í…Œì´í”„ - ê·€ì—¬ìš´ ë§ˆìŠ¤í‚¤ í…Œì´í”„ */
        #log-preview.frame-tape {
            position: relative;
            box-shadow: 0 6px 24px rgba(0,0,0,0.1);
        }
        #log-preview.frame-tape::before,
        #log-preview.frame-tape::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 24px;
            background: linear-gradient(135deg, rgba(255,220,180,0.9), rgba(255,235,200,0.9));
            border: 1px dashed rgba(180,140,100,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #log-preview.frame-tape::before {
            top: -12px; left: 20px;
            transform: rotate(-3deg);
        }
        #log-preview.frame-tape::after {
            bottom: -12px; right: 20px;
            transform: rotate(2deg);
        }
        
        /* ë¹ˆí‹°ì§€ - ì–‘í”¼ì§€ ë¬¼ê²°ì¹˜ëŠ” í…Œë‘ë¦¬ */
        #log-preview.frame-vintage {
            border: none;
            box-shadow: 
                inset 0 0 60px rgba(120,90,60,0.06),
                0 4px 20px rgba(60,40,20,0.15);
            position: relative;
            overflow: visible;
        }
        
        /* ë¹ˆí‹°ì§€ í”„ë ˆì„ - ë¬¼ê²°ì¹˜ëŠ” ì™¸ê³½ì„  */
        #log-preview.frame-vintage::before {
            content: '';
            position: absolute;
            inset: -10px;
            border: 6px solid rgba(100,75,50,0.6);
            border-radius: 8px;
            filter: url(#wavy-filter);
            pointer-events: none;
        }
        
        #log-preview.frame-vintage::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            box-shadow: inset 0 0 30px rgba(120,90,60,0.08);
            pointer-events: none;
        }
        
        /* ë¹ˆí‹°ì§€ í”„ë ˆì„ - êµ¬ë¶„ì„  ë¬¼ê²° íš¨ê³¼ */
        #log-preview.frame-vintage .divider {
            border: none;
            height: 4px;
            background: rgba(100,75,50,0.5);
            filter: url(#wavy-filter-small);
        }
        
        /* ë¹ˆí‹°ì§€ í”„ë ˆì„ - ì  êµ¬ë¶„ì„  ë¬¼ê²° íš¨ê³¼ */
        #log-preview.frame-vintage .dot-divider::before {
            display: inline-block;
            filter: url(#wavy-filter-small);
        }
        
        /* ë¹ˆí‹°ì§€ í”„ë ˆì„ - ë‚˜ë ˆì´ì…˜ ìœ„ì•„ë˜ ì„  ë¬¼ê²° íš¨ê³¼ */
        #log-preview.frame-vintage .chat-block + .narration::before,
        #log-preview.frame-vintage .narration:has(+ .chat-block)::after {
            width: 60px;
            height: 2px;
            background: rgba(139,115,85,0.35);
            filter: url(#wavy-filter-small);
        }
        
        /* ===== ë¹ˆí‹°ì§€ í”„ë ˆì„ - ë§í’ì„  ë¬¼ê²° íš¨ê³¼ (JSë¡œ .vintage-bubble-bg ìš”ì†Œ ì¶”ê°€ í•„ìš”) ===== */
        /* ë§í’ì„  ì»¨í…Œì´ë„ˆ - ë°°ê²½ë§Œ íˆ¬ëª…, í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ ìœ ì§€ */
        #log-preview.frame-vintage .bubble {
            position: relative;
            z-index: 1;
        }
        
        /* ë¹ˆí‹°ì§€ì—ì„œ ì¼ë°˜ ë§í’ì„  ë°°ê²½ ìˆ¨ê¸°ê¸° (vintage-bubble-bgê°€ ëŒ€ì‹  í‘œì‹œ) */
        #log-preview.frame-vintage .bubble:not(.thought):not(.comm) {
            background: transparent !important;
        }
        
        /* ë§í’ì„  ë¬¼ê²° ë°°ê²½ (JSì—ì„œ ì¶”ê°€ë˜ëŠ” ìš”ì†Œ) */
        #log-preview.frame-vintage .bubble .vintage-bubble-bg {
            position: absolute;
            inset: 0;
            border-radius: inherit;
            filter: url(#wavy-filter-bubble);
            z-index: -1;
            pointer-events: none;
        }
        
        /* AI ë§í’ì„  ë°°ê²½ */
        #log-preview.frame-vintage .chat-block.ai .bubble:not(.thought):not(.comm) .vintage-bubble-bg {
            background: var(--bubble-ai-bg);
        }
        
        /* USER ë§í’ì„  ë°°ê²½ */
        #log-preview.frame-vintage .chat-block.user .bubble:not(.thought):not(.comm) .vintage-bubble-bg {
            background: var(--bubble-user-bg);
        }
        
        /* ìƒê° ë§í’ì„  - íˆ¬ëª… ë°°ê²½ + ë¬¼ê²° í…Œë‘ë¦¬ */
        #log-preview.frame-vintage .bubble.thought {
            background: transparent !important;
            border: none !important;
        }
        #log-preview.frame-vintage .bubble.thought .vintage-bubble-bg {
            background: transparent;
            border: 3px dashed var(--thought-color);
        }
        
        /* í†µì‹  ë§í’ì„  - íˆ¬ëª… ë°°ê²½ + ë¬¼ê²° í…Œë‘ë¦¬ */
        #log-preview.frame-vintage .bubble.comm {
            background: transparent !important;
            border: none !important;
        }
        #log-preview.frame-vintage .bubble.comm .vintage-bubble-bg {
            background: transparent;
            border: 3px solid var(--comm-color);
        }
        
        /* ì†ì‚­ì„ ë§í’ì„  ë°°ê²½ */
        #log-preview.frame-vintage .chat-block.ai .bubble.whisper .vintage-bubble-bg {
            background: var(--bubble-ai-bg);
            opacity: 0.7;
        }
        #log-preview.frame-vintage .chat-block.user .bubble.whisper .vintage-bubble-bg {
            background: var(--bubble-user-bg);
            opacity: 0.7;
        }
        
        /* í´ë¼ë¡œì´ë“œ - ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ */
        #log-preview.frame-polaroid {
            padding-bottom: 48px !important;
            border: 1px solid rgba(0,0,0,0.08);
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.06),
                0 8px 24px rgba(0,0,0,0.1),
                0 16px 48px rgba(0,0,0,0.06);
            position: relative;
        }
        #log-preview.frame-polaroid::after {
            content: 'â™¡';
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: rgba(200,100,100,0.4);
        }
        
        /* ========== ì™¸ê³½ ì¥ì‹ (ë™ì  ì¶”ê°€) ========== */
        .frame-decoration {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }
        
        /* í¸ì§€ì§€ - ê½ƒ ì¥ì‹ */
        .frame-deco-letter {
            font-size: 18px;
            opacity: 0.7;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }
        
        /* ë‹¤ì´ì–´ë¦¬ - í¬ìŠ¤íŠ¸ì‡ */
        .frame-deco-diary {
            padding: 6px 10px;
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            border-radius: 2px;
            font-size: 11px;
            font-weight: 600;
            color: #5d4037;
            box-shadow: 1px 2px 4px rgba(0,0,0,0.15);
            white-space: nowrap;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .frame-deco-diary.pink { background: linear-gradient(135deg, #fce4ec, #f8bbd9); }
        .frame-deco-diary.blue { background: linear-gradient(135deg, #e3f2fd, #bbdefb); }
        .frame-deco-diary.green { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); }
        
        /* ì¥ì‹ í”„ë ˆì„ - ë³´ì„ */
        .frame-deco-ornate {
            font-size: 14px;
            opacity: 0.6;
            filter: drop-shadow(0 1px 2px rgba(120,80,200,0.3));
        }
        
        /* í…Œì´í”„ ì™¸ê³½ ì¥ì‹ */
        .frame-deco-tape {
            background: linear-gradient(135deg, rgba(255,220,180,0.9), rgba(255,235,200,0.9));
            border: 1px dashed rgba(180,140,100,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .frame-deco-tape.color1 { background: linear-gradient(135deg, rgba(255,200,200,0.85), rgba(255,220,220,0.85)); }
        .frame-deco-tape.color2 { background: linear-gradient(135deg, rgba(200,230,255,0.85), rgba(220,240,255,0.85)); }
        .frame-deco-tape.color3 { background: linear-gradient(135deg, rgba(200,255,200,0.85), rgba(220,255,220,0.85)); }
        
        /* í´ë¼ë¡œì´ë“œ ì™¸ê³½ ì¥ì‹ */
        .frame-deco-polaroid {
            color: rgba(200,100,100,0.4);
            font-size: 16px;
        }
        
        /* í´ë¼ë¡œì´ë“œ ì¤‘ê°„ ì‹¬ë³¼ */
        .polaroid-symbol {
            text-align: center;
            color: rgba(200,100,100,0.35);
            font-size: 14px;
            margin: 8px 0;
            letter-spacing: 4px;
        }
        
        /* ë¡œê·¸ ì›Œí„°ë§ˆí¬ */
        .log-watermark {
            text-align: center;
            padding: 20px 0 8px 0;
            margin-top: 24px;
            border-top: 1px solid rgba(128,128,128,0.15);
        }
        
        .log-watermark span {
            font-size: 11px;
            font-weight: 500;
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #a18cd1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0.7;
            letter-spacing: 0.5px;
        }

        /* ========== ë§ˆí¬ë‹¤ìš´ ê°•ì¡° ========== */ */
        .md-bold {
            font-weight: 700;
        }
        
        .md-italic {
            font-style: italic;
        }
        
        .md-highlight {
            background: linear-gradient(120deg, #ffd54f 0%, #ffeb3b 100%);
            padding: 0 4px;
            border-radius: 3px;
            color: #1d2129;
        }
        
        .md-emphasis {
            color: #e03131;
            font-weight: 600;
        }
        
        .md-underline {
            text-decoration: underline;
            text-decoration-color: currentColor;
            text-underline-offset: 2px;
        }
        
        .md-strike {
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        /* ========== ë§í’ì„  ì¶”ê°€ ìŠ¤íƒ€ì¼ ========== */
        .bubble.whisper {
            background: rgba(0,0,0,0.05) !important;
            color: var(--log-text) !important;
            font-size: 0.9em;
            opacity: 0.7;
        }
        
        .bubble.shout {
            font-weight: 700;
            font-size: 1.1em;
        }

        /* ========== ë¡œê·¸ ì œëª© ========== */
        .log-title {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--title-color);
        }

        .log-title h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--title-color);
        }

        .log-title p {
            font-size: 14px;
            opacity: 0.7;
            color: var(--title-color);
        }

        .log-meta {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            font-size: 12px;
        }

        .log-meta-item {
            background: rgba(0,0,0,0.05);
            padding: 4px 10px;
            border-radius: 12px;
            color: var(--log-text);
            opacity: 0.8;
        }

        .log-meta-item a {
            color: inherit;
            text-decoration: underline;
        }

        /* ========== ì‚½ì…ëœ ì´ë¯¸ì§€ ========== */
        .log-image {
            margin: 16px 0;
            text-align: center;
        }

        .log-image img {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ========== ëŒ€í™” ë¸”ë¡ ========== */
        .chat-block {
            margin-bottom: 12px;
        }

        .chat-block:last-child {
            margin-bottom: 0;
        }

        /* í™”ì ì´ë¦„ */
        .speaker-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .chat-block.ai .speaker-name {
            color: var(--name-ai-color);
        }

        .chat-block.user .speaker-name {
            color: var(--name-user-color);
            text-align: right;
        }

        /* ë§í’ì„  ì»¨í…Œì´ë„ˆ */
        .bubbles {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .chat-block.user .bubbles {
            align-items: flex-end;
        }

        .chat-block.ai .bubbles {
            align-items: flex-start;
        }

        /* ê°œë³„ ë§í’ì„  */
        .bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            word-break: break-word;
            white-space: pre-wrap;
        }

        /* AI ë§í’ì„  */
        .chat-block.ai .bubble {
            background: var(--bubble-ai-bg);
            color: var(--bubble-ai-text);
            border-bottom-left-radius: 6px;
        }

        /* USER ë§í’ì„  */
        .chat-block.user .bubble {
            background: var(--bubble-user-bg);
            color: var(--bubble-user-text);
            border-bottom-right-radius: 6px;
        }

        /* ëŒ€ì‚¬ ë§í’ì„  (ê¸°ë³¸) */
        .bubble.dialogue {
            /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            display: block;
        }

        /* ìƒê° ë§í’ì„  */
        .bubble.thought {
            background: transparent !important;
            border: 2px dashed var(--thought-color);
            color: var(--thought-color) !important;
            font-style: italic;
        }

        /* í†µì‹  ë§í’ì„  */
        .bubble.comm {
            background: transparent !important;
            border: 2px solid var(--comm-color);
            color: var(--comm-color) !important;
            position: relative;
            padding-left: 36px;
        }

        .bubble.comm::before {
            content: 'ğŸ“¡';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }

        /* ========== ë‚˜ë ˆì´ì…˜ (ì§€ë¬¸) ========== */
        .narration {
            text-align: center;
            padding: 6px 16px;
            margin: 4px 0;
            color: var(--log-text);
            font-style: italic;
            position: relative;
        }
        
        /* ë‚˜ë ˆì´ì…˜ ì•ì— ë§í’ì„ ì´ ìˆì„ ë•Œë§Œ ìœ„ìª½ ì„  í‘œì‹œ */
        .chat-block + .narration::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -4px;
            transform: translateX(-50%);
            width: 40px;
            height: 1px;
            background: currentColor;
            opacity: 0.2;
        }
        
        /* ë‚˜ë ˆì´ì…˜ ë’¤ì— ë§í’ì„ ì´ ìˆì„ ë•Œë§Œ ì•„ë˜ìª½ ì„  í‘œì‹œ */
        .narration:has(+ .chat-block)::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -4px;
            transform: translateX(-50%);
            width: 40px;
            height: 1px;
            background: currentColor;
            opacity: 0.2;
        }

        /* ========== êµ¬ë¶„ì„  ========== */
        /* --- ì ì„  êµ¬ë¶„ì„  */
        .divider {
            border-top: 1px dashed rgba(128,128,128,0.4);
            margin: 16px 0;
        }
        
        /* === ì  ì„¸ ê°œ êµ¬ë¶„ì„  */
        .dot-divider {
            text-align: center;
            margin: 16px 0;
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .dot-divider::before {
            content: 'â€¢ â€¢ â€¢';
            letter-spacing: 8px;
        }

        /* ========== ë°˜ì‘í˜• ========== */
        @media (max-width: 1024px) {
            .app-body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                min-width: unset;
                max-width: unset;
                max-height: 50vh;
                border-right: none;
                border-bottom: 1px solid var(--panel-border);
            }
            
            .preview-wrapper {
                padding: 20px;
            }
            
            #log-preview {
                width: 100% !important;
                max-width: 100%;
                padding: 20px;
            }
        }
        
        /* ëª¨ë°”ì¼ ë·° ì „í™˜ ë²„íŠ¼ - ê¸°ë³¸ê°’ (ë°ìŠ¤í¬íƒ‘ì—ì„œ ìˆ¨ê¹€) */
        .mobile-view-toggle {
            display: none;
        }
        
        @media (max-width: 768px) {
            .app-header {
                padding: 10px 12px;
                height: auto;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .app-header h1 {
                font-size: 16px;
            }
            
            .app-header .header-actions {
                gap: 4px;
            }
            
            .app-header .header-actions .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .app-header .header-divider {
                display: none;
            }
            
            .app-header .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .sidebar {
                max-height: 60vh;
            }
            
            .sidebar-content {
                padding: 12px;
            }
            
            .section {
                padding: 12px;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .color-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .theme-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .tabs {
                gap: 2px;
            }
            
            .tab {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .preview-wrapper {
                padding: 12px;
            }
            
            #log-preview {
                padding: 16px;
                font-size: 14px !important;
                border-radius: 12px !important;
            }
            
            .log-title h2 {
                font-size: 18px;
            }
            
            .bubble {
                padding: 10px 12px;
                max-width: 90%;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .log-block-header {
                padding: 8px 10px;
            }
            
            .log-block-actions button {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            /* ëª¨ë°”ì¼ ë·° ì „í™˜ ë²„íŠ¼ */
            .mobile-view-toggle {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--panel-bg);
                border-top: 1px solid var(--panel-border);
                padding: 8px 12px;
                gap: 8px;
                z-index: 100;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            
            .mobile-view-toggle .mobile-view-btn {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
            }
            
            .mobile-view-toggle .mobile-view-btn.settings-btn {
                background: var(--input-bg);
                color: var(--text-primary);
            }
            
            .mobile-view-toggle .mobile-view-btn.preview-btn {
                background: var(--accent);
                color: white;
            }
            
            .mobile-view-toggle .mobile-view-btn.active {
                box-shadow: inset 0 0 0 2px var(--accent);
            }
            
            /* ëª¨ë°”ì¼ ë·° ëª¨ë“œ */
            body.mobile-settings-view .sidebar {
                display: block;
                max-height: calc(100vh - 56px - 60px);
                height: calc(100vh - 56px - 60px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            body.mobile-settings-view .main-content {
                display: none;
            }
            
            body.mobile-preview-view .sidebar {
                display: none;
            }
            
            body.mobile-preview-view .main-content {
                display: flex;
                height: calc(100vh - 56px - 60px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            body.mobile-settings-view .app-body,
            body.mobile-preview-view .app-body {
                flex-direction: column;
                padding-bottom: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .app-header {
                padding: 8px 10px;
            }
            
            .app-header .header-left {
                width: 100%;
                justify-content: center;
            }
            
            .app-header .header-actions {
                width: 100%;
                justify-content: center;
            }
            
            .mode-toggle {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .theme-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 4px;
            }
            
            .theme-btn {
                min-height: 40px;
            }
            
            .theme-btn span {
                font-size: 7px;
            }
            
            .extra-char-item {
                flex-wrap: wrap;
            }
            
            .extra-char-item input[type="text"] {
                min-width: 100px;
            }
            
            .mobile-view-toggle .mobile-view-btn {
                padding: 10px;
                font-size: 13px;
            }
        }
        
        /* ========== ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--input-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* ========== íƒ­ ì‹œìŠ¤í…œ ========== */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            background: var(--panel-border);
        }

        .tab.active {
            background: var(--accent);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== ì •ê·œì‹ ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ========== */
        .rule-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rule-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .rule-item input {
            flex: 1;
        }

        .rule-item .btn-remove {
            width: 36px;
            height: 36px;
            padding: 0;
            background: #e03131;
            color: white;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .btn-add-rule {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 2px dashed var(--input-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add-rule:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* ========== ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ ========== */
        .log-block {
            background: var(--panel-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .log-block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--input-bg);
            border-bottom: 1px solid var(--input-border);
            cursor: pointer;
        }
        
        .log-block-header:hover {
            background: var(--panel-border);
        }
        
        .log-block-title {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .log-block-title input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 13px;
            width: 150px;
            padding: 4px;
        }
        
        .log-block-title input:focus {
            outline: none;
            background: var(--panel-bg);
            border-radius: 4px;
        }
        
        .log-block-actions {
            display: flex;
            gap: 4px;
        }
        
        .log-block-actions button {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s, opacity 0.1s;
        }
        
        .log-block-actions button:hover {
            transform: scale(1.1);
            opacity: 0.9;
        }
        
        .log-block-actions .btn-toggle {
            background: var(--accent);
            color: white;
        }
        
        .log-block-actions .btn-delete {
            background: #e03131;
            color: white;
            font-size: 18px;
        }
        
        .log-block-actions .btn-move {
            background: var(--panel-border);
            color: var(--text-primary);
        }
        
        .log-block-content {
            padding: 12px;
        }
        
        .log-block-content.collapsed {
            display: none;
        }
        
        .log-block textarea {
            min-height: 100px;
        }
        
        .btn-add-block {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px dashed var(--accent);
            border-radius: 8px;
            color: var(--accent);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-add-block:hover {
            background: rgba(51, 154, 240, 0.1);
        }
        
        /* ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
        .mode-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .mode-toggle:hover {
            background: var(--panel-border);
        }
        
        /* ========== í”„ë¦¬ì…‹ íŒ¨ë„ ========== */
        .preset-panel {
            position: fixed;
            top: 56px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            max-height: calc(100vh - 80px);
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 20px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow-y: auto;
            display: none;
        }
        
        .preset-panel.show {
            display: block;
        }
        
        .preset-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--panel-border);
            cursor: move;
            user-select: none;
        }
        
        .preset-panel-header .drag-hint {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.7;
            margin-left: 8px;
        }
        
        .preset-panel-header h3 {
            margin: 0;
            font-size: 18px;
            color: var(--text-primary);
        }
        
        .preset-panel-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--input-bg);
            color: var(--text-primary);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preset-panel-close:hover {
            background: var(--panel-border);
        }
        
        .preset-panel-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .preset-panel-actions .btn {
            flex: 1;
        }
        
        .preset-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
        }
        
        .preset-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            background: var(--input-bg);
            border-radius: 8px;
            border: 1px solid var(--input-border);
        }
        
        .preset-item-name {
            flex: 1;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .preset-item-name:hover {
            color: var(--accent);
        }
        
        .preset-item-actions {
            display: flex;
            gap: 4px;
        }
        
        .preset-item-btn {
            width: 26px;
            height: 26px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preset-item-btn.edit {
            background: #228be6;
            color: white;
        }
        
        .preset-item-btn.delete {
            background: #e03131;
            color: white;
        }
        
        .preset-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .preset-panel-overlay.show {
            display: block;
        }
        
        .preset-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* ========== íŒì—… í¸ì§‘ì°½ ========== */
        .popup-editor-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            pointer-events: none;
        }
        
        .popup-editor-overlay.show {
            display: block;
        }
        
        .popup-editor {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 700px;
            height: 500px;
            min-width: 400px;
            min-height: 300px;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        
        .popup-editor.show {
            display: flex;
        }
        
        .popup-editor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--input-bg);
            border-bottom: 1px solid var(--panel-border);
            cursor: move;
            user-select: none;
            flex-shrink: 0;
        }
        
        .popup-editor-header h3 {
            margin: 0;
            font-size: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .popup-editor-header .drag-hint {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.6;
            margin-left: 8px;
        }
        
        .popup-editor-header-actions {
            display: flex;
            gap: 8px;
        }
        
        .popup-editor-header-actions button {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--panel-border);
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        .popup-editor-header-actions button:hover {
            background: var(--accent);
            color: white;
        }
        
        .popup-editor-header-actions .btn-close:hover {
            background: #e03131;
        }
        
        .popup-editor-body {
            flex: 1;
            padding: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .popup-editor-body textarea {
            flex: 1;
            width: 100%;
            resize: none;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', 'Noto Sans KR', monospace;
            line-height: 1.6;
        }
        
        .popup-editor-body textarea:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .popup-editor-footer {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            padding: 12px 16px;
            background: var(--input-bg);
            border-top: 1px solid var(--panel-border);
            flex-shrink: 0;
        }
        
        .popup-editor-footer .btn {
            padding: 10px 20px;
        }
        
        /* ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ */
        .popup-editor .resize-handle {
            position: absolute;
            background: transparent;
        }
        
        .popup-editor .resize-handle-se {
            right: 0;
            bottom: 0;
            width: 20px;
            height: 20px;
            cursor: se-resize;
        }
        
        .popup-editor .resize-handle-se::after {
            content: '';
            position: absolute;
            right: 4px;
            bottom: 4px;
            width: 10px;
            height: 10px;
            border-right: 2px solid var(--text-secondary);
            border-bottom: 2px solid var(--text-secondary);
            opacity: 0.5;
        }
        
        .popup-editor .resize-handle-e {
            right: 0;
            top: 50px;
            bottom: 20px;
            width: 8px;
            cursor: e-resize;
        }
        
        .popup-editor .resize-handle-s {
            left: 20px;
            right: 20px;
            bottom: 0;
            height: 8px;
            cursor: s-resize;
        }
        
        /* í—¤ë”ì˜ í¸ì§‘ ë²„íŠ¼ */
        .log-block-actions .btn-popup-edit {
            background: #20c997;
            color: white;
        }
        
        @media (max-width: 768px) {
            .popup-editor {
                width: 100% !important;
                height: calc(100% - 60px) !important;
                min-width: unset;
                min-height: unset;
                max-width: 100%;
                max-height: calc(100% - 60px);
                top: 0 !important;
                left: 0 !important;
                right: 0;
                bottom: 60px;
                transform: none !important;
                border-radius: 0;
                border: none;
            }
            
            .popup-editor-header {
                padding: 14px 16px;
            }
            
            .popup-editor-header h3 {
                font-size: 16px;
            }
            
            .popup-editor-header .drag-hint {
                display: none;
            }
            
            .popup-editor-body {
                padding: 12px;
            }
            
            .popup-editor-body textarea {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
                line-height: 1.8;
            }
            
            .popup-editor-footer {
                padding: 10px 12px;
            }
            
            .popup-editor-footer .btn {
                flex: 1;
                padding: 14px;
                font-size: 15px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±í™” */
            .popup-editor .resize-handle {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .preset-panel {
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                transform: none;
                width: 100%;
                max-width: 100%;
                border-radius: 16px 16px 0 0;
                max-height: 70vh;
            }
            
            .preset-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- SVG í•„í„° (ë¹ˆí‹°ì§€ ë¬¼ê²° íš¨ê³¼) -->
    <svg style="position:absolute;width:0;height:0;">
        <defs>
            <!-- ê°•í•œ ì–‘í”¼ì§€ ë¬¼ê²° í•„í„° (ì™¸ê³½ í…Œë‘ë¦¬ìš©) -->
            <filter id="wavy-filter" x="-20%" y="-20%" width="140%" height="140%">
                <feTurbulence type="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="2"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="25" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
            <!-- ì¤‘ê°„ ë¬¼ê²° í•„í„° (ë§í’ì„  í…Œë‘ë¦¬ìš©) -->
            <filter id="wavy-filter-medium" x="-15%" y="-25%" width="130%" height="150%">
                <feTurbulence type="turbulence" baseFrequency="0.025" numOctaves="2" result="noise" seed="5"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="15" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
            <!-- ì‘ì€ ë¬¼ê²° í•„í„° (ì„ , êµ¬ë¶„ì„ ìš©) -->
            <filter id="wavy-filter-small" x="-10%" y="-30%" width="120%" height="160%">
                <feTurbulence type="turbulence" baseFrequency="0.03" numOctaves="2" result="noise" seed="8"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="10" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
            <!-- ë§í’ì„  ì „ì²´ ë¬¼ê²° í•„í„° (ë§í’ì„  ë°°ê²½+ë‚´ìš© í¬í•¨) -->
            <filter id="wavy-filter-bubble" x="-5%" y="-5%" width="110%" height="110%">
                <feTurbulence type="turbulence" baseFrequency="0.015" numOctaves="2" result="noise" seed="10"/>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
        </defs>
    </svg>
    
    <!-- í†µí•© í—¤ë” -->
    <header class="app-header">
        <div class="header-left">
            <h1>ğŸ§ Log Cupcake</h1>
            <button class="mode-toggle" onclick="toggleDarkMode()" title="ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ ì „í™˜">ğŸŒ™</button>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="togglePresetPanel()" title="í”„ë¦¬ì…‹ ê´€ë¦¬">ğŸ“ í”„ë¦¬ì…‹</button>
            <button class="btn btn-primary" onclick="generateLog()">ğŸ”„ ìƒì„±</button>
            <button class="btn btn-success" onclick="saveImage()">ğŸ“· ì €ì¥</button>
        </div>
        <div class="header-divider"></div>
        <div class="header-right">
            <button class="btn btn-secondary preview-toggle" onclick="togglePreviewMode()">ğŸ“„ ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn btn-primary" onclick="copyArcaHTML()">ğŸ“‹ ì•„ì¹´ë¼ì´ë¸Œ</button>
            <button class="btn btn-secondary" onclick="resetAll()" title="ëª¨ë“  ì…ë ¥ ì´ˆê¸°í™”">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
    </header>
    
    <!-- íŒì—… í¸ì§‘ì°½ ì˜¤ë²„ë ˆì´ -->
    <div class="popup-editor-overlay" id="popup-editor-overlay" onclick="closePopupEditor()"></div>
    
    <!-- íŒì—… í¸ì§‘ì°½ -->
    <div class="popup-editor" id="popup-editor">
        <div class="popup-editor-header" id="popup-editor-header">
            <h3>
                <span>ğŸ“</span>
                <span id="popup-editor-title">ë¸”ë¡ í¸ì§‘</span>
                <span class="drag-hint">ë“œë˜ê·¸í•˜ì—¬ ì´ë™</span>
            </h3>
            <div class="popup-editor-header-actions">
                <button onclick="closePopupEditor()" class="btn-close" title="ë‹«ê¸°">Ã—</button>
            </div>
        </div>
        <div class="popup-editor-body">
            <textarea id="popup-editor-textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>
        <div class="popup-editor-footer">
            <button class="btn btn-secondary" onclick="closePopupEditor()">ë‹«ê¸°</button>
            <button class="btn btn-primary" onclick="saveAndClosePopupEditor()">ì €ì¥ í›„ ë‹«ê¸°</button>
        </div>
        <!-- ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ -->
        <div class="resize-handle resize-handle-se" data-resize="se"></div>
        <div class="resize-handle resize-handle-e" data-resize="e"></div>
        <div class="resize-handle resize-handle-s" data-resize="s"></div>
    </div>
    
    <!-- ëª¨ë°”ì¼ ë·° ì „í™˜ ë²„íŠ¼ -->
    <div class="mobile-view-toggle" id="mobile-view-toggle">
        <button class="mobile-view-btn settings-btn active" onclick="switchMobileView('settings')">
            âš™ï¸ ì„¤ì •
        </button>
        <button class="mobile-view-btn preview-btn" onclick="switchMobileView('preview')">
            ğŸ‘ï¸ ë¡œê·¸ ë³´ê¸°
        </button>
    </div>
    
    <!-- í”„ë¦¬ì…‹ íŒ¨ë„ ì˜¤ë²„ë ˆì´ -->
    <div class="preset-panel-overlay" onclick="closePresetPanel()"></div>
    
    <!-- í”„ë¦¬ì…‹ íŒ¨ë„ -->
    <div class="preset-panel" id="preset-panel">
        <div class="preset-panel-header" id="preset-panel-header">
            <div style="display:flex; align-items:center;">
                <h3>ğŸ“ í”„ë¦¬ì…‹ ê´€ë¦¬</h3>
                <span class="drag-hint">ë“œë˜ê·¸í•˜ì—¬ ì´ë™</span>
            </div>
            <button class="preset-panel-close" onclick="closePresetPanel()">Ã—</button>
        </div>
        <div class="preset-panel-actions">
            <button class="btn btn-primary" onclick="savePresetFromPanel()">ğŸ’¾ ì €ì¥</button>
            <button class="btn btn-secondary" onclick="exportPreset()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
            <input type="file" id="import-preset-panel" accept=".json" style="display:none;">
            <button class="btn btn-secondary" onclick="document.getElementById('import-preset-panel').click()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <div class="preset-list" id="preset-list-panel">
            <!-- í”„ë¦¬ì…‹ ëª©ë¡ì´ ì—¬ê¸°ì— ë Œë”ë§ë¨ -->
        </div>
    </div>
    
    <!-- ì•± ë°”ë”” (ì‚¬ì´ë“œë°” + ë©”ì¸) -->
    <div class="app-body">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-content">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="tabs">
                <button class="tab active" data-tab="input">ğŸ“ ì…ë ¥</button>
                <button class="tab" data-tab="theme">ğŸ¨ í…Œë§ˆ</button>
                <button class="tab" data-tab="style">âš™ï¸ ìŠ¤íƒ€ì¼</button>
            </div>

            <!-- ì…ë ¥ íƒ­ -->
            <div id="tab-input" class="tab-content active">
                <!-- ì œëª© ì„¹ì…˜ -->
                <div class="section">
                    <div class="section-title">ì œëª© ì„¤ì •</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">ë¡œê·¸ ì œëª©</label>
                            <input type="text" id="log-title" placeholder="ì˜ˆ: Chapter 1. ì‹œì‘" oninput="generateLog()">
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë¶€ì œëª©</label>
                            <input type="text" id="log-subtitle" placeholder="ì˜ˆ: 2025ë…„ ì–´ëŠ ë‚ " oninput="generateLog()">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">AI ëª¨ë¸</label>
                            <input type="text" id="ai-model-input" placeholder="ì§ì ‘ ì…ë ¥" oninput="generateLog()">
                            <select id="ai-model" style="width:100%; padding:8px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:6px; color:var(--text-primary); margin-top:4px; font-size:12px;" onchange="this.previousElementSibling.value = this.value; generateLog();">
                            <option value="">-- ëª¨ë¸ ì„ íƒ --</option>
                            <option value="Gemini 2.5 Pro">Gemini 2.5 Pro</option>
                            <option value="Gemini 2.5 Flash">Gemini 2.5 Flash</option>
                            <option value="Gemini 2.0 Flash">Gemini 2.0 Flash</option>
                            <option value="Gemini 3 Pro">Gemini 3 Pro</option>
                            <option value="Claude Sonnet 4">Claude Sonnet 4</option>
                            <option value="Claude Sonnet 4.5">Claude Sonnet 4.5</option>
                            <option value="Claude Haiku 4.5">Claude Haiku 4.5</option>
                            <option value="Claude Opus 4.5">Claude Opus 4.5</option>
                            <option value="Claude Opus 4.1">Claude Opus 4.1</option>
                            <option value="Claude Opus 4">Claude Opus 4</option>
                            <option value="GPT-4.1">GPT-4.1</option>
                            <option value="GPT-4o-latest">GPT-4o-latest</option>
                            <option value="GPT-5">GPT-5</option>
                            <option value="GPT-5-latest">GPT-5-latest</option>
                            <option value="GPT-5.1">GPT-5.1</option>
                            <option value="GPT-5.1-latest">GPT-5.1-latest</option>
                            <option value="DeepSeek">DeepSeek</option>
                        </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">í”„ë¡¬í”„íŠ¸ ì´ë¦„</label>
                            <input type="text" id="prompt-name" placeholder="ì˜ˆ: MyPrompt v2.0" oninput="generateLog()">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">ë²ˆì—­</label>
                            <input type="text" id="translation-input" placeholder="ì§ì ‘ ì…ë ¥" oninput="generateLog()">
                            <select id="translation" style="width:100%; padding:8px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:6px; color:var(--text-primary); margin-top:4px; font-size:12px;" onchange="this.previousElementSibling.value = this.value; generateLog();">
                                <option value="">-- ë²ˆì—­ê¸° ì„ íƒ --</option>
                                <option value="Gemini 2.5 Pro">Gemini 2.5 Pro</option>
                                <option value="Gemini 2.5 Flash">Gemini 2.5 Flash</option>
                                <option value="Gemini 2.0 Flash">Gemini 2.0 Flash</option>
                                <option value="Gemini 3 Pro">Gemini 3 Pro</option>
                                <option value="Claude Sonnet 4">Claude Sonnet 4</option>
                                <option value="Claude Sonnet 4.5">Claude Sonnet 4.5</option>
                                <option value="Claude Haiku 4.5">Claude Haiku 4.5</option>
                                <option value="Claude Opus 4.5">Claude Opus 4.5</option>
                                <option value="Claude Opus 4.1">Claude Opus 4.1</option>
                                <option value="Claude Opus 4">Claude Opus 4</option>
                                <option value="GPT-4.1">GPT-4.1</option>
                                <option value="GPT-4o-latest">GPT-4o-latest</option>
                                <option value="GPT-5">GPT-5</option>
                                <option value="GPT-5-latest">GPT-5-latest</option>
                                <option value="GPT-5.1">GPT-5.1</option>
                                <option value="GPT-5.1-latest">GPT-5.1-latest</option>
                                <option value="DeepSeek">DeepSeek</option>
                                <option value="DeepL">DeepL</option>
                                <option value="Papago">Papago</option>
                                <option value="Google ë²ˆì—­">Google ë²ˆì—­</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ìºë¦­í„° ë§í¬</label>
                            <input type="text" id="char-link" placeholder="https://..." oninput="generateLog()">
                        </div>
                    </div>
                </div>

                <!-- ìºë¦­í„° ì´ë¦„ -->
                <div class="section">
                    <div class="section-title">ìºë¦­í„° ì„¤ì •</div>
                    <div style="font-size:11px; color:var(--text-secondary); margin-bottom:10px;">
                        ê¸°ë³¸ ìºë¦­í„° (AI/USER)ì™€ ì¶”ê°€ ìºë¦­í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì¶”ê°€ ìºë¦­í„°ëŠ” CHAR-01:, CHAR-02: í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">AI ì´ë¦„</label>
                            <input type="text" id="name-ai" value="AI" placeholder="AI ìºë¦­í„° ì´ë¦„" oninput="generateLog()">
                        </div>
                        <div class="input-group">
                            <label class="input-label">USER ì´ë¦„</label>
                            <input type="text" id="name-user" value="USER" placeholder="ì‚¬ìš©ì ì´ë¦„" oninput="generateLog()">
                        </div>
                    </div>
                    <div id="extra-characters-container" style="margin-top:10px;"></div>
                    <button class="btn btn-secondary" onclick="addExtraCharacter()" style="width:100%; margin-top:10px;" id="add-char-btn">
                        â• ìºë¦­í„° ì¶”ê°€ (ìµœëŒ€ 10ëª…)
                    </button>
                </div>

                <!-- ì´ë¯¸ì§€ ì‚½ì… -->
                <div class="section">
                    <div class="section-title">ì´ë¯¸ì§€ ì‚½ì…</div>
                    <div class="input-group">
                        <label class="input-label">ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ (ë¸”ë¡ ë²ˆí˜¸ ì§€ì •)</label>
                        <input type="file" id="image-file-input" accept="image/*" style="display:none;" multiple>
                        <button class="btn btn-secondary" onclick="document.getElementById('image-file-input').click()" style="width:100%;">ğŸ“ ì´ë¯¸ì§€ ì¶”ê°€</button>
                        <div id="image-list" style="margin-top:10px;"></div>
                    </div>
                </div>

                <!-- ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ -->
                <div class="section">
                    <div class="section-title">ë¡œê·¸ ë¸”ë¡</div>
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px; padding:8px 12px; background:var(--input-bg); border-radius:8px;">
                        <label style="display:flex; align-items:center; gap:6px; cursor:pointer; font-size:13px;">
                            <input type="checkbox" id="block-folding" checked style="width:16px; height:16px; cursor:pointer;">
                            <span>HTML ë³µì‚¬ ì‹œ ë¸”ë¡ ì ‘ê¸°</span>
                        </label>
                        <span style="font-size:11px; color:var(--text-secondary);">(ì•„ì¹´ë¼ì´ë¸Œìš©)</span>
                    </div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.6;">
                        <b>í™”ì:</b> AI: / USER: / CHAR-01: | <b>ëŒ€ì‚¬:</b> "ëŒ€ì‚¬" | <b>ìƒê°:</b> 'ìƒê°'<br>
                        <b>í†µì‹ :</b> &gt; ë©”ì‹œì§€ | <b>ì†ì‚­ì„:</b> ((ë©”ì‹œì§€)) | <b>ì™¸ì¹¨:</b> ! ë©”ì‹œì§€<br>
                        <b>ë‚˜ë ˆì´ì…˜:</b> - í…ìŠ¤íŠ¸ | <b>êµ¬ë¶„ì„ :</b> --- | <b>ì  êµ¬ë¶„ì„ :</b> ===<br>
                        <b>ë§ˆí¬ë‹¤ìš´:</b> **êµµê²Œ** *ê¸°ìš¸ì„* ^<span></span>í•˜ì´ë¼ì´íŠ¸^ ~~ì·¨ì†Œ~~
                    </div>
                    <div id="log-blocks-container">
                        <div class="log-block" data-block-id="1">
                            <div class="log-block-header" onclick="toggleBlock(this)">
                                <div class="log-block-title">
                                    <span>ğŸ“</span>
                                    <input type="text" value="ë¸”ë¡ 1" onclick="event.stopPropagation()" onchange="updateBlockTitle(this)">
                                </div>
                                <div class="log-block-actions">
                                    <button class="btn-popup-edit" onclick="event.stopPropagation(); openPopupEditor(this)" title="íŒì—… í¸ì§‘">ğŸ“</button>
                                    <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, -1)" title="ìœ„ë¡œ">â–²</button>
                                    <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, 1)" title="ì•„ë˜ë¡œ">â–¼</button>
                                    <button class="btn-toggle" title="ì ‘ê¸°/í¼ì¹˜ê¸°">â–¼</button>
                                    <button class="btn-delete" onclick="event.stopPropagation(); deleteBlock(this)" title="ì‚­ì œ">Ã—</button>
                                </div>
                            </div>
                            <div class="log-block-content">
                                <textarea class="log-block-input" placeholder='AI: "ì•ˆë…•í•˜ì„¸ìš”!"
USER: "ë°˜ê°€ì›Œìš”."
- ë‚˜ë ˆì´ì…˜ í…ìŠ¤íŠ¸'></textarea>
                            </div>
                        </div>
                    </div>
                    <button class="btn-add-block" onclick="addLogBlock()">â• ìƒˆ ë¸”ë¡ ì¶”ê°€</button>
                </div>

                <!-- ì •ê·œì‹ ì¹˜í™˜ -->
                <div class="section">
                    <div class="section-title">ë‹¨ì–´ ë³€í™˜ (ì •ê·œì‹)</div>
                    <div class="rule-list" id="rule-list">
                        <div class="rule-item">
                            <input type="text" placeholder="ì°¾ì„ ë‹¨ì–´" class="rule-find">
                            <span style="color: var(--text-secondary);">â†’</span>
                            <input type="text" placeholder="ë°”ê¿€ ë‹¨ì–´" class="rule-replace">
                            <button class="btn-remove" onclick="removeRule(this)">Ã—</button>
                        </div>
                    </div>
                    <button class="btn-add-rule" onclick="addRule()">+ ê·œì¹™ ì¶”ê°€</button>
                </div>
            </div>

            <!-- í…Œë§ˆ íƒ­ -->
            <div id="tab-theme" class="tab-content">
                <div class="section">
                    <div class="section-title">í”„ë¦¬ì…‹ í…Œë§ˆ</div>
                    <div class="theme-grid">
                        <button class="theme-btn active" data-theme="default"><span>ê¸°ë³¸</span></button>
                        <button class="theme-btn" data-theme="ocean"><span>ì˜¤ì…˜</span></button>
                        <button class="theme-btn" data-theme="forest"><span>í¬ë ˆìŠ¤íŠ¸</span></button>
                        <button class="theme-btn" data-theme="sunset"><span>ì„ ì…‹</span></button>
                        <button class="theme-btn" data-theme="rose"><span>ë¡œì¦ˆ</span></button>
                        <button class="theme-btn" data-theme="lavender"><span>ë¼ë²¤ë”</span></button>
                        <button class="theme-btn" data-theme="midnight"><span>ë¯¸ë“œë‚˜ì‡</span></button>
                        <button class="theme-btn" data-theme="graphite"><span>ê·¸ë˜íŒŒì´íŠ¸</span></button>
                        <button class="theme-btn" data-theme="discord"><span>ë””ìŠ¤ì½”ë“œ</span></button>
                        <button class="theme-btn" data-theme="kakao"><span>ì¹´ì¹´ì˜¤í†¡</span></button>
                    </div>
                </div>

                <!-- ì»¤ìŠ¤í…€ ìƒ‰ìƒ -->
                <div class="section">
                    <div class="section-title">ì»¤ìŠ¤í…€ ìƒ‰ìƒ</div>
                    <div class="color-grid">
                        <div class="color-item">
                            <label>ë¬˜ì‚¬(ë‚˜ë ˆì´ì…˜)</label>
                            <input type="color" id="color-text" value="#1d2129">
                            <input type="text" id="color-text-text" value="#1d2129" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ë§í’ì„ </label>
                            <input type="color" id="color-ai-bg" value="#f1f3f5">
                            <input type="text" id="color-ai-bg-text" value="#f1f3f5" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ë§í’ì„ </label>
                            <input type="color" id="color-user-bg" value="#339af0">
                            <input type="text" id="color-user-bg-text" value="#339af0" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ëŒ€ì‚¬</label>
                            <input type="color" id="color-ai-text" value="#1d2129">
                            <input type="text" id="color-ai-text-text" value="#1d2129" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ëŒ€ì‚¬</label>
                            <input type="color" id="color-user-text" value="#ffffff">
                            <input type="text" id="color-user-text-text" value="#ffffff" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ìƒê° ë§í’ì„ </label>
                            <input type="color" id="color-thought" value="#748ffc">
                            <input type="text" id="color-thought-text" value="#748ffc" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í†µì‹  ë§í’ì„ </label>
                            <input type="color" id="color-comm" value="#20c997">
                            <input type="text" id="color-comm-text" value="#20c997" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ì´ë¦„í‘œ</label>
                            <input type="color" id="color-name-ai" value="#495057">
                            <input type="text" id="color-name-ai-text" value="#495057" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ì´ë¦„í‘œ</label>
                            <input type="color" id="color-name-user" value="#339af0">
                            <input type="text" id="color-name-user-text" value="#339af0" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ì œëª©/ë¶€ì œëª©</label>
                            <input type="color" id="color-title" value="#1d2129">
                            <input type="text" id="color-title-text" value="#1d2129" style="display:none;">
                        </div>
                    </div>
                    <div class="btn-group" style="margin-top: 12px;">
                        <button class="btn btn-secondary" onclick="randomizeCustomColors()">ğŸ² ëœë¤</button>
                        <button class="btn btn-primary" onclick="saveCustomTheme()">ğŸ’¾ í…Œë§ˆ ì €ì¥</button>
                    </div>
                    <div id="saved-themes" style="margin-top: 12px;"></div>
                </div>

                <!-- ë°°ê²½ ì„¤ì • -->
                <div class="section">
                    <div class="section-title">ë°°ê²½ ì„¤ì •</div>
                    <div class="input-group">
                        <label class="input-label">ë°°ê²½ íƒ€ì…</label>
                        <select id="bg-type" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                            <option value="solid">ë‹¨ìƒ‰</option>
                            <option value="gradient">ê·¸ë¼ë°ì´ì…˜</option>
                        </select>
                    </div>
                    <div id="bg-solid-options">
                        <div class="input-group">
                            <label class="input-label">ë°°ê²½ìƒ‰</label>
                            <div class="color-row">
                                <input type="color" id="bg-solid-color" value="#ffffff">
                                <input type="text" id="bg-solid-color-text" value="#ffffff">
                            </div>
                        </div>
                    </div>
                    <div id="bg-gradient-options" style="display:none;">
                        <div class="input-group">
                            <label class="input-label">ê·¸ë¼ë°ì´ì…˜ í”„ë¦¬ì…‹</label>
                            <select id="gradient-select" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                                <option value="custom">ì§ì ‘ ì„¤ì •</option>
                                <option value="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">í¼í”Œ ë“œë¦¼</option>
                                <option value="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">í”Œë¼ë¯¼ê³ </option>
                                <option value="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">ì˜¤ì…˜ ë¸”ë£¨</option>
                                <option value="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)">ë¯¼íŠ¸ ê·¸ë¦°</option>
                                <option value="linear-gradient(135deg, #fa709a 0%, #fee140 100%)">ì„ ì…‹ ê¸€ë¡œìš°</option>
                                <option value="linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)">íŒŒìŠ¤í…” ë“œë¦¼</option>
                                <option value="linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)">í”¼ì¹˜ í¬ë¦¼</option>
                                <option value="linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)">ë¼ë²¤ë” ë¯¸ìŠ¤íŠ¸</option>
                                <option value="linear-gradient(180deg, #2c3e50 0%, #4ca1af 100%)">ë§ˆì œìŠ¤í‹± ë‹¤í¬</option>
                                <option value="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)">ë‹¤í¬ ë°¤í•˜ëŠ˜</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ì‹œì‘ ìƒ‰ìƒ</label>
                            <div class="color-row">
                                <input type="color" id="gradient-start" value="#667eea">
                                <input type="text" id="gradient-start-text" value="#667eea">
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë ìƒ‰ìƒ</label>
                            <div class="color-row">
                                <input type="color" id="gradient-end" value="#764ba2">
                                <input type="text" id="gradient-end-text" value="#764ba2">
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë°©í–¥ (ë„)</label>
                            <input type="number" id="gradient-angle" value="135" min="0" max="360">
                        </div>
                    </div>
                </div>

                <!-- ì™¸ê³½ í…Œë§ˆ -->
                <div class="section">
                    <div class="section-title">ì™¸ê³½ í…Œë§ˆ</div>
                    <div class="input-group">
                        <label class="input-label">í”„ë ˆì„ ìŠ¤íƒ€ì¼: ë‹¨, ì´ë¯¸ì§€ ì €ì¥ì‹œì—ë§Œ ì‚¬ìš©. HTML ë³µì‚¬ì‹œ ì•„ì¹´ë¼ì´ë¸Œì—ì„œ ì‘ë™X</label>
                        <select id="frame-select" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                            <option value="none">ì—†ìŒ</option>
                            <option value="letter">í¸ì§€ì§€ ê°ì„±</option>
                            <option value="diary">ë‹¤ì´ì–´ë¦¬ ê°ì„±</option>
                            <option value="memo">ë©”ëª¨ì§€ ê°ì„±</option>
                            <option value="gold">ê¸ˆë°• í”„ë ˆì„</option>
                            <option value="ornate">ì¥ì‹ í”„ë ˆì„</option>
                            <option value="check">ì²´í¬ë¬´ëŠ¬</option>
                            <option value="tape">í…Œì´í”„ ë¶™ì´ê¸°</option>
                            <option value="vintage">ë¹ˆí‹°ì§€</option>
                            <option value="polaroid">í´ë¼ë¡œì´ë“œ</option>
                        </select>
                    </div>
                </div>

            </div>

            <!-- ìŠ¤íƒ€ì¼ íƒ­ -->
            <div id="tab-style" class="tab-content">
                <div class="section">
                    <div class="section-title">ë ˆì´ì•„ì›ƒ</div>
                    <div class="input-group">
                        <label class="input-label">ì»¨í…Œì´ë„ˆ ë„ˆë¹„ (px)</label>
                        <input type="number" id="style-width" value="1000" min="300" max="1500">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° (px)</label>
                        <input type="number" id="style-radius" value="16" min="0" max="50">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">íƒ€ì´í¬ê·¸ë˜í”¼</div>
                    <div class="input-group">
                        <label class="input-label">ê¸€ì í¬ê¸° (px)</label>
                        <input type="number" id="style-font-size" value="15" min="10" max="24">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ì¤„ ê°„ê²©</label>
                        <input type="number" id="style-line-height" value="1.7" min="1" max="3" step="0.1">
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="applyStyles()" style="width: 100%;">ìŠ¤íƒ€ì¼ ì ìš©</button>
            </div>
        </div>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="preview-wrapper">
            <div id="log-preview" class="theme-default">
                <div style="text-align: center; color: var(--text-secondary); padding: 60px 20px;">
                    <p style="font-size: 48px; margin-bottom: 16px;">âœ¨</p>
                    <p>ì™¼ìª½ì—ì„œ ë¡œê·¸ë¥¼ ì…ë ¥í•˜ê³ <br>'ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
            </div>
            <div id="html-code-view" class="html-code-view"></div>
        </div>
    </main>
    </div>

    <script>
        // ========== íƒ­ ì‹œìŠ¤í…œ ==========
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // ========== í…Œë§ˆ ìƒ‰ìƒ ì •ì˜ ==========
        const themeColors = {
            'default': {
                logBg: '#ffffff', logText: '#1d2129',
                aiBg: '#f1f3f5', aiText: '#1d2129',
                userBg: '#339af0', userText: '#ffffff',
                thought: '#748ffc', comm: '#20c997',
                nameAi: '#495057', nameUser: '#339af0', title: '#1d2129'
            },
            'ocean': {
                logBg: '#e7f5ff', logText: '#1864ab',
                aiBg: '#d0ebff', aiText: '#1864ab',
                userBg: '#228be6', userText: '#ffffff',
                thought: '#4dabf7', comm: '#15aabf',
                nameAi: '#1864ab', nameUser: '#228be6', title: '#1864ab'
            },
            'forest': {
                logBg: '#ebfbee', logText: '#2b8a3e',
                aiBg: '#d3f9d8', aiText: '#2b8a3e',
                userBg: '#40c057', userText: '#ffffff',
                thought: '#69db7c', comm: '#38d9a9',
                nameAi: '#2b8a3e', nameUser: '#40c057', title: '#2b8a3e'
            },
            'sunset': {
                logBg: '#fff4e6', logText: '#d9480f',
                aiBg: '#ffe8cc', aiText: '#d9480f',
                userBg: '#fd7e14', userText: '#ffffff',
                thought: '#ffa94d', comm: '#ff922b',
                nameAi: '#d9480f', nameUser: '#fd7e14', title: '#d9480f'
            },
            'rose': {
                logBg: '#fff0f6', logText: '#c2255c',
                aiBg: '#ffdeeb', aiText: '#c2255c',
                userBg: '#f06595', userText: '#ffffff',
                thought: '#f783ac', comm: '#e64980',
                nameAi: '#c2255c', nameUser: '#f06595', title: '#c2255c'
            },
            'lavender': {
                logBg: '#f3f0ff', logText: '#5f3dc4',
                aiBg: '#e5dbff', aiText: '#5f3dc4',
                userBg: '#7950f2', userText: '#ffffff',
                thought: '#9775fa', comm: '#845ef7',
                nameAi: '#5f3dc4', nameUser: '#7950f2', title: '#5f3dc4'
            },
            'midnight': {
                logBg: '#0f0e17', logText: '#a7a9be',
                aiBg: '#1a1825', aiText: '#fffffe',
                userBg: '#7f5af0', userText: '#fffffe',
                thought: '#9d8cff', comm: '#2cb67d',
                nameAi: '#fffffe', nameUser: '#7f5af0', title: '#fffffe'
            },
            'graphite': {
                logBg: '#1c1917', logText: '#d6d3d1',
                aiBg: '#292524', aiText: '#fafaf9',
                userBg: '#c2410c', userText: '#ffffff',
                thought: '#fb923c', comm: '#4ade80',
                nameAi: '#fafaf9', nameUser: '#fb923c', title: '#fafaf9'
            },
            'discord': {
                logBg: '#313338', logText: '#dbdee1',
                aiBg: '#2b2d31', aiText: '#f2f3f5',
                userBg: '#5865f2', userText: '#ffffff',
                thought: '#949ba4', comm: '#23a559',
                nameAi: '#f2f3f5', nameUser: '#5865f2', title: '#f2f3f5'
            },
            'kakao': {
                logBg: '#b2c7d9', logText: '#1e1e1e',
                aiBg: '#ffffff', aiText: '#1e1e1e',
                userBg: '#fee500', userText: '#1e1e1e',
                thought: '#5a5a5a', comm: '#3182f6',
                nameAi: '#1e1e1e', nameUser: '#3182f6', title: '#1e1e1e'
            }
        };

        // ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì…ë ¥ë€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateColorInputs(colors) {
            document.getElementById('color-text').value = colors.logText;
            document.getElementById('color-text-text').value = colors.logText;
            document.getElementById('color-ai-bg').value = colors.aiBg;
            document.getElementById('color-ai-bg-text').value = colors.aiBg;
            document.getElementById('color-user-bg').value = colors.userBg;
            document.getElementById('color-user-bg-text').value = colors.userBg;
            document.getElementById('color-ai-text').value = colors.aiText;
            document.getElementById('color-ai-text-text').value = colors.aiText;
            document.getElementById('color-user-text').value = colors.userText;
            document.getElementById('color-user-text-text').value = colors.userText;
            document.getElementById('color-thought').value = colors.thought;
            document.getElementById('color-thought-text').value = colors.thought;
            document.getElementById('color-comm').value = colors.comm;
            document.getElementById('color-comm-text').value = colors.comm;
            document.getElementById('color-name-ai').value = colors.nameAi;
            document.getElementById('color-name-ai-text').value = colors.nameAi;
            document.getElementById('color-name-user').value = colors.nameUser;
            document.getElementById('color-name-user-text').value = colors.nameUser;
            document.getElementById('color-title').value = colors.title;
            document.getElementById('color-title-text').value = colors.title;
            
            // ë°°ê²½ìƒ‰ë„ ì—…ë°ì´íŠ¸
            document.getElementById('bg-solid-color').value = colors.logBg;
            document.getElementById('bg-solid-color-text').value = colors.logBg;
        }

        // ========== í…Œë§ˆ ì„ íƒ ==========
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const themeName = btn.dataset.theme;
                const colors = themeColors[themeName];
                
                if (colors) {
                    // ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì…ë ¥ë€ ì—…ë°ì´íŠ¸
                    updateColorInputs(colors);
                }
                
                const preview = document.getElementById('log-preview');
                // ëª¨ë“  í…Œë§ˆ í´ë˜ìŠ¤ ì œê±°
                preview.className = preview.className.replace(/theme-\S+/g, '').trim();
                
                // í”„ë ˆì„ í´ë˜ìŠ¤ëŠ” ìœ ì§€
                const frameClasses = preview.className.match(/frame-\S+/g) || [];
                preview.className = frameClasses.join(' ');
                
                // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼(ì»¤ìŠ¤í…€ ìƒ‰ìƒ) ì´ˆê¸°í™”
                preview.style.removeProperty('--log-bg');
                preview.style.removeProperty('--log-text');
                preview.style.removeProperty('--bubble-ai-bg');
                preview.style.removeProperty('--bubble-user-bg');
                preview.style.removeProperty('--bubble-ai-text');
                preview.style.removeProperty('--bubble-user-text');
                preview.style.removeProperty('--thought-color');
                preview.style.removeProperty('--comm-color');
                preview.style.removeProperty('--name-ai-color');
                preview.style.removeProperty('--name-user-color');
                preview.style.removeProperty('--title-color');
                preview.style.removeProperty('background');
                
                // ì„ íƒí•œ í…Œë§ˆ í´ë˜ìŠ¤ ì¶”ê°€ (ê¸°ë³¸ í¬í•¨)
                preview.classList.add('theme-' + themeName);
            });
        });

        // ========== ì •ê·œì‹ ê·œì¹™ ê´€ë¦¬ ==========
        function addRule(findValue = '', replaceValue = '') {
            const list = document.getElementById('rule-list');
            const item = document.createElement('div');
            item.className = 'rule-item';
            item.innerHTML = `
                <input type="text" placeholder="ì°¾ì„ ë‹¨ì–´" class="rule-find" value="${escapeHtml(findValue)}">
                <span style="color: var(--text-secondary);">â†’</span>
                <input type="text" placeholder="ë°”ê¿€ ë‹¨ì–´" class="rule-replace" value="${escapeHtml(replaceValue)}">
                <button class="btn-remove" onclick="removeRule(this)">Ã—</button>
            `;
            list.appendChild(item);
        }

        function removeRule(btn) {
            btn.parentElement.remove();
        }

        // ========== ìƒ‰ìƒ ì…ë ¥ ë™ê¸°í™” ==========
        const colorPairs = [
            ['color-text', 'color-text-text'],
            ['color-ai-bg', 'color-ai-bg-text'],
            ['color-user-bg', 'color-user-bg-text'],
            ['color-ai-text', 'color-ai-text-text'],
            ['color-user-text', 'color-user-text-text'],
            ['color-thought', 'color-thought-text'],
            ['color-comm', 'color-comm-text'],
            ['color-name-ai', 'color-name-ai-text'],
            ['color-name-user', 'color-name-user-text'],
            ['color-title', 'color-title-text'],
            ['bg-solid-color', 'bg-solid-color-text'],
            ['gradient-start', 'gradient-start-text'],
            ['gradient-end', 'gradient-end-text']
        ];

        colorPairs.forEach(([colorId, textId]) => {
            const colorInput = document.getElementById(colorId);
            const textInput = document.getElementById(textId);
            
            if (!colorInput || !textInput) return;
            
            colorInput.addEventListener('input', () => {
                textInput.value = colorInput.value;
                applyCustomColors();
            });
            
            textInput.addEventListener('input', () => {
                if (/^#[0-9A-Fa-f]{6}$/.test(textInput.value)) {
                    colorInput.value = textInput.value;
                    applyCustomColors();
                }
            });
        });

        // ========== ëœë¤ ë°°ê²½ ì ìš© (ë‹¨ìƒ‰ ë˜ëŠ” ê·¸ë¼ë°ì´ì…˜) ==========
        function applyRandomBackground(isDark, baseHue, accentHue) {
            const bgType = document.getElementById('bg-type').value;
            
            if (bgType === 'gradient') {
                // ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ ëœë¤ ìƒì„±
                const angle = Math.floor(Math.random() * 360);
                let startColor, endColor;
                
                if (isDark) {
                    // ì–´ë‘ìš´ ê·¸ë¼ë°ì´ì…˜
                    startColor = hslToHex(baseHue, 20 + Math.floor(Math.random() * 20), 10 + Math.floor(Math.random() * 10));
                    endColor = hslToHex(accentHue, 25 + Math.floor(Math.random() * 20), 15 + Math.floor(Math.random() * 12));
                } else {
                    // ë°ì€ ê·¸ë¼ë°ì´ì…˜
                    startColor = hslToHex(baseHue, 30 + Math.floor(Math.random() * 40), 90 + Math.floor(Math.random() * 8));
                    endColor = hslToHex(accentHue, 35 + Math.floor(Math.random() * 40), 85 + Math.floor(Math.random() * 10));
                }
                
                // ê·¸ë¼ë°ì´ì…˜ í•„ë“œ ì—…ë°ì´íŠ¸
                document.getElementById('gradient-select').value = 'custom';
                document.getElementById('gradient-start').value = startColor;
                document.getElementById('gradient-start-text').value = startColor;
                document.getElementById('gradient-end').value = endColor;
                document.getElementById('gradient-end-text').value = endColor;
                document.getElementById('gradient-angle').value = angle;
            } else {
                // ë‹¨ìƒ‰ ë°°ê²½ ëœë¤ ìƒì„±
                let bgColor;
                if (isDark) {
                    bgColor = hslToHex(baseHue, 15 + Math.floor(Math.random() * 20), 12 + Math.floor(Math.random() * 10));
                } else {
                    bgColor = hslToHex(baseHue, 20 + Math.floor(Math.random() * 30), 95 + Math.floor(Math.random() * 4));
                }
                document.getElementById('bg-solid-color').value = bgColor;
                document.getElementById('bg-solid-color-text').value = bgColor;
            }
        }

        // ========== ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì ìš© ==========
        function applyCustomColors() {
            const preview = document.getElementById('log-preview');
            preview.style.setProperty('--log-text', document.getElementById('color-text').value);
            preview.style.setProperty('--bubble-ai-bg', document.getElementById('color-ai-bg').value);
            preview.style.setProperty('--bubble-user-bg', document.getElementById('color-user-bg').value);
            preview.style.setProperty('--bubble-ai-text', document.getElementById('color-ai-text').value);
            preview.style.setProperty('--bubble-user-text', document.getElementById('color-user-text').value);
            preview.style.setProperty('--thought-color', document.getElementById('color-thought').value);
            preview.style.setProperty('--comm-color', document.getElementById('color-comm').value);
            preview.style.setProperty('--name-ai-color', document.getElementById('color-name-ai').value);
            preview.style.setProperty('--name-user-color', document.getElementById('color-name-user').value);
            preview.style.setProperty('--title-color', document.getElementById('color-title').value);
            
            // í…Œë§ˆ ë²„íŠ¼ ì„ íƒ í•´ì œ
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
        }
        
        // ========== ì»¤ìŠ¤í…€ ìƒ‰ìƒ ëœë¤ ìƒì„± ==========
        function randomizeCustomColors() {
            // ë°ì€ í…Œë§ˆ vs ì–´ë‘ìš´ í…Œë§ˆ ëœë¤ ì„ íƒ
            const isDark = Math.random() > 0.5;
            
            // ê¸°ë³¸ Hue ì„ íƒ
            const baseHue = Math.floor(Math.random() * 360);
            // ë³´ìƒ‰/ìœ ì‚¬ìƒ‰ Hue
            const accentHue = (baseHue + 120 + Math.floor(Math.random() * 120)) % 360;
            const secondaryHue = (baseHue + 30 + Math.floor(Math.random() * 60)) % 360;
            
            let colors = {};
            
            if (isDark) {
                // ì–´ë‘ìš´ í…Œë§ˆ
                // ë´‡ ë§í’ì„ : ì•½ê°„ ë°ì€ ì–´ë‘ìš´ ìƒ‰
                colors.aiBg = hslToHex(baseHue, 20 + Math.floor(Math.random() * 15), 20 + Math.floor(Math.random() * 10));
                colors.aiText = hslToHex(baseHue, 10, 90 + Math.floor(Math.random() * 8));
                
                // í¼ì†Œ ë§í’ì„ : í¬ì¸íŠ¸ ìƒ‰ìƒ
                colors.userBg = hslToHex(accentHue, 50 + Math.floor(Math.random() * 30), 45 + Math.floor(Math.random() * 15));
                colors.userText = '#ffffff';
                
                // ë‚˜ë ˆì´ì…˜/ì œëª©: ë°ì€ ìƒ‰
                colors.text = hslToHex(baseHue, 10, 85 + Math.floor(Math.random() * 10));
                colors.title = hslToHex(baseHue, 15, 90 + Math.floor(Math.random() * 8));
                
                // ìƒê°/í†µì‹ : í¬ì¸íŠ¸ ì»¬ëŸ¬
                colors.thought = hslToHex(secondaryHue, 50 + Math.floor(Math.random() * 30), 60 + Math.floor(Math.random() * 15));
                colors.comm = hslToHex((accentHue + 60) % 360, 50 + Math.floor(Math.random() * 30), 55 + Math.floor(Math.random() * 15));
                
                // ì´ë¦„í‘œ
                colors.nameAi = hslToHex(baseHue, 15, 85 + Math.floor(Math.random() * 10));
                colors.nameUser = hslToHex(accentHue, 60, 60 + Math.floor(Math.random() * 15));
                
                // ë°°ê²½ ì ìš© (ë‹¨ìƒ‰ ë˜ëŠ” ê·¸ë¼ë°ì´ì…˜)
                applyRandomBackground(isDark, baseHue, accentHue);
            } else {
                // ë°ì€ í…Œë§ˆ
                // ë´‡ ë§í’ì„ : ì—°í•œ ìƒ‰
                colors.aiBg = hslToHex(baseHue, 15 + Math.floor(Math.random() * 25), 92 + Math.floor(Math.random() * 6));
                colors.aiText = hslToHex(baseHue, 30, 15 + Math.floor(Math.random() * 15));
                
                // í¼ì†Œ ë§í’ì„ : í¬ì¸íŠ¸ ìƒ‰ìƒ
                colors.userBg = hslToHex(accentHue, 60 + Math.floor(Math.random() * 30), 50 + Math.floor(Math.random() * 15));
                colors.userText = '#ffffff';
                
                // ë‚˜ë ˆì´ì…˜/ì œëª©: ì–´ë‘ìš´ ìƒ‰
                colors.text = hslToHex(baseHue, 25, 15 + Math.floor(Math.random() * 15));
                colors.title = hslToHex(baseHue, 30, 20 + Math.floor(Math.random() * 15));
                
                // ìƒê°/í†µì‹ : í¬ì¸íŠ¸ ì»¬ëŸ¬
                colors.thought = hslToHex(secondaryHue, 50 + Math.floor(Math.random() * 35), 50 + Math.floor(Math.random() * 15));
                colors.comm = hslToHex((accentHue + 60) % 360, 55 + Math.floor(Math.random() * 30), 45 + Math.floor(Math.random() * 15));
                
                // ì´ë¦„í‘œ
                colors.nameAi = hslToHex(baseHue, 20, 30 + Math.floor(Math.random() * 15));
                colors.nameUser = hslToHex(accentHue, 70, 45 + Math.floor(Math.random() * 15));
                
                // ë°°ê²½ ì ìš© (ë‹¨ìƒ‰ ë˜ëŠ” ê·¸ë¼ë°ì´ì…˜)
                applyRandomBackground(isDark, baseHue, accentHue);
            }
            
            // ìƒ‰ìƒ ì…ë ¥ í•„ë“œì— ì ìš©
            document.getElementById('color-text').value = colors.text;
            document.getElementById('color-text-text').value = colors.text;
            document.getElementById('color-ai-bg').value = colors.aiBg;
            document.getElementById('color-ai-bg-text').value = colors.aiBg;
            document.getElementById('color-user-bg').value = colors.userBg;
            document.getElementById('color-user-bg-text').value = colors.userBg;
            document.getElementById('color-ai-text').value = colors.aiText;
            document.getElementById('color-ai-text-text').value = colors.aiText;
            document.getElementById('color-user-text').value = colors.userText;
            document.getElementById('color-user-text-text').value = colors.userText;
            document.getElementById('color-thought').value = colors.thought;
            document.getElementById('color-thought-text').value = colors.thought;
            document.getElementById('color-comm').value = colors.comm;
            document.getElementById('color-comm-text').value = colors.comm;
            document.getElementById('color-name-ai').value = colors.nameAi;
            document.getElementById('color-name-ai-text').value = colors.nameAi;
            document.getElementById('color-name-user').value = colors.nameUser;
            document.getElementById('color-name-user-text').value = colors.nameUser;
            document.getElementById('color-title').value = colors.title;
            document.getElementById('color-title-text').value = colors.title;
            
            // ë¯¸ë¦¬ë³´ê¸°ì— ì ìš©
            applyCustomColors();
            applyBackground();
        }

        // ========== ì»¤ìŠ¤í…€ í…Œë§ˆ ì €ì¥ ==========
        function saveCustomTheme() {
            const name = prompt('í…Œë§ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;
            
            const theme = {
                name: name,
                colors: {
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                },
                background: {
                    type: document.getElementById('bg-type').value,
                    solidColor: document.getElementById('bg-solid-color').value,
                    gradient: document.getElementById('gradient-select').value,
                    gradientStart: document.getElementById('gradient-start').value,
                    gradientEnd: document.getElementById('gradient-end').value,
                    gradientAngle: document.getElementById('gradient-angle').value
                }
            };
            
            let savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            savedThemes.push(theme);
            localStorage.setItem('customThemes', JSON.stringify(savedThemes));
            renderSavedThemes();
        }

        function renderSavedThemes() {
            const container = document.getElementById('saved-themes');
            const savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            
            if (savedThemes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<div style="font-size:12px; color:var(--text-secondary); margin-bottom:8px;">ì €ì¥ëœ í…Œë§ˆ:</div>' +
                savedThemes.map((t, i) => `
                    <div style="display:flex; gap:6px; margin-bottom:6px;">
                        <button class="btn btn-secondary" style="flex:1; padding:8px;" onclick="loadCustomTheme(${i})">${t.name}</button>
                        <button style="padding:8px 10px; background:#228be6; color:white; border:none; border-radius:8px; cursor:pointer;" onclick="updateCustomTheme(${i})" title="í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ìˆ˜ì •">âœï¸</button>
                        <button style="padding:8px 10px; background:#e03131; color:white; border:none; border-radius:8px; cursor:pointer;" onclick="deleteCustomTheme(${i})" title="ì‚­ì œ">Ã—</button>
                    </div>
                `).join('');
        }

        function loadCustomTheme(index) {
            const savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            const theme = savedThemes[index];
            if (!theme) return;
            
            document.getElementById('color-text').value = theme.colors.text;
            document.getElementById('color-text-text').value = theme.colors.text;
            document.getElementById('color-ai-bg').value = theme.colors.aiBg;
            document.getElementById('color-ai-bg-text').value = theme.colors.aiBg;
            document.getElementById('color-user-bg').value = theme.colors.userBg;
            document.getElementById('color-user-bg-text').value = theme.colors.userBg;
            document.getElementById('color-ai-text').value = theme.colors.aiText || '#1d2129';
            document.getElementById('color-ai-text-text').value = theme.colors.aiText || '#1d2129';
            document.getElementById('color-user-text').value = theme.colors.userText || '#ffffff';
            document.getElementById('color-user-text-text').value = theme.colors.userText || '#ffffff';
            document.getElementById('color-thought').value = theme.colors.thought;
            document.getElementById('color-thought-text').value = theme.colors.thought;
            document.getElementById('color-comm').value = theme.colors.comm;
            document.getElementById('color-comm-text').value = theme.colors.comm;
            document.getElementById('color-name-ai').value = theme.colors.nameAi;
            document.getElementById('color-name-ai-text').value = theme.colors.nameAi;
            document.getElementById('color-name-user').value = theme.colors.nameUser;
            document.getElementById('color-name-user-text').value = theme.colors.nameUser;
            document.getElementById('color-title').value = theme.colors.title;
            document.getElementById('color-title-text').value = theme.colors.title;
            
            // ë°°ê²½ ì„¤ì • ë¡œë“œ
            if (theme.background) {
                document.getElementById('bg-type').value = theme.background.type || 'solid';
                document.getElementById('bg-solid-color').value = theme.background.solidColor || '#ffffff';
                document.getElementById('bg-solid-color-text').value = theme.background.solidColor || '#ffffff';
                document.getElementById('gradient-select').value = theme.background.gradient || 'custom';
                document.getElementById('gradient-start').value = theme.background.gradientStart || '#667eea';
                document.getElementById('gradient-start-text').value = theme.background.gradientStart || '#667eea';
                document.getElementById('gradient-end').value = theme.background.gradientEnd || '#764ba2';
                document.getElementById('gradient-end-text').value = theme.background.gradientEnd || '#764ba2';
                document.getElementById('gradient-angle').value = theme.background.gradientAngle || '135';
                
                document.getElementById('bg-type').dispatchEvent(new Event('change'));
            }
            
            applyCustomColors();
            applyBackground();
        }

        function updateCustomTheme(index) {
            const savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            const theme = savedThemes[index];
            if (!theme) return;
            
            if (!confirm(`"${theme.name}" í…Œë§ˆë¥¼ ì§€ê¸ˆ ì…‹íŒ…ìœ¼ë¡œ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            savedThemes[index] = {
                name: theme.name,
                colors: {
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                },
                background: {
                    type: document.getElementById('bg-type').value,
                    solidColor: document.getElementById('bg-solid-color').value,
                    gradient: document.getElementById('gradient-select').value,
                    gradientStart: document.getElementById('gradient-start').value,
                    gradientEnd: document.getElementById('gradient-end').value,
                    gradientAngle: document.getElementById('gradient-angle').value
                }
            };
            
            localStorage.setItem('customThemes', JSON.stringify(savedThemes));
            renderSavedThemes();
            alert('í…Œë§ˆê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function deleteCustomTheme(index) {
            let savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            savedThemes.splice(index, 1);
            localStorage.setItem('customThemes', JSON.stringify(savedThemes));
            renderSavedThemes();
        }

        // ========== ìŠ¤íƒ€ì¼ ì ìš© ==========
        function applyStyles() {
            const preview = document.getElementById('log-preview');
            preview.style.setProperty('--log-width', document.getElementById('style-width').value + 'px');
            preview.style.setProperty('--log-radius', document.getElementById('style-radius').value + 'px');
            preview.style.setProperty('--log-font-size', document.getElementById('style-font-size').value + 'px');
            preview.style.setProperty('--log-line-height', document.getElementById('style-line-height').value);
            
            preview.style.width = document.getElementById('style-width').value + 'px';
            preview.style.borderRadius = document.getElementById('style-radius').value + 'px';
            preview.style.fontSize = document.getElementById('style-font-size').value + 'px';
            preview.style.lineHeight = document.getElementById('style-line-height').value;
        }

        // ========== ì¶”ê°€ ìºë¦­í„° ê´€ë¦¬ ==========
        let extraCharacters = []; // {id: 'CHAR-01', name: 'ìºë¦­í„°1', bgColor: '#...', textColor: '#...', nameColor: '#...'}
        
        function addExtraCharacter() {
            if (extraCharacters.length >= 10) {
                alert('ìµœëŒ€ 10ëª…ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const charNum = String(extraCharacters.length + 1).padStart(2, '0');
            const charId = `CHAR-${charNum}`;
            
            extraCharacters.push({
                id: charId,
                name: `ìºë¦­í„°${extraCharacters.length + 1}`,
                bgColor: '#e9ecef',
                textColor: '#1d2129',
                nameColor: '#868e96'
            });
            
            renderExtraCharacters();
            updateAddCharButton();
            generateLog();
        }
        
        function removeExtraCharacter(index) {
            extraCharacters.splice(index, 1);
            // ID ì¬ì •ë ¬
            extraCharacters.forEach((char, i) => {
                char.id = `CHAR-${String(i + 1).padStart(2, '0')}`;
            });
            renderExtraCharacters();
            updateAddCharButton();
            generateLog();
        }
        
        function updateAddCharButton() {
            const btn = document.getElementById('add-char-btn');
            if (extraCharacters.length >= 10) {
                btn.style.display = 'none';
            } else {
                btn.style.display = 'block';
            }
        }
        
        function renderExtraCharacters() {
            const container = document.getElementById('extra-characters-container');
            container.innerHTML = extraCharacters.map((char, index) => `
                <div class="extra-char-item" data-char-index="${index}">
                    <span class="char-id">${char.id}:</span>
                    <input type="text" value="${char.name}" placeholder="ìºë¦­í„° ì´ë¦„" 
                           onchange="updateExtraCharName(${index}, this.value)" oninput="generateLog()">
                    <button class="btn-color-edit" onclick="openCharColorPopup(${index})" title="ìƒ‰ìƒ ì„¤ì •">ğŸ¨</button>
                    <button class="btn-delete-char" onclick="removeExtraCharacter(${index})" title="ì‚­ì œ">Ã—</button>
                </div>
            `).join('');
        }
        
        function updateExtraCharName(index, name) {
            extraCharacters[index].name = name;
            generateLog();
        }
        
        function openCharColorPopup(index) {
            const char = extraCharacters[index];
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.onclick = () => closeCharColorPopup();
            document.body.appendChild(overlay);
            
            const popup = document.createElement('div');
            popup.className = 'char-color-popup';
            popup.id = 'char-color-popup';
            popup.innerHTML = `
                <div class="popup-drag-header" id="char-popup-drag-header">
                    <h3>ğŸ¨ ${char.name} ìƒ‰ìƒ ì„¤ì •</h3>
                    <span class="drag-hint">ë“œë˜ê·¸í•˜ì—¬ ì´ë™</span>
                </div>
                <div class="popup-content">
                    <div class="input-group">
                        <label class="input-label">ë§í’ì„  ë°°ê²½</label>
                        <div class="color-row">
                            <input type="color" id="char-bg-color" value="${char.bgColor}" onchange="updateCharColor(${index}, 'bgColor', this.value)">
                            <input type="text" id="char-bg-text" value="${char.bgColor}" onchange="updateCharColor(${index}, 'bgColor', this.value)">
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">ë§í’ì„  ê¸€ì</label>
                        <div class="color-row">
                            <input type="color" id="char-text-color" value="${char.textColor}" onchange="updateCharColor(${index}, 'textColor', this.value)">
                            <input type="text" id="char-text-text" value="${char.textColor}" onchange="updateCharColor(${index}, 'textColor', this.value)">
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">ì´ë¦„ ìƒ‰ìƒ</label>
                        <div class="color-row">
                            <input type="color" id="char-name-color" value="${char.nameColor}" onchange="updateCharColor(${index}, 'nameColor', this.value)">
                            <input type="text" id="char-name-text" value="${char.nameColor}" onchange="updateCharColor(${index}, 'nameColor', this.value)">
                        </div>
                    </div>
                    <div style="display:flex; gap:8px; margin-top:15px;">
                        <button class="btn btn-secondary" onclick="randomizeCharColors(${index})" style="flex:1;">ğŸ² ëœë¤</button>
                        <button class="btn btn-primary" onclick="closeCharColorPopup()" style="flex:1;">í™•ì¸</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
            
            // ë“œë˜ê·¸ ê¸°ëŠ¥ ì´ˆê¸°í™”
            initDraggable(popup, document.getElementById('char-popup-drag-header'));
        }
        
        // ìºë¦­í„° ìƒ‰ìƒ ëœë¤ ìƒì„±
        function randomizeCharColors(index) {
            // ì¡°í™”ë¡œìš´ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„±
            const colors = generateHarmoniousColors();
            
            // ìƒ‰ìƒ ì ìš©
            extraCharacters[index].bgColor = colors.bgColor;
            extraCharacters[index].textColor = colors.textColor;
            extraCharacters[index].nameColor = colors.nameColor;
            
            // íŒì—… ë‚´ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('char-bg-color').value = colors.bgColor;
            document.getElementById('char-bg-text').value = colors.bgColor;
            document.getElementById('char-text-color').value = colors.textColor;
            document.getElementById('char-text-text').value = colors.textColor;
            document.getElementById('char-name-color').value = colors.nameColor;
            document.getElementById('char-name-text').value = colors.nameColor;
            
            generateLog();
        }
        
        // ì¡°í™”ë¡œìš´ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„± í•¨ìˆ˜
        function generateHarmoniousColors() {
            // ëœë¤ Hue ì„ íƒ (0-360)
            const baseHue = Math.floor(Math.random() * 360);
            
            // ë°ì€ ë°°ê²½ vs ì–´ë‘ìš´ ë°°ê²½ ëœë¤ ì„ íƒ
            const isDarkBg = Math.random() > 0.5;
            
            let bgColor, textColor, nameColor;
            
            if (isDarkBg) {
                // ì–´ë‘ìš´ ë°°ê²½: ì±„ë„ ë‚®ê³  ëª…ë„ ë‚®ì€ ìƒ‰ìƒ
                const bgSat = 30 + Math.floor(Math.random() * 40); // 30-70
                const bgLight = 15 + Math.floor(Math.random() * 20); // 15-35
                bgColor = hslToHex(baseHue, bgSat, bgLight);
                
                // ë°ì€ ê¸€ììƒ‰
                textColor = hslToHex(baseHue, 10, 90 + Math.floor(Math.random() * 10)); // ê±°ì˜ í°ìƒ‰
                
                // í¬ì¸íŠ¸ ì´ë¦„ ìƒ‰ìƒ (ë°ê³  ì±„ë„ ë†’ì€)
                const nameHue = (baseHue + 30 + Math.floor(Math.random() * 60)) % 360; // ìœ ì‚¬ìƒ‰ ë˜ëŠ” ë³´ìƒ‰
                nameColor = hslToHex(nameHue, 60 + Math.floor(Math.random() * 30), 60 + Math.floor(Math.random() * 20));
            } else {
                // ë°ì€ ë°°ê²½: ì±„ë„ ë‚®ê³  ëª…ë„ ë†’ì€ ìƒ‰ìƒ
                const bgSat = 20 + Math.floor(Math.random() * 40); // 20-60
                const bgLight = 85 + Math.floor(Math.random() * 12); // 85-97
                bgColor = hslToHex(baseHue, bgSat, bgLight);
                
                // ì–´ë‘ìš´ ê¸€ììƒ‰
                textColor = hslToHex(baseHue, 20, 15 + Math.floor(Math.random() * 15)); // ê±°ì˜ ê²€ì •
                
                // í¬ì¸íŠ¸ ì´ë¦„ ìƒ‰ìƒ (ì–´ë‘¡ê³  ì±„ë„ ë†’ì€)
                const nameHue = (baseHue + 30 + Math.floor(Math.random() * 60)) % 360;
                nameColor = hslToHex(nameHue, 50 + Math.floor(Math.random() * 40), 35 + Math.floor(Math.random() * 25));
            }
            
            return { bgColor, textColor, nameColor };
        }
        
        // HSLì„ HEXë¡œ ë³€í™˜
        function hslToHex(h, s, l) {
            s /= 100;
            l /= 100;
            const a = s * Math.min(l, 1 - l);
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }
        
        function updateCharColor(index, colorType, value) {
            extraCharacters[index][colorType] = value;
            generateLog();
        }
        
        function closeCharColorPopup() {
            const popup = document.getElementById('char-color-popup');
            const overlay = document.querySelector('.popup-overlay');
            if (popup) popup.remove();
            if (overlay) overlay.remove();
        }

        // ========== ì´ë¯¸ì§€ ì—…ë¡œë“œ ==========
        let uploadedImages = []; // {data: base64, blockNumber: number}
        
        document.getElementById('image-file-input').addEventListener('change', function(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            Array.from(files).forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`íŒŒì¼ "${file.name}"ì˜ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    // ë‹¤ìŒ ë¸”ë¡ ë²ˆí˜¸ ìë™ í• ë‹¹ (ê¸°ì¡´ ì´ë¯¸ì§€ ì¤‘ ê°€ì¥ í° ë²ˆí˜¸ + 1, ë˜ëŠ” 1)
                    const nextBlockNum = uploadedImages.length > 0 
                        ? Math.max(...uploadedImages.map(img => img.blockNumber)) + 1 
                        : 1;
                    uploadedImages.push({
                        data: event.target.result,
                        blockNumber: nextBlockNum,
                        name: file.name
                    });
                    renderImageList();
                    generateLog();
                };
                reader.readAsDataURL(file);
            });
            
            // ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
            e.target.value = '';
        });
        
        function renderImageList() {
            const container = document.getElementById('image-list');
            if (uploadedImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div style="display:flex; flex-direction:column; gap:8px;">';
            uploadedImages.forEach((img, index) => {
                html += `
                    <div class="image-item" style="display:flex; align-items:center; gap:8px; padding:8px; background:var(--input-bg); border-radius:8px; border:1px solid var(--border-color);">
                        <img src="${img.data}" style="width:50px; height:50px; object-fit:cover; border-radius:6px; flex-shrink:0;">
                        <div style="flex:1; min-width:0;">
                            <div style="font-size:11px; color:var(--text-secondary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(img.name)}</div>
                            <div style="display:flex; align-items:center; gap:4px; margin-top:4px;">
                                <span style="font-size:11px; color:var(--text-secondary);">ë¸”ë¡</span>
                                <input type="number" value="${img.blockNumber}" min="0" 
                                    onchange="updateImageBlockNumber(${index}, this.value)"
                                    style="width:50px; padding:4px 6px; font-size:12px; border:1px solid var(--border-color); border-radius:4px; background:var(--bg-color); color:var(--text-color);">
                                <span style="font-size:10px; color:var(--text-secondary);">ë²ˆ ì•ì— ì‚½ì…</span>
                            </div>
                        </div>
                        <button onclick="removeImage(${index})" style="padding:4px 8px; background:#e03131; color:white; border:none; border-radius:4px; cursor:pointer; font-size:12px;">âœ•</button>
                    </div>`;
            });
            html += '</div>';
            html += '<div style="font-size:10px; color:var(--text-secondary); margin-top:6px;">ğŸ’¡ 0ë²ˆ = ì œëª© ë°”ë¡œ ì•„ë˜, 1ë²ˆ = ì²« ë²ˆì§¸ ë¸”ë¡ ì•</div>';
            container.innerHTML = html;
        }
        
        function updateImageBlockNumber(index, value) {
            const num = parseInt(value) || 0;
            uploadedImages[index].blockNumber = num;
            generateLog();
        }
        
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImageList();
            generateLog();
        }
        
        function clearAllImages() {
            uploadedImages = [];
            renderImageList();
            generateLog();
        }

        // ========== ë°°ê²½ ì„¤ì • ==========
        document.getElementById('bg-type').addEventListener('change', function() {
            const solidOptions = document.getElementById('bg-solid-options');
            const gradientOptions = document.getElementById('bg-gradient-options');
            
            if (this.value === 'solid') {
                solidOptions.style.display = 'block';
                gradientOptions.style.display = 'none';
            } else {
                solidOptions.style.display = 'none';
                gradientOptions.style.display = 'block';
            }
            applyBackground();
        });
        
        // ë°°ê²½ ë‹¨ìƒ‰ ìƒ‰ìƒ ë™ê¸°í™” + ì‹¤ì‹œê°„ ì ìš©
        document.getElementById('bg-solid-color').addEventListener('input', function() {
            document.getElementById('bg-solid-color-text').value = this.value;
            applyBackground();
        });
        document.getElementById('bg-solid-color-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('bg-solid-color').value = this.value;
                applyBackground();
            }
        });
        
        // ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ë™ê¸°í™” + ì‹¤ì‹œê°„ ì ìš© + í”„ë¦¬ì…‹ì„ ì§ì ‘ ì„¤ì •ìœ¼ë¡œ ë³€ê²½
        document.getElementById('gradient-start').addEventListener('input', function() {
            document.getElementById('gradient-start-text').value = this.value;
            document.getElementById('gradient-select').value = 'custom';
            applyBackground();
        });
        document.getElementById('gradient-start-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('gradient-start').value = this.value;
                document.getElementById('gradient-select').value = 'custom';
                applyBackground();
            }
        });
        document.getElementById('gradient-end').addEventListener('input', function() {
            document.getElementById('gradient-end-text').value = this.value;
            document.getElementById('gradient-select').value = 'custom';
            applyBackground();
        });
        document.getElementById('gradient-end-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('gradient-end').value = this.value;
                document.getElementById('gradient-select').value = 'custom';
                applyBackground();
            }
        });
        document.getElementById('gradient-angle').addEventListener('input', function() {
            applyBackground();
        });
        
        // ê·¸ë¼ë°ì´ì…˜ í”„ë¦¬ì…‹ ì„ íƒì‹œ ìƒ‰ìƒ ì¶”ì¶œ + ì‹¤ì‹œê°„ ì ìš©
        document.getElementById('gradient-select').addEventListener('change', function() {
            if (this.value !== 'custom') {
                // í”„ë¦¬ì…‹ì—ì„œ ìƒ‰ìƒ ì¶”ì¶œ
                const match = this.value.match(/#([0-9A-Fa-f]{6})/g);
                if (match && match.length >= 2) {
                    document.getElementById('gradient-start').value = match[0];
                    document.getElementById('gradient-start-text').value = match[0];
                    document.getElementById('gradient-end').value = match[1];
                    document.getElementById('gradient-end-text').value = match[1];
                }
            }
            applyBackground();
        });
        
        function applyBackground() {
            const preview = document.getElementById('log-preview');
            const bgType = document.getElementById('bg-type').value;
            
            if (bgType === 'solid') {
                const color = document.getElementById('bg-solid-color').value;
                preview.style.background = color;
                preview.style.setProperty('--log-bg', color);
            } else {
                const start = document.getElementById('gradient-start').value;
                const end = document.getElementById('gradient-end').value;
                const angle = document.getElementById('gradient-angle').value;
                const gradient = `linear-gradient(${angle}deg, ${start} 0%, ${end} 100%)`;
                preview.style.background = gradient;
            }
        }

        // ========== ì™¸ê³½ í…Œë§ˆ ì„ íƒ ==========
        document.getElementById('frame-select').addEventListener('change', function() {
            const preview = document.getElementById('log-preview');
            // ëª¨ë“  í”„ë ˆì„ í´ë˜ìŠ¤ ì œê±°
            preview.classList.remove('frame-letter', 'frame-diary', 'frame-memo', 'frame-gold', 'frame-ornate', 'frame-check', 'frame-tape', 'frame-vintage', 'frame-polaroid', 'frame-neon', 'frame-cute', 'frame-minimal');
            
            if (this.value !== 'none') {
                preview.classList.add('frame-' + this.value);
            }
            
            // ì™¸ê³½ ì¥ì‹ ì—…ë°ì´íŠ¸
            setTimeout(() => addFrameDecorations(), 50);
        });

        // ========== í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ==========
        function collectPresetData() {
            // ì •ê·œì‹ ê·œì¹™ ìˆ˜ì§‘
            const regexRules = [];
            document.querySelectorAll('.rule-item').forEach(item => {
                const find = item.querySelector('.rule-find').value;
                const replace = item.querySelector('.rule-replace').value;
                if (find || replace) {
                    regexRules.push({ find, replace });
                }
            });
            
            return {
                colors: {
                    bg: document.getElementById('bg-solid-color').value,
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                },
                bgType: document.getElementById('bg-type').value,
                gradient: document.getElementById('gradient-select').value,
                gradientStart: document.getElementById('gradient-start').value,
                gradientEnd: document.getElementById('gradient-end').value,
                gradientAngle: document.getElementById('gradient-angle').value,
                frame: document.getElementById('frame-select').value,
                style: {
                    width: document.getElementById('style-width').value,
                    radius: document.getElementById('style-radius').value,
                    fontSize: document.getElementById('style-font-size').value,
                    lineHeight: document.getElementById('style-line-height').value
                },
                input: {
                    aiModel: document.getElementById('ai-model-input').value,
                    promptName: document.getElementById('prompt-name').value,
                    translation: document.getElementById('translation-input').value,
                    nameAi: document.getElementById('name-ai').value,
                    nameUser: document.getElementById('name-user').value,
                    charLink: document.getElementById('char-link').value
                },
                regexRules: regexRules,
                blockFolding: document.getElementById('block-folding').checked,
                extraCharacters: JSON.parse(JSON.stringify(extraCharacters)) // ê¹Šì€ ë³µì‚¬
            };
        }
        
        function savePreset() {
            const name = prompt('í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;
            
            const preset = collectPresetData();
            preset.name = name;
            
            let savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            savedPresets.push(preset);
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderPresetListPanel();
        }

        function renderSavedPresets() {
            // ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ - renderPresetListPanel()ë¡œ ëŒ€ì²´
            renderPresetListPanel();
        }

        function loadPreset(index) {
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            const preset = savedPresets[index];
            if (!preset) return;
            
            applyPresetData(preset);
        }

        function updatePreset(index) {
            updatePresetFromPanel(index);
        }

        function deletePreset(index) {
            deletePresetFromPanel(index);
        }

        function exportPreset() {
            const preset = collectPresetData();
            
            const blob = new Blob([JSON.stringify(preset, null, 2)], {type: 'application/json'});
            const link = document.createElement('a');
            link.download = 'log-cupcake-preset.json';
            link.href = URL.createObjectURL(blob);
            link.click();
        }

        // ========== ì´ˆê¸°í™” í•¨ìˆ˜ ==========
        function resetAll() {
            if (!confirm('ëª¨ë“  ì…ë ¥ê°’ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            // ì œëª© ì´ˆê¸°í™”
            document.getElementById('log-title').value = '';
            document.getElementById('log-subtitle').value = '';
            document.getElementById('ai-model').value = '';
            document.getElementById('ai-model-input').value = '';
            document.getElementById('prompt-name').value = '';
            document.getElementById('translation').value = '';
            document.getElementById('translation-input').value = '';
            document.getElementById('char-link').value = '';
            
            // ìºë¦­í„° ì´ë¦„ ì´ˆê¸°í™”
            document.getElementById('name-ai').value = 'AI';
            document.getElementById('name-user').value = 'USER';
            
            // ì´ë¯¸ì§€ ì´ˆê¸°í™”
            uploadedImages = [];
            renderImageList();
            
            // ë¡œê·¸ ë¸”ë¡ ì´ˆê¸°í™” (ì²« ë²ˆì§¸ ë¸”ë¡ë§Œ ë‚¨ê¸°ê³  ë‚´ìš© ë¹„ìš°ê¸°)
            const container = document.getElementById('log-blocks-container');
            container.innerHTML = `
                <div class="log-block" data-block-id="1">
                    <div class="log-block-header" onclick="toggleBlock(this)">
                        <div class="log-block-title">
                            <span>ğŸ“</span>
                            <input type="text" value="ë¸”ë¡ 1" onclick="event.stopPropagation()" onchange="updateBlockTitle(this)">
                        </div>
                        <div class="log-block-actions">
                            <button class="btn-popup-edit" onclick="event.stopPropagation(); openPopupEditor(this)" title="íŒì—… í¸ì§‘">ğŸ“</button>
                            <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, -1)" title="ìœ„ë¡œ">â–²</button>
                            <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, 1)" title="ì•„ë˜ë¡œ">â–¼</button>
                            <button class="btn-toggle" title="ì ‘ê¸°/í¼ì¹˜ê¸°">â–¼</button>
                            <button class="btn-delete" onclick="event.stopPropagation(); deleteBlock(this)" title="ì‚­ì œ">Ã—</button>
                        </div>
                    </div>
                    <div class="log-block-content">
                        <textarea class="log-block-input" placeholder="AI: \\"ì•ˆë…•í•˜ì„¸ìš”\\"&#10;USER: 'ìƒê°...'&#10;- ë‚˜ë ˆì´ì…˜" oninput="generateLog()"></textarea>
                    </div>
                </div>
            `;
            blockIdCounter = 1;
            
            // ì •ê·œì‹ ê·œì¹™ ì´ˆê¸°í™”
            document.getElementById('rule-list').innerHTML = '';
            
            // í”„ë¦¬ë·° ì´ˆê¸°í™”
            generateLog();
            
            alert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ========== ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ ==========
        let blockIdCounter = 1;
        
        function addLogBlock() {
            blockIdCounter++;
            const container = document.getElementById('log-blocks-container');
            const block = document.createElement('div');
            block.className = 'log-block';
            block.dataset.blockId = blockIdCounter;
            block.innerHTML = `
                <div class="log-block-header" onclick="toggleBlock(this)">
                    <div class="log-block-title">
                        <span>ğŸ“</span>
                        <input type="text" value="ë¸”ë¡ ${blockIdCounter}" onclick="event.stopPropagation()" onchange="updateBlockTitle(this)">
                    </div>
                    <div class="log-block-actions">
                        <button class="btn-popup-edit" onclick="event.stopPropagation(); openPopupEditor(this)" title="íŒì—… í¸ì§‘">ğŸ“</button>
                        <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, -1)" title="ìœ„ë¡œ">â–²</button>
                        <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, 1)" title="ì•„ë˜ë¡œ">â–¼</button>
                        <button class="btn-toggle" title="ì ‘ê¸°/í¼ì¹˜ê¸°">â–¼</button>
                        <button class="btn-delete" onclick="event.stopPropagation(); deleteBlock(this)" title="ì‚­ì œ">Ã—</button>
                    </div>
                </div>
                <div class="log-block-content">
                    <textarea class="log-block-input" placeholder='AI: "ëŒ€ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”"'></textarea>
                </div>
            `;
            container.appendChild(block);
            
            // ìƒˆ ë¸”ë¡ì— ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì´ë²¤íŠ¸ ì¶”ê°€
            const textarea = block.querySelector('.log-block-input');
            textarea.addEventListener('input', () => {
                clearTimeout(window.inputTimeout);
                window.inputTimeout = setTimeout(generateLog, 300);
            });
        }
        
        function deleteBlock(btn) {
            const block = btn.closest('.log-block');
            const container = document.getElementById('log-blocks-container');
            
            // ìµœì†Œ 1ê°œ ë¸”ë¡ì€ ìœ ì§€
            if (container.querySelectorAll('.log-block').length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ë¸”ë¡ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì´ ë¸”ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                block.remove();
                generateLog();
            }
        }
        
        function moveBlock(btn, direction) {
            const block = btn.closest('.log-block');
            const container = document.getElementById('log-blocks-container');
            const blocks = Array.from(container.querySelectorAll('.log-block'));
            const index = blocks.indexOf(block);
            
            if (direction === -1 && index > 0) {
                // ìœ„ë¡œ ì´ë™
                container.insertBefore(block, blocks[index - 1]);
            } else if (direction === 1 && index < blocks.length - 1) {
                // ì•„ë˜ë¡œ ì´ë™
                container.insertBefore(blocks[index + 1], block);
            }
            
            generateLog();
        }
        
        function toggleBlock(header) {
            const content = header.nextElementSibling;
            const toggleBtn = header.querySelector('.btn-toggle');
            
            content.classList.toggle('collapsed');
            toggleBtn.textContent = content.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
        }
        
        function updateBlockTitle(input) {
            // ì œëª© ë³€ê²½ ì‹œ ë³„ë„ ë™ì‘ í•„ìš” ì—†ìŒ
        }
        
        // ========== íŒì—… í¸ì§‘ê¸° ==========
        let currentEditingBlock = null;
        let popupEditorInitialized = false;
        
        function openPopupEditor(btn) {
            const block = btn.closest('.log-block');
            const textarea = block.querySelector('.log-block-input');
            const titleInput = block.querySelector('.log-block-title input');
            const blockTitle = titleInput ? titleInput.value : 'ë¸”ë¡ í¸ì§‘';
            
            currentEditingBlock = textarea;
            
            // íŒì—… í¸ì§‘ê¸° ì—´ê¸°
            const overlay = document.getElementById('popup-editor-overlay');
            const popup = document.getElementById('popup-editor');
            const popupTextarea = document.getElementById('popup-editor-textarea');
            const popupTitle = document.getElementById('popup-editor-title');
            
            popupTitle.textContent = blockTitle;
            popupTextarea.value = textarea.value;
            
            overlay.classList.add('show');
            popup.classList.add('show');
            
            // ì´ˆê¸°í™” (ì²˜ìŒ ì—´ë¦´ ë•Œë§Œ)
            if (!popupEditorInitialized) {
                initPopupEditorDrag();
                initPopupEditorResize();
                popupEditorInitialized = true;
            }
            
            // í…ìŠ¤íŠ¸ì—ì–´ë¦¬ì–´ì— í¬ì»¤ìŠ¤
            setTimeout(() => popupTextarea.focus(), 100);
        }
        
        function closePopupEditor() {
            const overlay = document.getElementById('popup-editor-overlay');
            const popup = document.getElementById('popup-editor');
            
            // í˜„ì¬ í¸ì§‘ ë‚´ìš©ì„ ì›ë³¸ì— ì €ì¥
            if (currentEditingBlock) {
                const popupTextarea = document.getElementById('popup-editor-textarea');
                currentEditingBlock.value = popupTextarea.value;
                generateLog(); // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            }
            
            overlay.classList.remove('show');
            popup.classList.remove('show');
            currentEditingBlock = null;
        }
        
        function saveAndClosePopupEditor() {
            closePopupEditor();
        }
        
        // íŒì—… í¸ì§‘ê¸° ë“œë˜ê·¸ ê¸°ëŠ¥
        function initPopupEditorDrag() {
            const popup = document.getElementById('popup-editor');
            const header = document.getElementById('popup-editor-header');
            
            let isDragging = false;
            let startX, startY, initialX, initialY;
            let hasBeenDragged = false;
            
            header.addEventListener('mousedown', startDrag);
            header.addEventListener('touchstart', startDrag, { passive: false });
            
            function startDrag(e) {
                if (e.target.tagName === 'BUTTON') return;
                
                isDragging = true;
                
                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    startX = e.clientX;
                    startY = e.clientY;
                }
                
                // ì²˜ìŒ ë“œë˜ê·¸í•  ë•Œ transformì„ ì‹¤ì œ ìœ„ì¹˜ë¡œ ë³€í™˜
                if (!hasBeenDragged) {
                    const rect = popup.getBoundingClientRect();
                    popup.style.transform = 'none';
                    popup.style.left = rect.left + 'px';
                    popup.style.top = rect.top + 'px';
                    hasBeenDragged = true;
                }
                
                initialX = popup.offsetLeft;
                initialY = popup.offsetTop;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                let currentX, currentY;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                } else {
                    currentX = e.clientX;
                    currentY = e.clientY;
                }
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                let newX = initialX + deltaX;
                let newY = initialY + deltaY;
                
                // í™”ë©´ ê²½ê³„ ì²´í¬
                const rect = popup.getBoundingClientRect();
                const maxX = window.innerWidth - rect.width;
                const maxY = window.innerHeight - rect.height;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                popup.style.left = newX + 'px';
                popup.style.top = newY + 'px';
                
                e.preventDefault();
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            }
        }
        
        // íŒì—… í¸ì§‘ê¸° ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥
        function initPopupEditorResize() {
            const popup = document.getElementById('popup-editor');
            const handles = popup.querySelectorAll('.resize-handle');
            
            handles.forEach(handle => {
                handle.addEventListener('mousedown', startResize);
                handle.addEventListener('touchstart', startResize, { passive: false });
            });
            
            let isResizing = false;
            let currentHandle = null;
            let startX, startY, startWidth, startHeight, startLeft, startTop;
            
            function startResize(e) {
                isResizing = true;
                currentHandle = e.target.dataset.resize;
                
                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    startX = e.clientX;
                    startY = e.clientY;
                }
                
                // ì²˜ìŒ ë¦¬ì‚¬ì´ì¦ˆí•  ë•Œ transform ì œê±°
                const rect = popup.getBoundingClientRect();
                if (popup.style.transform && popup.style.transform !== 'none') {
                    popup.style.transform = 'none';
                    popup.style.left = rect.left + 'px';
                    popup.style.top = rect.top + 'px';
                }
                
                startWidth = rect.width;
                startHeight = rect.height;
                startLeft = popup.offsetLeft;
                startTop = popup.offsetTop;
                
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stopResize);
                document.addEventListener('touchmove', resize, { passive: false });
                document.addEventListener('touchend', stopResize);
                
                e.preventDefault();
                e.stopPropagation();
            }
            
            function resize(e) {
                if (!isResizing) return;
                
                let currentX, currentY;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                } else {
                    currentX = e.clientX;
                    currentY = e.clientY;
                }
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                const minWidth = 400;
                const minHeight = 300;
                
                if (currentHandle === 'se') {
                    popup.style.width = Math.max(minWidth, startWidth + deltaX) + 'px';
                    popup.style.height = Math.max(minHeight, startHeight + deltaY) + 'px';
                } else if (currentHandle === 'e') {
                    popup.style.width = Math.max(minWidth, startWidth + deltaX) + 'px';
                } else if (currentHandle === 's') {
                    popup.style.height = Math.max(minHeight, startHeight + deltaY) + 'px';
                }
                
                e.preventDefault();
            }
            
            function stopResize() {
                isResizing = false;
                currentHandle = null;
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
                document.removeEventListener('touchmove', resize);
                document.removeEventListener('touchend', stopResize);
            }
        }
        
        // íŒì—… í¸ì§‘ê¸° ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
        document.getElementById('popup-editor-textarea').addEventListener('input', function() {
            if (currentEditingBlock) {
                currentEditingBlock.value = this.value;
                // ë””ë°”ìš´ìŠ¤ ì²˜ë¦¬
                clearTimeout(window.popupInputTimeout);
                window.popupInputTimeout = setTimeout(generateLog, 200);
            }
        });
        
        // ========== ë¹ˆí‹°ì§€ í…Œë§ˆ ë§í’ì„  ë¬¼ê²° ë°°ê²½ ì¶”ê°€ ==========
        function addVintageBubbleBackgrounds(preview) {
            // ê¸°ì¡´ ë¬¼ê²° ë°°ê²½ ì œê±°
            preview.querySelectorAll('.vintage-bubble-bg').forEach(el => el.remove());
            
            // ëª¨ë“  ë§í’ì„ ì— ë¬¼ê²° ë°°ê²½ ìš”ì†Œ ì¶”ê°€
            const bubbles = preview.querySelectorAll('.bubble');
            bubbles.forEach(bubble => {
                // ì´ë¯¸ ë°°ê²½ì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
                if (bubble.querySelector('.vintage-bubble-bg')) return;
                
                const bgEl = document.createElement('div');
                bgEl.className = 'vintage-bubble-bg';
                
                // ë§í’ì„ ì˜ border-radius ìƒì†
                const computedStyle = window.getComputedStyle(bubble);
                bgEl.style.borderRadius = computedStyle.borderRadius || '18px';
                
                // ë§í’ì„  ë§¨ ì•ì— ì‚½ì… (í…ìŠ¤íŠ¸ ë’¤ì— ë°°ê²½ìœ¼ë¡œ)
                bubble.insertBefore(bgEl, bubble.firstChild);
            });
        }
        
        // ========== ì™¸ê³½ ì¥ì‹ ìƒì„± ==========
        function addFrameDecorations() {
            const preview = document.getElementById('log-preview');
            const frameType = document.getElementById('frame-select').value;
            
            // ê¸°ì¡´ ì¥ì‹ ì œê±°
            preview.querySelectorAll('.frame-decoration').forEach(el => el.remove());
            
            // ë¹ˆí‹°ì§€ í…Œë§ˆì¼ ë•Œ ë§í’ì„ ì— ë¬¼ê²° ë°°ê²½ ì¶”ê°€
            if (frameType === 'vintage') {
                addVintageBubbleBackgrounds(preview);
            } else {
                // ë¹ˆí‹°ì§€ê°€ ì•„ë‹ˆë©´ ë¬¼ê²° ë°°ê²½ ìš”ì†Œ ì œê±°
                preview.querySelectorAll('.vintage-bubble-bg').forEach(el => el.remove());
            }
            
            // ì¥ì‹ì´ í•„ìš”í•œ í”„ë ˆì„ íƒ€ì…ë§Œ ì²˜ë¦¬
            const supportedFrames = ['letter', 'diary', 'ornate', 'tape', 'polaroid'];
            if (!supportedFrames.includes(frameType)) return;
            
            const previewHeight = preview.scrollHeight;
            const previewWidth = preview.offsetWidth;
            
            // ë†’ì´ê°€ 400px ë¯¸ë§Œì´ë©´ ì¶”ê°€ ì¥ì‹ ì—†ìŒ
            if (previewHeight < 400) return;
            
            // ì¥ì‹ ê°„ê²© ê³„ì‚° (ì•½ 250-350px ë§ˆë‹¤)
            const decorationCount = Math.floor(previewHeight / 300);
            if (decorationCount <= 0) return;
            
            // ìºë¦­í„° ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ë‹¤ì´ì–´ë¦¬ìš©)
            const aiName = document.getElementById('name-ai').value || 'AI';
            const userName = document.getElementById('name-user').value || 'USER';
            const charNames = [aiName, userName];
            extraCharacters.forEach(char => {
                if (char.name) charNames.push(char.name);
            });
            
            for (let i = 1; i <= decorationCount; i++) {
                const yPos = (previewHeight / (decorationCount + 1)) * i + (Math.random() - 0.5) * 50;
                
                // ì™¼ìª½ ë˜ëŠ” ì˜¤ë¥¸ìª½ ëœë¤ ë°°ì¹˜
                const isLeft = Math.random() > 0.5;
                
                const deco = document.createElement('div');
                deco.className = 'frame-decoration';
                deco.style.top = yPos + 'px';
                
                switch (frameType) {
                    case 'letter':
                        // í¸ì§€ì§€ - ë‹¤ì–‘í•œ ê½ƒê³¼ ì‹ë¬¼
                        const flowers = ['ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒº', 'ğŸŒ·', 'ğŸ’', 'ğŸŒ¹', 'ğŸŒ»', 'ğŸª»', 'ğŸŒ¿', 'ğŸ€', 'ğŸŒ±', 'ğŸ’®', 'ğŸµï¸'];
                        deco.className += ' frame-deco-letter';
                        deco.textContent = flowers[Math.floor(Math.random() * flowers.length)];
                        const flowerRotation = (Math.random() - 0.5) * 60; // -30 ~ 30ë„
                        deco.style.transform = `rotate(${flowerRotation}deg)`;
                        if (isLeft) {
                            deco.style.left = (Math.random() * 15 - 5) + 'px';
                        } else {
                            deco.style.right = (Math.random() * 15 - 5) + 'px';
                        }
                        break;
                        
                    case 'diary':
                        // ë‹¤ì´ì–´ë¦¬ - í¬ìŠ¤íŠ¸ì‡ with ìºë¦­í„° ì´ë¦„
                        const postItColors = ['', 'pink', 'blue', 'green'];
                        deco.className += ' frame-deco-diary ' + postItColors[Math.floor(Math.random() * postItColors.length)];
                        deco.textContent = charNames[Math.floor(Math.random() * charNames.length)];
                        const postItRotation = 40 + Math.random() * 20; // 40 ~ 60ë„
                        const rotateDir = isLeft ? 1 : -1;
                        deco.style.transform = `rotate(${postItRotation * rotateDir}deg)`;
                        if (isLeft) {
                            deco.style.left = '-25px';
                        } else {
                            deco.style.right = '-25px';
                        }
                        break;
                        
                    case 'ornate':
                        // ì¥ì‹ í”„ë ˆì„ - ë³´ì„ë“¤
                        const gems = ['ğŸ’', 'ğŸ’ ', 'ğŸ”·', 'ğŸ”¶', 'âœ¨', 'â­', 'ğŸŒŸ'];
                        deco.className += ' frame-deco-ornate';
                        deco.textContent = gems[Math.floor(Math.random() * gems.length)];
                        if (isLeft) {
                            deco.style.left = '5px';
                        } else {
                            deco.style.right = '5px';
                        }
                        break;
                        
                    case 'tape':
                        // í…Œì´í”„ - ë‹¤ì–‘í•œ í¬ê¸°ì™€ ìƒ‰ìƒ, í° íšŒì „
                        const tapeColors = ['', 'color1', 'color2', 'color3'];
                        const tapeWidth = 45 + Math.random() * 40; // 45 ~ 85px
                        const tapeHeight = 18 + Math.random() * 12; // 18 ~ 30px
                        const tapeRotation = (Math.random() - 0.5) * 50; // -25 ~ 25ë„
                        deco.className += ' frame-deco-tape ' + tapeColors[Math.floor(Math.random() * tapeColors.length)];
                        deco.style.width = tapeWidth + 'px';
                        deco.style.height = tapeHeight + 'px';
                        deco.style.transform = `rotate(${tapeRotation}deg)`;
                        if (isLeft) {
                            deco.style.left = (-tapeWidth/3) + 'px';
                        } else {
                            deco.style.right = (-tapeWidth/3) + 'px';
                        }
                        break;
                        
                    case 'polaroid':
                        // í´ë¼ë¡œì´ë“œ - í•˜íŠ¸ì™€ ë³„ (ì™¸ê³½ì—ë„)
                        const polaroidSymbols = ['â™¡', 'â™¥', 'âœ§', 'âœ¦', 'â˜…', 'â˜†'];
                        deco.className += ' frame-deco-polaroid';
                        deco.textContent = polaroidSymbols[Math.floor(Math.random() * polaroidSymbols.length)];
                        if (isLeft) {
                            deco.style.left = '8px';
                        } else {
                            deco.style.right = '8px';
                        }
                        break;
                }
                
                preview.appendChild(deco);
            }
        }
        
        // ========== ë¡œê·¸ íŒŒì‹± ë° ìƒì„± ==========
        function generateLog() {
            // í˜„ì¬ í”„ë ˆì„ íƒ€ì… ê°€ì ¸ì˜¤ê¸°
            const currentFrameType = document.getElementById('frame-select').value;
            
            // ê° ë¸”ë¡ì˜ ë‚´ìš©ì„ ê°œë³„ì ìœ¼ë¡œ ìˆ˜ì§‘
            const blockElements = document.querySelectorAll('.log-block-input');
            const blockContents = Array.from(blockElements).map(textarea => textarea.value);
            
            // ì •ê·œì‹ ì¹˜í™˜ì„ ê° ë¸”ë¡ì— ì ìš©
            const processedBlocks = blockContents.map(blockText => {
                document.querySelectorAll('.rule-item').forEach(item => {
                    const find = item.querySelector('.rule-find').value;
                    const replace = item.querySelector('.rule-replace').value;
                    if (find) {
                        try {
                            const regex = new RegExp(find, 'g');
                            blockText = blockText.replace(regex, replace);
                        } catch (e) {
                            console.error('ì •ê·œì‹ ì˜¤ë¥˜:', e);
                        }
                    }
                });
                return blockText;
            });

            const preview = document.getElementById('log-preview');
            let html = '';

            // ìºë¦­í„° ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ì œëª©ì—ì„œ ì‚¬ìš©í•˜ë¯€ë¡œ ë¨¼ì € ì •ì˜)
            const aiName = document.getElementById('name-ai').value || 'AI';
            const userName = document.getElementById('name-user').value || 'USER';

            // ì œëª© ì¶”ê°€
            const title = document.getElementById('log-title').value;
            const subtitle = document.getElementById('log-subtitle').value;
            const aiModel = document.getElementById('ai-model-input').value;
            const promptName = document.getElementById('prompt-name').value;
            const translation = document.getElementById('translation-input').value;
            const charLink = document.getElementById('char-link').value;
            
            if (title || subtitle || aiModel || promptName || translation || charLink) {
                html += '<div class="log-title">';
                if (title) html += `<h2>${escapeHtml(title)}</h2>`;
                if (subtitle) html += `<p>${escapeHtml(subtitle)}</p>`;
                
                // ë©”íƒ€ ì •ë³´
                const metaItems = [];
                if (aiModel) metaItems.push(`ğŸ§ ${escapeHtml(aiModel)}`);
                if (promptName) metaItems.push(`ğŸ’ ${escapeHtml(promptName)}`);
                if (translation) metaItems.push(`ğŸ’Œ ${escapeHtml(translation)}`);
                if (charLink) metaItems.push(`<a href="${escapeHtml(charLink)}" target="_blank">ğŸ­ ${escapeHtml(aiName)}</a>`);
                
                if (metaItems.length > 0) {
                    html += '<div class="log-meta">';
                    metaItems.forEach(item => {
                        html += `<span class="log-meta-item">${item}</span>`;
                    });
                    html += '</div>';
                }
                html += '</div>';
            }

            // ë¸”ë¡ ë²ˆí˜¸ 0ì— í• ë‹¹ëœ ì´ë¯¸ì§€ (ì œëª© ë°”ë¡œ ì•„ë˜)
            const headerImages = uploadedImages.filter(img => img.blockNumber === 0);
            headerImages.forEach(img => {
                html += `<div class="log-image"><img src="${img.data}" alt="Image"></div>`;
            });

            // ê° ë¸”ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ ì²˜ë¦¬
            processedBlocks.forEach((blockText, blockIndex) => {
                const blockNumber = blockIndex + 1; // 1-based ë¸”ë¡ ë²ˆí˜¸
                
                // ì´ ë¸”ë¡ ì•ì— ì‚½ì…í•  ì´ë¯¸ì§€ë“¤
                const blockImages = uploadedImages.filter(img => img.blockNumber === blockNumber);
                blockImages.forEach(img => {
                    html += `<div class="log-image"><img src="${img.data}" alt="Image"></div>`;
                });
                
                // ë¸”ë¡ ì‚¬ì´ êµ¬ë¶„ì„  (ì²« ë²ˆì§¸ ë¸”ë¡ì´ ì•„ë‹Œ ê²½ìš°)
                if (blockIndex > 0) {
                    html += '<div class="divider"></div>';
                }
                
                const lines = blockText.split('\n');
                let currentSpeaker = null;
                let currentSpeakerType = null; // 'AI', 'USER', or char index
                let currentBubbles = [];

                function flushBubbles() {
                    if (currentSpeaker && currentBubbles.length > 0) {
                        let speakerClass = '';
                        let displayName = '';
                        let customStyle = '';
                        
                        if (currentSpeakerType === 'AI') {
                            speakerClass = 'ai';
                            displayName = aiName;
                        } else if (currentSpeakerType === 'USER') {
                            speakerClass = 'user';
                            displayName = userName;
                        } else if (typeof currentSpeakerType === 'number') {
                            // ì¶”ê°€ ìºë¦­í„°
                            const char = extraCharacters[currentSpeakerType];
                            speakerClass = 'ai'; // ì™¼ìª½ ì •ë ¬
                            displayName = char.name;
                            customStyle = `--extra-char-bg:${char.bgColor};--extra-char-text:${char.textColor};--extra-char-name:${char.nameColor};`;
                        }
                        
                        html += `<div class="chat-block ${speakerClass}" ${customStyle ? `style="${customStyle}"` : ''}>`;
                        html += `<div class="speaker-name" ${typeof currentSpeakerType === 'number' ? `style="color:${extraCharacters[currentSpeakerType].nameColor}"` : ''}>${escapeHtml(displayName)}</div>`;
                        html += '<div class="bubbles">';
                        currentBubbles.forEach(bubble => {
                            html += bubble;
                        });
                        html += '</div></div>';
                        
                        currentBubbles = [];
                    }
                }
                
                // AI/USERìš© ë§í’ì„  ì²˜ë¦¬
                function processBubbleContent(content) {
                    // í†µì‹  ë©”ì‹œì§€ (> ë¡œ ì‹œì‘)
                    if (content.startsWith('>')) {
                        content = content.substring(1).trim();
                        currentBubbles.push(`<div class="bubble comm">${processMarkdown(content)}</div>`);
                    }
                    // ì†ì‚­ì„ ((...) ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if (content.startsWith('((') && content.endsWith('))')) {
                        content = content.slice(2, -2).trim();
                        currentBubbles.push(`<div class="bubble whisper">${processMarkdown(content)}</div>`);
                    }
                    // ì™¸ì¹¨ (! ë¡œ ì‹œì‘)
                    else if (content.startsWith('!')) {
                        content = content.substring(1).trim();
                        currentBubbles.push(`<div class="bubble shout">${processMarkdown(content)}</div>`);
                    }
                    // ìƒê° ('...' ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if ((content.startsWith("'") && content.endsWith("'")) || 
                             (content.startsWith("\u2018") && content.endsWith("\u2019"))) {
                        content = content.slice(1, -1);
                        currentBubbles.push(`<div class="bubble thought">${processMarkdown(content)}</div>`);
                    }
                    // ëŒ€ì‚¬ ("..." ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if ((content.startsWith('"') && content.endsWith('"')) ||
                            (content.startsWith("\u201c") && content.endsWith("\u201d"))) {
                        content = content.slice(1, -1);
                        currentBubbles.push(`<div class="bubble dialogue">${processMarkdown(content)}</div>`);
                    }
                    // ê·¸ ì™¸ (ì•„ë¬´ í‘œì‹œ ì—†ìœ¼ë©´ ìƒê° ìŠ¤íƒ€ì¼ë¡œ)
                    else {
                        currentBubbles.push(`<div class="bubble thought">${processMarkdown(content)}</div>`);
                    }
                }
                
                // ì¶”ê°€ ìºë¦­í„°ìš© ë§í’ì„  ì²˜ë¦¬
                function processBubbleContentForChar(content, charIndex) {
                    const char = extraCharacters[charIndex];
                    const bgColor = char.bgColor;
                    const textColor = char.textColor;
                    
                    // ê¸°ë³¸ ìŠ¤íƒ€ì¼
                    const baseStyle = `background:${bgColor};color:${textColor};`;
                    
                    // í†µì‹  ë©”ì‹œì§€ (> ë¡œ ì‹œì‘)
                    if (content.startsWith('>')) {
                        content = content.substring(1).trim();
                        currentBubbles.push(`<div class="bubble comm" style="${baseStyle}border-left-color:var(--comm-color);">${processMarkdown(content)}</div>`);
                    }
                    // ì†ì‚­ì„ ((...) ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if (content.startsWith('((') && content.endsWith('))')) {
                        content = content.slice(2, -2).trim();
                        currentBubbles.push(`<div class="bubble whisper" style="${baseStyle}opacity:0.7;">${processMarkdown(content)}</div>`);
                    }
                    // ì™¸ì¹¨ (! ë¡œ ì‹œì‘)
                    else if (content.startsWith('!')) {
                        content = content.substring(1).trim();
                        currentBubbles.push(`<div class="bubble shout" style="${baseStyle}">${processMarkdown(content)}</div>`);
                    }
                    // ìƒê° ('...' ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if ((content.startsWith("'") && content.endsWith("'")) || 
                             (content.startsWith("\u2018") && content.endsWith("\u2019"))) {
                        content = content.slice(1, -1);
                        currentBubbles.push(`<div class="bubble thought" style="background:transparent;color:${char.nameColor};border:1px dashed ${char.nameColor};">${processMarkdown(content)}</div>`);
                    }
                    // ëŒ€ì‚¬ ("..." ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                    else if ((content.startsWith('"') && content.endsWith('"')) ||
                            (content.startsWith("\u201c") && content.endsWith("\u201d"))) {
                        content = content.slice(1, -1);
                        currentBubbles.push(`<div class="bubble dialogue" style="${baseStyle}">${processMarkdown(content)}</div>`);
                    }
                    // ê·¸ ì™¸ (ì•„ë¬´ í‘œì‹œ ì—†ìœ¼ë©´ ìƒê° ìŠ¤íƒ€ì¼ë¡œ)
                    else {
                        currentBubbles.push(`<div class="bubble thought" style="background:transparent;color:${char.nameColor};border:1px dashed ${char.nameColor};">${processMarkdown(content)}</div>`);
                    }
                }

                let lastWasNarration = false; // ì´ì „ ì¤„ì´ ë‚˜ë ˆì´ì…˜ì¸ì§€ ì¶”ì 
                
                lines.forEach((line, lineIndex) => {
                    const trimmedLine = line.trim();
                    
                    // ë¹ˆ ì¤„ ì²˜ë¦¬
                    if (!trimmedLine) {
                        // ì´ì „ì´ ë‚˜ë ˆì´ì…˜ì´ì—ˆê³ , ë‹¤ìŒ ì¤„ë„ ë‚˜ë ˆì´ì…˜ì´ë©´ ì¤„ë°”ê¾¼ ì¶”ê°€
                        if (lastWasNarration) {
                            // ë‹¤ìŒ ì¤„ í™•ì¸ (ë‚˜ë ˆì´ì…˜ì¸ì§€)
                            let nextLineIndex = lineIndex + 1;
                            while (nextLineIndex < lines.length && lines[nextLineIndex].trim() === '') {
                                nextLineIndex++;
                            }
                            if (nextLineIndex < lines.length) {
                                const nextLine = lines[nextLineIndex].trim();
                                const isNextNarration = nextLine.startsWith('-') || 
                                    (nextLine.startsWith('*') && !nextLine.endsWith('*')) ||
                                    (!nextLine.match(/^(AI|USER)\s*:/i) && 
                                     !nextLine.match(/^CHAR-\d{2}\s*:/i) &&
                                     nextLine !== '---' && nextLine !== '***' && nextLine !== '===');
                                if (isNextNarration) {
                                    html += '<div class="narration" style="padding:2px 16px;">&nbsp;</div>';
                                }
                            }
                        }
                        return;
                    }
                    
                    line = trimmedLine;

                    // êµ¬ë¶„ì„ 
                    if (line === '---' || line === '***') {
                        flushBubbles();
                        currentSpeaker = null;
                        lastWasNarration = false;
                        html += '<div class="divider"></div>';
                        return;
                    }
                    
                    // ì  ì„¸ ê°œ êµ¬ë¶„ì„ 
                    if (line === '===') {
                        flushBubbles();
                        currentSpeaker = null;
                        lastWasNarration = false;
                        html += '<div class="dot-divider"></div>';
                        return;
                    }

                    // ë‚˜ë ˆì´ì…˜ (- ë˜ëŠ” * ë¡œ ì‹œì‘)
                    if (line.startsWith('-') || (line.startsWith('*') && !line.endsWith('*'))) {
                        flushBubbles();
                        currentSpeaker = null;
                        lastWasNarration = true;
                        const narrationText = line.substring(1).trim();
                        
                        // í´ë¼ë¡œì´ë“œ í”„ë ˆì„ì¼ ë•Œ 30% í™•ë¥ ë¡œ ì‹¬ë³¼ ì¶”ê°€
                        if (currentFrameType === 'polaroid' && Math.random() < 0.3) {
                            const symbols = ['â™¡', 'â™¥', 'âœ§', 'âœ¦', 'â˜…', 'â˜†'];
                            const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                            const isBefore = Math.random() > 0.5;
                            if (isBefore) {
                                html += `<div class="polaroid-symbol">${symbol}</div>`;
                            }
                            html += `<div class="narration">${processMarkdown(narrationText)}</div>`;
                            if (!isBefore) {
                                html += `<div class="polaroid-symbol">${symbol}</div>`;
                            }
                        } else {
                            html += `<div class="narration">${processMarkdown(narrationText)}</div>`;
                        }
                        return;
                    }

                    // AI ë˜ëŠ” USER ëŒ€í™”
                    const match = line.match(/^(AI|USER)\s*:\s*(.+)$/i);
                    if (match) {
                        const speaker = match[1].toUpperCase();
                        let content = match[2].trim();

                        // ìƒˆë¡œìš´ í™”ìë©´ ì´ì „ ë§í’ì„ ë“¤ ì¶œë ¥
                        if (speaker !== currentSpeaker || currentSpeakerType !== speaker) {
                            flushBubbles();
                            currentSpeaker = speaker;
                            currentSpeakerType = speaker;
                        }

                        // ë§í’ì„  ìœ í˜• ì²˜ë¦¬
                        processBubbleContent(content);
                        lastWasNarration = false;
                        return;
                    }
                    
                    // ì¶”ê°€ ìºë¦­í„° ëŒ€í™” (CHAR-01:, CHAR-02: ë“±)
                    const charMatch = line.match(/^CHAR-(\d{2})\s*:\s*(.+)$/i);
                    if (charMatch) {
                        const charNum = parseInt(charMatch[1], 10);
                        const charIndex = charNum - 1;
                        let content = charMatch[2].trim();
                        
                        if (charIndex >= 0 && charIndex < extraCharacters.length) {
                            // ìƒˆë¡œìš´ í™”ìë©´ ì´ì „ ë§í’ì„ ë“¤ ì¶œë ¥
                            if (currentSpeakerType !== charIndex) {
                                flushBubbles();
                                currentSpeaker = `CHAR-${charMatch[1]}`;
                                currentSpeakerType = charIndex;
                            }
                            
                            // ë§í’ì„  ìœ í˜• ì²˜ë¦¬ (ì¶”ê°€ ìºë¦­í„°ìš© ìŠ¤íƒ€ì¼ ì ìš©)
                            processBubbleContentForChar(content, charIndex);
                            lastWasNarration = false;
                            return;
                        }
                    }

                    // ê·¸ ì™¸ ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” ë‚˜ë ˆì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬
                    flushBubbles();
                    currentSpeaker = null;
                    lastWasNarration = true;
                    html += `<div class="narration">${processMarkdown(line)}</div>`;
                });

                // ë‚¨ì€ ë§í’ì„  ì¶œë ¥
                flushBubbles();
            });
            
            // ì›Œí„°ë§ˆí¬ ì¶”ê°€
            if (html) {
                html += '<div class="log-watermark"><span>ğŸ§ Created with Log Cupcake</span></div>';
            }

            preview.innerHTML = html || '<div style="text-align: center; color: var(--text-secondary); padding: 60px;">ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
            
            // ì™¸ê³½ ì¥ì‹ ì¶”ê°€ (ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë†’ì´ ê³„ì‚°)
            setTimeout(() => addFrameDecorations(), 50);
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
        function processMarkdown(text) {
            let result = escapeHtml(text);
            
            // **êµµê²Œ**
            result = result.replace(/\*\*(.+?)\*\*/g, '<span class="md-bold">$1</span>');
            
            // *ê¸°ìš¸ì„* (ë‹¨, **ëŠ” ì œì™¸)
            result = result.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<span class="md-italic">$1</span>');
            
            // ^í•˜ì´ë¼ì´íŠ¸^
            result = result.replace(/\^(.+?)\^/g, '<span class="md-highlight">$1</span>');
            
            // $ê°•ì¡°$
            result = result.replace(/\$(.+?)\$/g, '<span class="md-emphasis">$1</span>');
            
            // __ë°‘ì¤„__
            result = result.replace(/__(.+?)__/g, '<span class="md-underline">$1</span>');
            
            // ~~ì·¨ì†Œ~~
            result = result.replace(/~~(.+?)~~/g, '<span class="md-strike">$1</span>');
            
            return result;
        }

        // ========== ì´ë¯¸ì§€ ì €ì¥ ==========
        function saveImage() {
            const preview = document.getElementById('log-preview');
            const previewWrapper = document.querySelector('.preview-wrapper');
            const frameType = document.getElementById('frame-select').value;
            
            // ì™¸ê³½ í…Œë§ˆê°€ ìˆëŠ” ê²½ìš° (overflowê°€ ìˆëŠ” í”„ë ˆì„ë“¤)
            const framesWithOverflow = ['vintage', 'letter', 'tape', 'memo', 'ornate', 'diary', 'polaroid'];
            const hasOverflow = framesWithOverflow.includes(frameType);
            
            // ì„ì‹œ ìº¡ì²˜ìš© ì»¨í…Œì´ë„ˆ ìƒì„±
            const captureContainer = document.createElement('div');
            captureContainer.id = 'capture-container';
            captureContainer.style.cssText = `
                position: fixed;
                left: -9999px;
                top: 0;
                display: inline-block;
                padding: ${hasOverflow ? '40px' : '0'};
                background: transparent;
            `;
            document.body.appendChild(captureContainer);
            
            // previewë¥¼ ì„ì‹œ ì»¨í…Œì´ë„ˆë¡œ ì´ë™
            const originalParent = preview.parentNode;
            const originalNextSibling = preview.nextSibling;
            captureContainer.appendChild(preview);
            
            // ì›ë³¸ ìŠ¤íƒ€ì¼ ì €ì¥ ë° ì„ì‹œ ì¡°ì •
            const originalMargin = preview.style.margin;
            preview.style.margin = '0';
            
            html2canvas(captureContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null,
                logging: false,
                onclone: function(clonedDoc) {
                    // ë³µì œëœ ë¬¸ì„œì—ì„œ SVG í•„í„° ìš”ì†Œ ë³µì‚¬
                    const originalSvg = document.querySelector('svg[style*="position:absolute"]');
                    if (originalSvg) {
                        const clonedBody = clonedDoc.body;
                        const svgClone = originalSvg.cloneNode(true);
                        clonedBody.insertBefore(svgClone, clonedBody.firstChild);
                    }
                    
                    // ì›Œí„°ë§ˆí¬ ìŠ¤íƒ€ì¼ì„ ì´ë¯¸ì§€ ì €ì¥ì— í˜¸í™˜ë˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                    const watermark = clonedDoc.querySelector('.log-watermark span');
                    if (watermark) {
                        watermark.style.background = 'none';
                        watermark.style.webkitBackgroundClip = 'unset';
                        watermark.style.webkitTextFillColor = '#e8a4b8';
                        watermark.style.backgroundClip = 'unset';
                        watermark.style.color = '#e8a4b8';
                    }
                }
            }).then(canvas => {
                // previewë¥¼ ì›ë˜ ìœ„ì¹˜ë¡œ ë³µì›
                preview.style.margin = originalMargin;
                if (originalNextSibling) {
                    originalParent.insertBefore(preview, originalNextSibling);
                } else {
                    originalParent.appendChild(preview);
                }
                document.body.removeChild(captureContainer);
                
                const link = document.createElement('a');
                link.download = 'log-' + new Date().toISOString().slice(0, 10) + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                // ì˜¤ë¥˜ ì‹œì—ë„ ë³µì›
                preview.style.margin = originalMargin;
                if (originalNextSibling) {
                    originalParent.insertBefore(preview, originalNextSibling);
                } else {
                    originalParent.appendChild(preview);
                }
                if (document.getElementById('capture-container')) {
                    document.body.removeChild(captureContainer);
                }
                console.error('ì´ë¯¸ì§€ ì €ì¥ ì˜¤ë¥˜:', err);
                alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ========== HTML ë³µì‚¬ ==========
        function copyHTML() {
            const preview = document.getElementById('log-preview');
            navigator.clipboard.writeText(preview.innerHTML).then(() => {
                alert('HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
        
        // ========== ì•„ì¹´ë¼ì´ë¸Œìš© HTML ë³µì‚¬ ==========
        function copyArcaHTML() {
            const html = generateArcaHTML();
            navigator.clipboard.writeText(html).then(() => {
                alert('ì•„ì¹´ë¼ì´ë¸Œìš© HTMLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nê²Œì‹œê¸€ ì‘ì„± ì‹œ HTML ëª¨ë“œë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
            });
        }
        
        function generateArcaHTML() {
            // ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
            const bgColor = document.getElementById('bg-solid-color').value;
            const bgType = document.getElementById('bg-type').value;
            const textColor = document.getElementById('color-text').value;
            const aiBgColor = document.getElementById('color-ai-bg').value;
            const userBgColor = document.getElementById('color-user-bg').value;
            const aiTextColor = document.getElementById('color-ai-text').value;
            const userTextColor = document.getElementById('color-user-text').value;
            const thoughtColor = document.getElementById('color-thought').value;
            const commColor = document.getElementById('color-comm').value;
            const nameAiColor = document.getElementById('color-name-ai').value;
            const nameUserColor = document.getElementById('color-name-user').value;
            const titleColor = document.getElementById('color-title').value;
            
            const fontSize = document.getElementById('style-font-size').value;
            const borderRadius = document.getElementById('style-radius').value;
            
            // ë°°ê²½ ì„¤ì •
            let bgStyle = `background:${bgColor};`;
            if (bgType === 'gradient') {
                const start = document.getElementById('gradient-start').value;
                const end = document.getElementById('gradient-end').value;
                const angle = document.getElementById('gradient-angle').value;
                bgStyle = `background:linear-gradient(${angle}deg, ${start} 0%, ${end} 100%);`;
            }
            
            // ê° ë¸”ë¡ ìˆ˜ì§‘ ë° ì •ê·œì‹ ì ìš©
            const blockElements = document.querySelectorAll('.log-block');
            const blockData = Array.from(blockElements).map(block => {
                const titleInput = block.querySelector('.log-block-title input');
                const textarea = block.querySelector('.log-block-input');
                let blockText = textarea.value;
                document.querySelectorAll('.rule-item').forEach(item => {
                    const find = item.querySelector('.rule-find').value;
                    const replace = item.querySelector('.rule-replace').value;
                    if (find) {
                        try {
                            const regex = new RegExp(find, 'g');
                            blockText = blockText.replace(regex, replace);
                        } catch (e) {}
                    }
                });
                return {
                    title: titleInput ? titleInput.value : `ë¸”ë¡ ${block.dataset.blockId}`,
                    content: blockText
                };
            });
            
            const blockFolding = document.getElementById('block-folding').checked;
            
            const title = document.getElementById('log-title').value;
            const subtitle = document.getElementById('log-subtitle').value;
            const aiModel = document.getElementById('ai-model-input').value;
            const promptName = document.getElementById('prompt-name').value;
            const translation = document.getElementById('translation-input').value;
            const charLink = document.getElementById('char-link').value;
            const aiName = document.getElementById('name-ai').value || 'AI';
            const userName = document.getElementById('name-user').value || 'USER';
            const frameStyle = document.getElementById('frame-select').value;
            
            let html = '';
            
            // ì™¸ê³½ í…Œë§ˆ ìŠ¤íƒ€ì¼ ìƒì„± (ì•„ì¹´ë¼ì´ë¸Œ í˜¸í™˜)
            let frameCSS = '';
            switch(frameStyle) {
                case 'letter':
                    frameCSS = 'border:3px double #d4a574;';
                    break;
                case 'diary':
                    frameCSS = 'border-left:5px solid #e4b5a6;border-top:1px solid #e4b5a6;border-right:1px solid #e4b5a6;border-bottom:1px solid #e4b5a6;';
                    break;
                case 'memo':
                    frameCSS = 'box-shadow:2px 2px 0 #f8f8f8, 4px 4px 0 #f0f0f0, 6px 6px 0 #e8e8e8;';
                    break;
                case 'gold':
                    frameCSS = 'border:3px double #d4af37;';
                    break;
                case 'ornate':
                    frameCSS = 'border:3px double #8b7355;';
                    break;
                case 'check':
                    frameCSS = 'border:2px dashed #ccc;';
                    break;
                case 'tape':
                    frameCSS = 'border:2px solid #ddd;border-style:dashed solid;';
                    break;
                case 'vintage':
                    frameCSS = 'box-shadow:inset 0 0 30px rgba(120,90,60,0.05);border:1px solid rgba(120,90,60,0.15);';
                    break;
                case 'polaroid':
                    frameCSS = 'border:1px solid rgba(0,0,0,0.08);box-shadow:0 4px 12px rgba(0,0,0,0.1);';
                    break;
            }
            
            // ì™¸ë¶€ wrapper (ê°€ìš´ë° ì •ë ¬)
            html += `<div style="text-align:center;">`;
            
            // ì™¸ë¶€ ì»¨í…Œì´ë„ˆ ì‹œì‘ (80% ë„ˆë¹„, ê°€ìš´ë° ì •ë ¬)
            html += `<div style="${bgStyle}${frameCSS}padding:24px;border-radius:${borderRadius}px;font-family:'Noto Sans KR',sans-serif;font-size:${fontSize}px;line-height:1.7;color:${textColor};width:80%;margin:0 auto;text-align:left;">`;
            
            // ì œëª©
            if (title || subtitle || aiModel || promptName || translation || charLink) {
                html += `<div style="text-align:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid rgba(128,128,128,0.3);">`;
                if (title) html += `<div style="font-size:1.5em;font-weight:700;color:${titleColor};margin-bottom:4px;">${escapeHtml(title)}</div>`;
                if (subtitle) html += `<div style="font-size:0.95em;opacity:0.8;">${escapeHtml(subtitle)}</div>`;
                
                const metaItems = [];
                if (aiModel) metaItems.push(`ğŸ§ ${escapeHtml(aiModel)}`);
                if (promptName) metaItems.push(`ğŸ’ ${escapeHtml(promptName)}`);
                if (translation) metaItems.push(`ğŸ’Œ ${escapeHtml(translation)}`);
                if (charLink) metaItems.push(`<a href="${escapeHtml(charLink)}" target="_blank" style="color:${nameUserColor};text-decoration:none;">ğŸ­ ${escapeHtml(aiName)}</a>`);
                
                if (metaItems.length > 0) {
                    html += `<div style="margin-top:12px;font-size:0.85em;opacity:0.7;">${metaItems.join(' &nbsp;|&nbsp; ')}</div>`;
                }
                html += `</div>`;
            }
            
            // ë¸”ë¡ 0ë²ˆ ì´ë¯¸ì§€ (ì œëª© ì•„ë˜)
            const headerImages = uploadedImages.filter(img => img.blockNumber === 0);
            headerImages.forEach(img => {
                html += `<div style="text-align:center;margin:16px 0;"><img src="${img.data}" style="max-width:100%;border-radius:8px;"></div>`;
            });
            
            // ê° ë¸”ë¡ ì²˜ë¦¬
            blockData.forEach((block, blockIndex) => {
                const blockNumber = blockIndex + 1;
                const blockText = block.content;
                const blockTitle = block.title;
                
                // ì´ ë¸”ë¡ ì•ì— ì‚½ì…í•  ì´ë¯¸ì§€
                const blockImages = uploadedImages.filter(img => img.blockNumber === blockNumber);
                blockImages.forEach(img => {
                    html += `<div style="text-align:center;margin:16px 0;"><img src="${img.data}" style="max-width:100%;border-radius:8px;"></div>`;
                });
                
                // ë¸”ë¡ ì‚¬ì´ êµ¬ë¶„ì„ 
                if (blockIndex > 0 && !blockFolding) {
                    html += `<div style="border-top:1px dashed rgba(128,128,128,0.4);margin:20px 0;"></div>`;
                }
                
                // ë¸”ë¡ ì ‘ê¸° ì‹œì‘
                if (blockFolding) {
                    html += `<details style="margin:10px 0;"><summary style="cursor:pointer;padding:8px 12px;background:rgba(128,128,128,0.1);border-radius:6px;font-weight:600;color:${textColor};">${escapeHtml(blockTitle)}</summary><div style="padding:10px 0;">`; 
                }
                
                const lines = blockText.split('\n');
                let currentSpeaker = null;
                let currentSpeakerType = null; // 'AI', 'USER', or char index for Arca
                let currentBubbles = [];
                let narrationBuffer = []; // ë‚˜ë ˆì´ì…˜ ëª¨ìœ¼ê¸°
                
                function flushNarrationArca() {
                    if (narrationBuffer.length > 0) {
                        // ë‚˜ë ˆì´ì…˜ + ìœ„ì•„ë˜ ì§§ì€ ì„ ì„ í•˜ë‚˜ì˜ divë¡œ (í…ìŠ¤íŠ¸ ê¸°ë°˜ ì„ )
                        html += `<div style="text-align:center;color:${textColor};opacity:0.85;padding:8px 16px;margin:10px 0;">`;
                        html += `<span style="color:rgba(128,128,128,0.5);">â”€â”€â”€â”€â”€â”€</span><br>`;
                        html += narrationBuffer.join('<br>');
                        html += `<br><span style="color:rgba(128,128,128,0.5);">â”€â”€â”€â”€â”€â”€</span>`;
                        html += `</div>`;
                        narrationBuffer = [];
                    }
                }
                
                function flushBubblesOnlyArca() {
                    if (currentSpeaker && currentBubbles.length > 0) {
                        let bgC, txtC, nameC, displayName, align;
                        
                        if (currentSpeakerType === 'AI') {
                            bgC = aiBgColor;
                            txtC = aiTextColor;
                            nameC = nameAiColor;
                            displayName = aiName;
                            align = 'left';
                        } else if (currentSpeakerType === 'USER') {
                            bgC = userBgColor;
                            txtC = userTextColor;
                            nameC = nameUserColor;
                            displayName = userName;
                            align = 'right';
                        } else if (typeof currentSpeakerType === 'number') {
                            // ì¶”ê°€ ìºë¦­í„°
                            const char = extraCharacters[currentSpeakerType];
                            bgC = char.bgColor;
                            txtC = char.textColor;
                            nameC = char.nameColor;
                            displayName = char.name;
                            align = 'left'; // ì¶”ê°€ ìºë¦­í„°ëŠ” í•­ìƒ ì™¼ìª½ ì •ë ¬
                        }
                        
                        html += `<div style="margin:12px 0;text-align:${align};">`;
                        html += `<div style="font-size:0.85em;font-weight:600;color:${nameC};margin-bottom:6px;">${escapeHtml(displayName)}</div>`;
                        html += `<div style="display:inline-block;text-align:${align};width:75%;">`;
                        currentBubbles.forEach(bubble => {
                            html += bubble;
                        });
                        html += `</div></div>`;
                        currentBubbles = [];
                    }
                }
                
                let lastWasNarrationArca = false;
                
                lines.forEach((line, lineIndex) => {
                    const trimmedLine = line.trim();
                    
                    // ë¹ˆ ì¤„ ì²˜ë¦¬
                    if (!trimmedLine) {
                        if (lastWasNarrationArca) {
                            let nextLineIndex = lineIndex + 1;
                            while (nextLineIndex < lines.length && lines[nextLineIndex].trim() === '') {
                                nextLineIndex++;
                            }
                            if (nextLineIndex < lines.length) {
                                const nextLine = lines[nextLineIndex].trim();
                                const isNextNarration = nextLine.startsWith('-') || 
                                    (nextLine.startsWith('*') && !nextLine.endsWith('*')) ||
                                    (!nextLine.match(/^(AI|USER)\s*:/i) && 
                                     !nextLine.match(/^CHAR-\d{2}\s*:/i) &&
                                     nextLine !== '---' && nextLine !== '***' && nextLine !== '===');
                                if (isNextNarration) {
                                    narrationBuffer.push('<br>');
                                }
                            }
                        }
                        return;
                    }
                    
                    line = trimmedLine;
                    
                    // êµ¬ë¶„ì„ 
                    if (line === '---' || line === '***') {
                        flushNarrationArca();
                        flushBubblesOnlyArca();
                        currentSpeaker = null;
                        lastWasNarrationArca = false;
                        html += `<div style="border-top:1px dashed rgba(128,128,128,0.4);margin:16px 0;"></div>`;
                        return;
                    }
                    
                    // ì  ì„¸ ê°œ êµ¬ë¶„ì„ 
                    if (line === '===') {
                        flushNarrationArca();
                        flushBubblesOnlyArca();
                        currentSpeaker = null;
                        lastWasNarrationArca = false;
                        html += `<div style="text-align:center;color:rgba(128,128,128,0.5);margin:16px 0;letter-spacing:8px;">â€¢ â€¢ â€¢</div>`;
                        return;
                    }
                    
                    // ë‚˜ë ˆì´ì…˜ (- ë˜ëŠ” * ë¡œ ì‹œì‘)
                    if (line.startsWith('-') || (line.startsWith('*') && !line.endsWith('*'))) {
                        flushBubblesOnlyArca();
                        currentSpeaker = null;
                        lastWasNarrationArca = true;
                        const narrationText = line.substring(1).trim();
                        narrationBuffer.push(processMarkdownArca(narrationText));
                        return;
                    }
                    
                    // AI/USER ëŒ€í™”
                    const match = line.match(/^(AI|USER)\s*:\s*(.+)$/i);
                    if (match) {
                        const speaker = match[1].toUpperCase();
                        let content = match[2].trim();
                        const isAI = speaker === 'AI';
                        const bgC = isAI ? aiBgColor : userBgColor;
                        const txtC = isAI ? aiTextColor : userTextColor;
                        
                        if (speaker !== currentSpeaker || currentSpeakerType !== speaker) {
                            flushNarrationArca();
                            flushBubblesOnlyArca();
                            currentSpeaker = speaker;
                            currentSpeakerType = speaker;
                        }
                        
                        let bubbleStyle = `background:${bgC};color:${txtC};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;`;
                        let bubbleContent = content;
                        
                        // í†µì‹  ë©”ì‹œì§€
                        if (content.startsWith('>')) {
                            bubbleContent = content.substring(1).trim();
                            bubbleStyle = `background:${bgC};color:${commColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;border-left:3px solid ${commColor};font-family:monospace;`;
                        }
                        // ì†ì‚­ì„
                        else if (content.startsWith('((') && content.endsWith('))')) {
                            bubbleContent = content.slice(2, -2).trim();
                            bubbleStyle = `background:${bgC};color:${txtC};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;opacity:0.7;font-size:0.9em;`;
                        }
                        // ì™¸ì¹¨
                        else if (content.startsWith('!')) {
                            bubbleContent = content.substring(1).trim();
                            bubbleStyle = `background:${bgC};color:${txtC};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-weight:bold;font-size:1.1em;`;
                        }
                        // ìƒê°
                        else if ((content.startsWith("'") && content.endsWith("'")) || (content.startsWith("\u2018") && content.endsWith("\u2019"))) {
                            bubbleContent = content.slice(1, -1);
                            bubbleStyle = `background:transparent;color:${thoughtColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-style:italic;border:1px dashed ${thoughtColor};`;
                        }
                        // ëŒ€ì‚¬
                        else if ((content.startsWith('"') && content.endsWith('"')) || (content.startsWith('\u201c') && content.endsWith('\u201d'))) {
                            bubbleContent = content.slice(1, -1);
                        }
                        // ê·¸ ì™¸ (ì•„ë¬´ í‘œì‹œ ì—†ìœ¼ë©´ ìƒê° ìŠ¤íƒ€ì¼ë¡œ)
                        else {
                            bubbleStyle = `background:transparent;color:${thoughtColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-style:italic;border:1px dashed ${thoughtColor};`;
                        }
                        
                        currentBubbles.push(`<div style="${bubbleStyle}">${processMarkdownArca(bubbleContent)}</div>`);
                        lastWasNarrationArca = false;
                        return;
                    }
                    
                    // ì¶”ê°€ ìºë¦­í„° ëŒ€í™” (CHAR-01:, CHAR-02: ë“±)
                    const charMatch = line.match(/^CHAR-(\d{2})\s*:\s*(.+)$/i);
                    if (charMatch) {
                        const charNum = parseInt(charMatch[1], 10);
                        const charIndex = charNum - 1;
                        let content = charMatch[2].trim();
                        
                        if (charIndex >= 0 && charIndex < extraCharacters.length) {
                            const char = extraCharacters[charIndex];
                            
                            if (currentSpeakerType !== charIndex) {
                                flushNarrationArca();
                                flushBubblesOnlyArca();
                                currentSpeaker = `CHAR-${charMatch[1]}`;
                                currentSpeakerType = charIndex;
                            }
                            
                            let bubbleStyle = `background:${char.bgColor};color:${char.textColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;`;
                            let bubbleContent = content;
                            
                            // í†µì‹  ë©”ì‹œì§€
                            if (content.startsWith('>')) {
                                bubbleContent = content.substring(1).trim();
                                bubbleStyle = `background:${char.bgColor};color:${commColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;border-left:3px solid ${commColor};font-family:monospace;`;
                            }
                            // ì†ì‚­ì„
                            else if (content.startsWith('((') && content.endsWith('))')) {
                                bubbleContent = content.slice(2, -2).trim();
                                bubbleStyle = `background:${char.bgColor};color:${char.textColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;opacity:0.7;font-size:0.9em;`;
                            }
                            // ì™¸ì¹¨
                            else if (content.startsWith('!')) {
                                bubbleContent = content.substring(1).trim();
                                bubbleStyle = `background:${char.bgColor};color:${char.textColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-weight:bold;font-size:1.1em;`;
                            }
                            // ìƒê°
                            else if ((content.startsWith("'") && content.endsWith("'")) || (content.startsWith("\u2018") && content.endsWith("\u2019"))) {
                                bubbleContent = content.slice(1, -1);
                                bubbleStyle = `background:transparent;color:${char.nameColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-style:italic;border:1px dashed ${char.nameColor};`;
                            }
                            // ëŒ€ì‚¬
                            else if ((content.startsWith('"') && content.endsWith('"')) || (content.startsWith('\u201c') && content.endsWith('\u201d'))) {
                                bubbleContent = content.slice(1, -1);
                            }
                            // ê·¸ ì™¸ (ì•„ë¬´ í‘œì‹œ ì—†ìœ¼ë©´ ìƒê° ìŠ¤íƒ€ì¼ë¡œ)
                            else {
                                bubbleStyle = `background:transparent;color:${char.nameColor};padding:10px 14px;border-radius:12px;margin:4px 0;display:inline-block;max-width:100%;font-style:italic;border:1px dashed ${char.nameColor};`;
                            }
                            
                            currentBubbles.push(`<div style="${bubbleStyle}">${processMarkdownArca(bubbleContent)}</div>`);
                            lastWasNarrationArca = false;
                            return;
                        }
                    }
                    
                    // ê·¸ ì™¸ í…ìŠ¤íŠ¸ (ë‚˜ë ˆì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬)
                    flushBubblesOnlyArca();
                    currentSpeaker = null;
                    lastWasNarrationArca = true;
                    narrationBuffer.push(processMarkdownArca(line));
                });
                
                flushNarrationArca();
                flushBubblesOnlyArca();
                
                // ë¸”ë¡ ì ‘ê¸° ë
                if (blockFolding) {
                    html += `</div></details>`;
                }
            });
            
            // ì›Œí„°ë§ˆí¬ ì¶”ê°€
            html += `<div style="text-align:center;padding:20px 0 8px 0;margin-top:24px;border-top:1px solid rgba(128,128,128,0.15);">`;
            html += `<span style="font-size:11px;font-weight:500;background:linear-gradient(135deg,#ff9a9e,#fecfef,#a18cd1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;opacity:0.7;">ğŸ§ Created with Log Cupcake</span>`;
            html += `</div>`;
            
            html += `</div></div>`;
            return html;
        }
        
        function processMarkdownArca(text) {
            // HTML ì´ìŠ¤ì¼€ì´í”„
            text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            // ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
            text = text.replace(/\*\*(.+?)\*\*/g, '<b>$1</b>');
            text = text.replace(/\*(.+?)\*/g, '<i>$1</i>');
            text = text.replace(/\^(.+?)\^/g, '<span style="background:#fff3bf;color:#000;padding:0 3px;border-radius:2px;">$1</span>');
            text = text.replace(/~~(.+?)~~/g, '<del>$1</del>');
            return text;
        }
        
        // ========== ë¯¸ë¦¬ë³´ê¸°/HTML í† ê¸€ ==========
        let isHtmlMode = false;
        
        function togglePreviewMode() {
            isHtmlMode = !isHtmlMode;
            const wrapper = document.querySelector('.preview-wrapper');
            const toggleBtn = document.querySelector('.preview-toggle');
            const htmlView = document.getElementById('html-code-view');
            const preview = document.getElementById('log-preview');
            
            if (isHtmlMode) {
                wrapper.classList.add('html-mode');
                toggleBtn.classList.add('active');
                toggleBtn.innerHTML = 'ğŸ’» HTML ì½”ë“œ';
                // HTML ì½”ë“œ ì—…ë°ì´íŠ¸
                updateHtmlView();
            } else {
                wrapper.classList.remove('html-mode');
                toggleBtn.classList.remove('active');
                toggleBtn.innerHTML = 'ğŸ“„ ë¯¸ë¦¬ë³´ê¸°';
            }
        }
        
        function updateHtmlView() {
            const preview = document.getElementById('log-preview');
            const htmlView = document.getElementById('html-code-view');
            // HTMLì„ ì´ì¨ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬í•˜ì—¬ í‘œì‹œ
            const escaped = preview.innerHTML
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            htmlView.innerHTML = escaped;
        }

        // ========== íŒì—… ë“œë˜ê·¸ ê¸°ëŠ¥ ==========
        function initDraggable(element, dragHandle) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            // transform ì´ˆê¸°í™” - ì²˜ìŒì—ëŠ” ê°€ìš´ë° ì •ë ¬ ìœ ì§€
            let hasBeenDragged = false;
            
            dragHandle.addEventListener('mousedown', startDrag);
            dragHandle.addEventListener('touchstart', startDrag, { passive: false });
            
            function startDrag(e) {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
                
                isDragging = true;
                
                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    startX = e.clientX;
                    startY = e.clientY;
                }
                
                // ì²˜ìŒ ë“œë˜ê·¸í•  ë•Œ transformì„ ì‹¤ì œ ìœ„ì¹˜ë¡œ ë³€í™˜
                if (!hasBeenDragged) {
                    const rect = element.getBoundingClientRect();
                    element.style.transform = 'none';
                    element.style.left = rect.left + 'px';
                    element.style.top = rect.top + 'px';
                    hasBeenDragged = true;
                }
                
                initialX = element.offsetLeft;
                initialY = element.offsetTop;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                let currentX, currentY;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                } else {
                    currentX = e.clientX;
                    currentY = e.clientY;
                }
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                let newX = initialX + deltaX;
                let newY = initialY + deltaY;
                
                // í™”ë©´ ê²½ê³„ ì²´í¬
                const rect = element.getBoundingClientRect();
                const maxX = window.innerWidth - rect.width;
                const maxY = window.innerHeight - rect.height;
                
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));
                
                element.style.left = newX + 'px';
                element.style.top = newY + 'px';
                
                e.preventDefault();
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            }
        }

        // ========== ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ==========
        // ì²« ë²ˆì§¸ ë¸”ë¡ì˜ textareaì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.log-block-input').forEach(textarea => {
            textarea.addEventListener('input', () => {
                // ë””ë°”ìš´ìŠ¤ ì²˜ë¦¬
                clearTimeout(window.inputTimeout);
                window.inputTimeout = setTimeout(generateLog, 300);
            });
        });

        // ì´ˆê¸° ì˜ˆì œ (ì²« ë²ˆì§¸ ë¸”ë¡ì— ì„¤ì •)
        document.querySelector('.log-block-input').value = `AI: "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."
USER: "ë°˜ê°€ì›Œìš”. ì˜ ë¶€íƒí•´ìš”."
AI: 'ì´ ì‚¬ëŒì€ **ì¢‹ì€ ì‚¬ëŒ** ê°™ì•„ ë³´ì—¬...'
- ì ì‹œ ì¹¨ë¬µì´ í˜ë €ë‹¤.
AI: "ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
USER: 'ë­˜ ë¬¼ì–´ë³´ì§€?'
===
AI: > ì›ê²© í†µì‹ ì´ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.
USER: > ìˆ˜ì‹  í™•ì¸í–ˆìŠµë‹ˆë‹¤.
---
AI: ((ì¡°ìš©íˆ ì†ì‚­ì…ë‹ˆë‹¤...))
USER: ! ê¹œì§ ë†€ëì–´!
AI: ë¹™ê·¸ë ˆ ì›ƒëŠ”ë‹¤`;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒì„±
        window.onload = function() {
            applyStyles(); // ìŠ¤íƒ€ì¼ ë¨¼ì € ì ìš©
            generateLog();
            renderSavedThemes();
            renderPresetListPanel(); // í”„ë¦¬ì…‹ íŒ¨ë„ ë Œë”ë§
            
            // ë§ˆì§€ë§‰ìœ¼ë¡œ ì„ íƒí•œ í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
            const lastPresetIndex = localStorage.getItem('lastPresetIndex');
            if (lastPresetIndex !== null) {
                const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
                const preset = savedPresets[parseInt(lastPresetIndex)];
                if (preset) {
                    applyPresetData(preset);
                }
            }
            
            // ì €ì¥ëœ ëª¨ë“œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const savedMode = localStorage.getItem('logmaker-mode');
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                document.querySelector('.mode-toggle').textContent = 'â˜€ï¸';
            }
            
            // í”„ë¦¬ì…‹ íŒ¨ë„ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì´ë²¤íŠ¸
            document.getElementById('import-preset-panel').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const preset = JSON.parse(event.target.result);
                        applyPresetData(preset);
                        closePresetPanel();
                        alert('í”„ë¦¬ì…‹ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                    } catch (e) {
                        alert('í”„ë¦¬ì…‹ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            });
        };
        
        // ========== í”„ë¦¬ì…‹ íŒ¨ë„ í•¨ìˆ˜ë“¤ ==========
        function togglePresetPanel() {
            const panel = document.getElementById('preset-panel');
            const overlay = document.querySelector('.preset-panel-overlay');
            panel.classList.toggle('show');
            overlay.classList.toggle('show');
            if (panel.classList.contains('show')) {
                renderPresetListPanel();
                // ë“œë˜ê·¸ ê¸°ëŠ¥ ì´ˆê¸°í™” (ì²˜ìŒ ì—´ë¦´ ë•Œë§Œ)
                if (!panel.dataset.dragInitialized) {
                    initDraggable(panel, document.getElementById('preset-panel-header'));
                    panel.dataset.dragInitialized = 'true';
                }
            }
        }
        
        function closePresetPanel() {
            const panel = document.getElementById('preset-panel');
            const overlay = document.querySelector('.preset-panel-overlay');
            panel.classList.remove('show');
            overlay.classList.remove('show');
        }
        
        function savePresetFromPanel() {
            const name = prompt('í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;
            
            const preset = collectPresetData();
            preset.name = name;
            
            let savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            savedPresets.push(preset);
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderPresetListPanel();
            alert('í”„ë¦¬ì…‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function renderPresetListPanel() {
            const container = document.getElementById('preset-list-panel');
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            
            if (savedPresets.length === 0) {
                container.innerHTML = '<div class="preset-empty">ì €ì¥ëœ í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìƒë‹¨ì˜ "ì €ì¥" ë²„íŠ¼ìœ¼ë¡œ í˜„ì¬ ì„¤ì •ì„ ì €ì¥í•˜ì„¸ìš”.</div>';
                return;
            }
            
            container.innerHTML = savedPresets.map((p, i) => `
                <div class="preset-item">
                    <span class="preset-item-name" onclick="loadPresetFromPanel(${i})" title="${escapeHtml(p.name)}">${escapeHtml(p.name)}</span>
                    <div class="preset-item-actions">
                        <button class="preset-item-btn edit" onclick="updatePresetFromPanel(${i})" title="í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ìˆ˜ì •">âœï¸</button>
                        <button class="preset-item-btn delete" onclick="deletePresetFromPanel(${i})" title="ì‚­ì œ">Ã—</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadPresetFromPanel(index) {
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            const preset = savedPresets[index];
            if (!preset) return;
            
            applyPresetData(preset);
            // ë§ˆì§€ë§‰ìœ¼ë¡œ ì„ íƒí•œ í”„ë¦¬ì…‹ ì¸ë±ìŠ¤ ì €ì¥
            localStorage.setItem('lastPresetIndex', index);
            closePresetPanel();
        }
        
        function applyPresetData(preset) {
            // ë°°ê²½ ìƒ‰ìƒ ì ìš©
            if (preset.colors) {
                if (preset.colors.bg) {
                    document.getElementById('bg-solid-color').value = preset.colors.bg;
                    document.getElementById('bg-solid-color-text').value = preset.colors.bg;
                }
                document.getElementById('color-text').value = preset.colors.text || '#1d2129';
                document.getElementById('color-text-text').value = preset.colors.text || '#1d2129';
                document.getElementById('color-ai-bg').value = preset.colors.aiBg || '#f1f3f5';
                document.getElementById('color-ai-bg-text').value = preset.colors.aiBg || '#f1f3f5';
                document.getElementById('color-user-bg').value = preset.colors.userBg || '#339af0';
                document.getElementById('color-user-bg-text').value = preset.colors.userBg || '#339af0';
                document.getElementById('color-ai-text').value = preset.colors.aiText || '#1d2129';
                document.getElementById('color-ai-text-text').value = preset.colors.aiText || '#1d2129';
                document.getElementById('color-user-text').value = preset.colors.userText || '#ffffff';
                document.getElementById('color-user-text-text').value = preset.colors.userText || '#ffffff';
                document.getElementById('color-thought').value = preset.colors.thought || '#748ffc';
                document.getElementById('color-thought-text').value = preset.colors.thought || '#748ffc';
                document.getElementById('color-comm').value = preset.colors.comm || '#20c997';
                document.getElementById('color-comm-text').value = preset.colors.comm || '#20c997';
                document.getElementById('color-name-ai').value = preset.colors.nameAi || '#495057';
                document.getElementById('color-name-ai-text').value = preset.colors.nameAi || '#495057';
                document.getElementById('color-name-user').value = preset.colors.nameUser || '#339af0';
                document.getElementById('color-name-user-text').value = preset.colors.nameUser || '#339af0';
                document.getElementById('color-title').value = preset.colors.title || '#1d2129';
                document.getElementById('color-title-text').value = preset.colors.title || '#1d2129';
            }
            
            // ë°°ê²½ íƒ€ì…
            if (preset.bgType) {
                document.getElementById('bg-type').value = preset.bgType;
                document.getElementById('bg-type').dispatchEvent(new Event('change'));
            }
            
            if (preset.gradient) document.getElementById('gradient-select').value = preset.gradient;
            if (preset.gradientStart) {
                document.getElementById('gradient-start').value = preset.gradientStart;
                document.getElementById('gradient-start-text').value = preset.gradientStart;
            }
            if (preset.gradientEnd) {
                document.getElementById('gradient-end').value = preset.gradientEnd;
                document.getElementById('gradient-end-text').value = preset.gradientEnd;
            }
            if (preset.gradientAngle) document.getElementById('gradient-angle').value = preset.gradientAngle;
            if (preset.frame) document.getElementById('frame-select').value = preset.frame;
            
            if (preset.style) {
                document.getElementById('style-width').value = preset.style.width || 1000;
                document.getElementById('style-radius').value = preset.style.radius || 16;
                document.getElementById('style-font-size').value = preset.style.fontSize || 15;
                document.getElementById('style-line-height').value = preset.style.lineHeight || 1.7;
            }
            
            // ì…ë ¥ê°’ ë¡œë“œ
            if (preset.input) {
                document.getElementById('ai-model-input').value = preset.input.aiModel || '';
                document.getElementById('prompt-name').value = preset.input.promptName || '';
                document.getElementById('translation-input').value = preset.input.translation || '';
                document.getElementById('name-ai').value = preset.input.nameAi || 'AI';
                document.getElementById('name-user').value = preset.input.nameUser || 'USER';
                document.getElementById('char-link').value = preset.input.charLink || '';
            }
            
            // ì •ê·œì‹ ê·œì¹™ ë¡œë“œ
            if (preset.regexRules && preset.regexRules.length > 0) {
                document.getElementById('rule-list').innerHTML = '';
                preset.regexRules.forEach(rule => {
                    addRule(rule.find, rule.replace);
                });
            }
            
            // ë¸”ë¡ ì ‘ê¸° ì˜µì…˜ ë¡œë“œ
            document.getElementById('block-folding').checked = preset.blockFolding !== false;
            
            // ì¶”ê°€ ìºë¦­í„° ë¡œë“œ
            if (preset.extraCharacters && Array.isArray(preset.extraCharacters)) {
                extraCharacters = JSON.parse(JSON.stringify(preset.extraCharacters));
            } else {
                extraCharacters = [];
            }
            renderExtraCharacters();
            updateAddCharButton();
            
            applyCustomColors();
            applyBackground();
            applyStyles();
            document.getElementById('gradient-select').dispatchEvent(new Event('change'));
            document.getElementById('frame-select').dispatchEvent(new Event('change'));
            generateLog();
        }
        
        function updatePresetFromPanel(index) {
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            const oldPreset = savedPresets[index];
            if (!oldPreset) return;
            
            if (!confirm(`"${oldPreset.name}" í”„ë¦¬ì…‹ì„ í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            const newPreset = collectPresetData();
            newPreset.name = oldPreset.name;
            savedPresets[index] = newPreset;
            
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderPresetListPanel();
            alert('í”„ë¦¬ì…‹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function deletePresetFromPanel(index) {
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            const preset = savedPresets[index];
            if (!confirm(`"${preset.name}" í”„ë¦¬ì…‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            savedPresets.splice(index, 1);
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderPresetListPanel();
        }
        
        // ========== ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ í† ê¸€ ==========
        function toggleDarkMode() {
            const body = document.body;
            const btn = document.querySelector('.mode-toggle');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                btn.textContent = 'â˜€ï¸';
                localStorage.setItem('logmaker-mode', 'light');
            } else {
                btn.textContent = 'ğŸŒ™';
                localStorage.setItem('logmaker-mode', 'dark');
            }
        }
        
        // ========== ëª¨ë°”ì¼ ë·° ì „í™˜ ==========
        function switchMobileView(view) {
            const body = document.body;
            const settingsBtn = document.querySelector('.mobile-view-toggle .settings-btn');
            const previewBtn = document.querySelector('.mobile-view-toggle .preview-btn');
            
            if (view === 'settings') {
                body.classList.remove('mobile-preview-view');
                body.classList.add('mobile-settings-view');
                settingsBtn.classList.add('active');
                previewBtn.classList.remove('active');
            } else {
                body.classList.remove('mobile-settings-view');
                body.classList.add('mobile-preview-view');
                settingsBtn.classList.remove('active');
                previewBtn.classList.add('active');
            }
        }
        
        // ëª¨ë°”ì¼ ë·° ì´ˆê¸°í™”
        if (window.innerWidth <= 768) {
            document.body.classList.add('mobile-settings-view');
        }
    </script>
</body>
</html>
