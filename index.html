<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ Log Cupcake</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ========== CSS ë³€ìˆ˜ (í…Œë§ˆ ì‹œìŠ¤í…œ) ========== */
        :root {
            /* ì•± UI ìƒ‰ìƒ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --app-bg: #1a1b1e;
            --panel-bg: #25262b;
            --panel-border: #373a40;
            --input-bg: #2c2e33;
            --input-border: #495057;
            --text-primary: #f1f3f5;
            --text-secondary: #adb5bd;
            --accent: #339af0;
            --accent-hover: #228be6;
            
            /* ë¡œê·¸ í”„ë¦¬ë·° ê¸°ë³¸ê°’ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --log-bg: #2c2e33;
            --log-text: #e9ecef;
            --log-width: 1000px;
            --log-radius: 16px;
            --log-font-size: 15px;
            --log-line-height: 1.7;
            
            /* ë§í’ì„  ìƒ‰ìƒ - ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ */
            --bubble-ai-bg: #3d4047;
            --bubble-ai-text: #e9ecef;
            --bubble-user-bg: #339af0;
            --bubble-user-text: #ffffff;
            --bubble-narration-bg: transparent;
            --bubble-narration-text: #868e96;
            
            /* ëŒ€ì‚¬/ìƒê°/í†µì‹  ìƒ‰ìƒ */
            --dialogue-color: inherit;
            --thought-color: #748ffc;
            --comm-color: #20c997;
            
            /* ì´ë¦„ ìƒ‰ìƒ */
            --name-ai-color: #495057;
            --name-user-color: #339af0;
            
            /* ì œëª© ìƒ‰ìƒ */
            --title-color: inherit;
            
            /* ê·¸ë¼ë°ì´ì…˜ */
            --log-gradient: none;
            
            /* ì™¸ê³½ í…Œë§ˆ */
            --frame-style: none;
        }
        
        /* ë¼ì´íŠ¸ëª¨ë“œ */
        body.light-mode {
            --app-bg: #edf0f2;
            --panel-bg: #f5f6f7;
            --panel-border: #d5d9dd;
            --input-bg: #e8ebee;
            --input-border: #c5ccd3;
            --text-primary: #2d3436;
            --text-secondary: #555e66;
            
            /* ë¼ì´íŠ¸ëª¨ë“œ ë¡œê·¸ ê¸°ë³¸ê°’ */
            --log-bg: #f8f9fa;
            --log-text: #2d3436;
            --bubble-ai-bg: #e9ecef;
            --bubble-ai-text: #2d3436;
        }
        
        body.light-mode .preview-wrapper {
            background-color: #e0e4e8;
            background-image: 
                linear-gradient(45deg, #d0d5da 25%, transparent 25%),
                linear-gradient(-45deg, #d0d5da 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #d0d5da 75%),
                linear-gradient(-45deg, transparent 75%, #d0d5da 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* ========== í”„ë¦¬ì…‹ í…Œë§ˆë“¤ ========== */
        /* ê¸°ë³¸ í…Œë§ˆ (ë°ì€ ë°°ê²½) */
        .theme-default {
            --log-bg: #ffffff;
            --log-text: #1d2129;
            --bubble-ai-bg: #f1f3f5;
            --bubble-ai-text: #1d2129;
            --bubble-user-bg: #339af0;
            --bubble-user-text: #ffffff;
            --thought-color: #748ffc;
            --comm-color: #20c997;
            --name-ai-color: #495057;
            --name-user-color: #339af0;
            --title-color: #1d2129;
        }
        
        .theme-ocean {
            --log-bg: #e7f5ff;
            --log-text: #1864ab;
            --bubble-ai-bg: #d0ebff;
            --bubble-ai-text: #1864ab;
            --bubble-user-bg: #228be6;
            --bubble-user-text: #ffffff;
            --thought-color: #4dabf7;
            --comm-color: #15aabf;
            --name-ai-color: #1864ab;
            --name-user-color: #228be6;
            --title-color: #1864ab;
        }
        
        .theme-forest {
            --log-bg: #ebfbee;
            --log-text: #2b8a3e;
            --bubble-ai-bg: #d3f9d8;
            --bubble-ai-text: #2b8a3e;
            --bubble-user-bg: #40c057;
            --bubble-user-text: #ffffff;
            --thought-color: #69db7c;
            --comm-color: #38d9a9;
            --name-ai-color: #2b8a3e;
            --name-user-color: #40c057;
            --title-color: #2b8a3e;
        }
        
        .theme-sunset {
            --log-bg: #fff4e6;
            --log-text: #d9480f;
            --bubble-ai-bg: #ffe8cc;
            --bubble-ai-text: #d9480f;
            --bubble-user-bg: #fd7e14;
            --bubble-user-text: #ffffff;
            --thought-color: #ffa94d;
            --comm-color: #ff922b;
            --name-ai-color: #d9480f;
            --name-user-color: #fd7e14;
            --title-color: #d9480f;
        }
        
        .theme-rose {
            --log-bg: #fff0f6;
            --log-text: #c2255c;
            --bubble-ai-bg: #ffdeeb;
            --bubble-ai-text: #c2255c;
            --bubble-user-bg: #f06595;
            --bubble-user-text: #ffffff;
            --thought-color: #f783ac;
            --comm-color: #e64980;
            --name-ai-color: #c2255c;
            --name-user-color: #f06595;
            --title-color: #c2255c;
        }
        
        .theme-lavender {
            --log-bg: #f3f0ff;
            --log-text: #5f3dc4;
            --bubble-ai-bg: #e5dbff;
            --bubble-ai-text: #5f3dc4;
            --bubble-user-bg: #7950f2;
            --bubble-user-text: #ffffff;
            --thought-color: #9775fa;
            --comm-color: #845ef7;
            --name-ai-color: #5f3dc4;
            --name-user-color: #7950f2;
            --title-color: #5f3dc4;
        }
        
        /* ë¯¸ë“œë‚˜ì‡ - ë”¥ í¼í”Œ/ë¸”ë£¨ ê³„ì—´ */
        .theme-midnight {
            --log-bg: #0f0e17;
            --log-text: #a7a9be;
            --bubble-ai-bg: #1a1825;
            --bubble-ai-text: #fffffe;
            --bubble-user-bg: #7f5af0;
            --bubble-user-text: #fffffe;
            --thought-color: #9d8cff;
            --comm-color: #2cb67d;
            --name-ai-color: #fffffe;
            --name-user-color: #7f5af0;
            --title-color: #fffffe;
        }
        
        /* ê·¸ë˜íŒŒì´íŠ¸ - ì›Œë¯¸/ë¸Œë¼ìš´ ê³„ì—´ */
        .theme-graphite {
            --log-bg: #1c1917;
            --log-text: #d6d3d1;
            --bubble-ai-bg: #292524;
            --bubble-ai-text: #fafaf9;
            --bubble-user-bg: #c2410c;
            --bubble-user-text: #ffffff;
            --thought-color: #fb923c;
            --comm-color: #4ade80;
            --name-ai-color: #fafaf9;
            --name-user-color: #fb923c;
            --title-color: #fafaf9;
        }

        /* ë””ìŠ¤ì½”ë“œ - ì‹¤ì œ ë””ìŠ¤ì½”ë“œ ìƒ‰ìƒ */
        .theme-discord {
            --log-bg: #313338;
            --log-text: #dbdee1;
            --bubble-ai-bg: #2b2d31;
            --bubble-ai-text: #f2f3f5;
            --bubble-user-bg: #5865f2;
            --bubble-user-text: #ffffff;
            --thought-color: #949ba4;
            --comm-color: #23a559;
            --name-ai-color: #f2f3f5;
            --name-user-color: #5865f2;
            --title-color: #f2f3f5;
        }

        .theme-kakao {
            --log-bg: #b2c7d9;
            --log-text: #1e1e1e;
            --bubble-ai-bg: #ffffff;
            --bubble-ai-text: #1e1e1e;
            --bubble-user-bg: #fee500;
            --bubble-user-text: #1e1e1e;
            --thought-color: #5a5a5a;
            --comm-color: #3182f6;
            --name-ai-color: #1e1e1e;
            --name-user-color: #3182f6;
            --title-color: #1e1e1e;
        }

        /* ========== ê¸°ë³¸ ë¦¬ì…‹ & ë ˆì´ì•„ì›ƒ ========== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--app-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ========== í†µí•© í—¤ë” ========== */
        .app-header {
            padding: 12px 24px;
            height: 56px;
            border-bottom: 1px solid var(--panel-border);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            background: var(--panel-bg);
            flex-shrink: 0;
            box-sizing: border-box;
            z-index: 100;
        }
        
        .app-header .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-header h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #a18cd1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }
        
        .app-header .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .app-header .header-actions .btn {
            padding: 8px 14px;
            font-size: 13px;
        }
        
        .app-header .header-divider {
            width: 1px;
            height: 24px;
            background: var(--panel-border);
            margin: 0 8px;
        }
        
        .app-header .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-header .preview-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* ========== ì•± ë°”ë”” (ì‚¬ì´ë“œë°” + ë©”ì¸) ========== */
        .app-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ========== ì‚¬ì´ë“œë°” (ì„¤ì • íŒ¨ë„) ========== */
        .sidebar {
            width: 40%;
            min-width: 400px;
            max-width: 600px;
            background: var(--panel-bg);
            border-right: 1px solid var(--panel-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
        }

        /* ========== ì„¹ì…˜ ìŠ¤íƒ€ì¼ ========== */
        .section {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--accent);
            border-radius: 2px;
        }

        /* ========== í…Œë§ˆ ì„ íƒ ê·¸ë¦¬ë“œ ========== */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }

        .theme-btn {
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            min-height: 50px;
        }

        .theme-btn:hover {
            transform: scale(1.05);
        }

        .theme-btn.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(51, 154, 240, 0.3);
        }

        .theme-btn span {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: rgba(0,0,0,0.7);
            background: rgba(255,255,255,0.85);
            padding: 1px 4px;
            border-radius: 3px;
            white-space: nowrap;
        }

        /* í…Œë§ˆ ë²„íŠ¼ ê°œë³„ ìƒ‰ìƒ */
        .theme-btn[data-theme="default"] { background: linear-gradient(135deg, #339af0, #748ffc); }
        .theme-btn[data-theme="ocean"] { background: linear-gradient(135deg, #228be6, #15aabf); }
        .theme-btn[data-theme="forest"] { background: linear-gradient(135deg, #40c057, #38d9a9); }
        .theme-btn[data-theme="sunset"] { background: linear-gradient(135deg, #fd7e14, #ffc078); }
        .theme-btn[data-theme="rose"] { background: linear-gradient(135deg, #f06595, #e64980); }
        .theme-btn[data-theme="lavender"] { background: linear-gradient(135deg, #7950f2, #9775fa); }
        .theme-btn[data-theme="midnight"] { background: linear-gradient(135deg, #25262b, #4c6ef5); }
        .theme-btn[data-theme="graphite"] { background: linear-gradient(135deg, #343a40, #495057); }
        .theme-btn[data-theme="discord"] { background: linear-gradient(135deg, #5865f2, #36393f); }
        .theme-btn[data-theme="kakao"] { background: linear-gradient(135deg, #fee500, #b2c7d9); }

        /* ========== ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ========== */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .input-row .input-group {
            margin-bottom: 0;
        }
        
        /* ìƒ‰ìƒ ê·¸ë¦¬ë“œ (3ì—´) */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .color-grid .color-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .color-grid .color-item label {
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .color-grid input[type="color"] {
            width: 100%;
            height: 32px;
        }
        
        .input-group {
            margin-bottom: 12px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            background: var(--panel-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            line-height: 1.6;
        }

        input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-row input[type="text"] {
            flex: 1;
        }

        /* ========== ë²„íŠ¼ ìŠ¤íƒ€ì¼ ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--input-border);
        }

        .btn-secondary:hover {
            background: var(--panel-border);
        }

        .btn-success {
            background: #40c057;
            color: white;
        }

        .btn-success:hover {
            background: #37b24d;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* ========== ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ ========== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-wrapper {
            flex: 1;
            overflow: auto;
            padding: 40px;
            /* íˆ¬ëª… ì²´í¬ë³´ë“œ íŒ¨í„´ - ë‹¤í¬ëª¨ë“œ */
            background-color: #1a1b1e;
            background-image: 
                linear-gradient(45deg, #252629 25%, transparent 25%),
                linear-gradient(-45deg, #252629 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #252629 75%),
                linear-gradient(-45deg, transparent 75%, #252629 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .preview-wrapper.html-mode {
            background: var(--input-bg);
            background-image: none;
        }
        
        .html-code-view {
            display: none;
            width: 100%;
            max-width: 1000px;
            height: 100%;
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary);
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-all;
            border: 1px solid var(--panel-border);
        }
        
        .preview-wrapper.html-mode .html-code-view {
            display: block;
        }
        
        .preview-wrapper.html-mode #log-preview {
            display: none;
        }
        
        .preview-toggle.active {
            background: var(--accent) !important;
            color: white !important;
        }

        /* ========== ë¡œê·¸ í”„ë¦¬ë·° ì˜ì—­ ========== */
        #log-preview {
            width: var(--log-width);
            min-height: 400px;
            background: var(--log-bg);
            color: var(--log-text);
            border-radius: var(--log-radius);
            padding: 32px;
            font-size: var(--log-font-size);
            line-height: var(--log-line-height);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05);
            position: relative;
        }
        
        /* ì™¸ê³½ í…Œë§ˆ ìŠ¤íƒ€ì¼ - ìƒ‰ìƒ ì˜í–¥ ì—†ì´ í…Œë‘ë¦¬ë§Œ */
        
        /* í¸ì§€ì§€ - ìš°ì•„í•œ ë”ë¸” í…Œë‘ë¦¬ + ê½ƒë¬´ëŠ¬ ì½”ë„ˆ */
        #log-preview.frame-letter {
            border: 3px double rgba(180, 140, 100, 0.5);
            box-shadow: 
                0 0 0 8px rgba(180, 140, 100, 0.08),
                0 0 0 12px rgba(180, 140, 100, 0.15),
                0 8px 32px rgba(0,0,0,0.12);
            position: relative;
        }
        #log-preview.frame-letter::before,
        #log-preview.frame-letter::after {
            content: 'ğŸŒ¸';
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
        }
        #log-preview.frame-letter::before { top: 12px; left: 12px; }
        #log-preview.frame-letter::after { bottom: 12px; right: 12px; content: 'ğŸŒ¼'; }
        
        /* ë‹¤ì´ì–´ë¦¬ - ê¹¨ë—í•œ ì¤„ë¬´ëŠ¬ + ìŠ¤í”„ë§ ë°”ì¸ë” */
        #log-preview.frame-diary {
            border-left: none;
            border-radius: 4px 16px 16px 4px;
            box-shadow: 
                -4px 0 0 #e8e0d5,
                -8px 0 0 #dc8a78,
                0 4px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        #log-preview.frame-diary::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, rgba(220,138,120,0.3) 10%, rgba(220,138,120,0.3) 90%, transparent);
        }
        
        /* ë©”ëª¨ì§€ - í¬ìŠ¤íŠ¸ì‡ ìŠ¤íƒ€ì¼ */
        #log-preview.frame-memo {
            border: none;
            border-radius: 2px;
            box-shadow: 
                0 1px 3px rgba(0,0,0,0.12),
                0 4px 8px rgba(0,0,0,0.06);
            position: relative;
            clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 0 100%);
        }
        #log-preview.frame-memo::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(225deg, transparent 50%, rgba(0,0,0,0.06) 50%);
        }
        #log-preview.frame-memo::after {
            content: 'ğŸ“Œ';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }
        
        /* ê¸ˆë°• - ê³ ê¸‰ ì•¡ì í”„ë ˆì„ */
        #log-preview.frame-gold {
            border: none;
            box-shadow: 
                inset 0 0 0 1px rgba(212,175,55,0.5),
                inset 0 0 0 4px rgba(255,248,220,0.4),
                inset 0 0 0 5px rgba(212,175,55,0.6),
                inset 0 0 0 8px rgba(255,248,220,0.3),
                inset 0 0 0 9px rgba(184,134,11,0.5),
                0 10px 40px rgba(0,0,0,0.15);
            position: relative;
        }
        #log-preview.frame-gold::before {
            content: '';
            position: absolute;
            inset: 16px;
            border: 1px solid rgba(212,175,55,0.3);
            pointer-events: none;
        }
        #log-preview.frame-gold::after {
            content: '';
            position: absolute;
            top: 12px; left: 12px; right: 12px; bottom: 12px;
            border: 1px solid rgba(212,175,55,0.15);
            pointer-events: none;
        }
        
        /* ì¥ì‹ - ì•„ë¥´ë°ì½” ì½”ë„ˆ íŒ¨í„´ */
        #log-preview.frame-ornate {
            border: 1px solid rgba(120, 80, 200, 0.3);
            box-shadow: 
                0 0 0 6px transparent,
                0 8px 32px rgba(120, 80, 200, 0.15);
            position: relative;
        }
        #log-preview.frame-ornate::before,
        #log-preview.frame-ornate::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 2px solid rgba(120, 80, 200, 0.4);
        }
        #log-preview.frame-ornate::before {
            top: 8px; left: 8px;
            border-right: none; border-bottom: none;
            border-radius: 8px 0 0 0;
        }
        #log-preview.frame-ornate::after {
            bottom: 8px; right: 8px;
            border-left: none; border-top: none;
            border-radius: 0 0 8px 0;
        }
        
        /* ì²´í¬ë¬´ëŠ¬ - ë§ˆë¦„ëª¨ */
        #log-preview.frame-check {
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
        }
        #log-preview.frame-check::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.02) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.02) 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
            border-radius: inherit;
            pointer-events: none;
        }
        
        /* í…Œì´í”„ - ê·€ì—¬ìš´ ë§ˆìŠ¤í‚¤ í…Œì´í”„ */
        #log-preview.frame-tape {
            position: relative;
            box-shadow: 0 6px 24px rgba(0,0,0,0.1);
        }
        #log-preview.frame-tape::before,
        #log-preview.frame-tape::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 24px;
            background: linear-gradient(135deg, rgba(255,220,180,0.9), rgba(255,235,200,0.9));
            border: 1px dashed rgba(180,140,100,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #log-preview.frame-tape::before {
            top: -12px; left: 20px;
            transform: rotate(-3deg);
        }
        #log-preview.frame-tape::after {
            bottom: -12px; right: 20px;
            transform: rotate(2deg);
        }
        
        /* ë¹ˆí‹°ì§€ - ì„¸í”¼ì•„ ì•¡ì */
        #log-preview.frame-vintage {
            border: none;
            box-shadow: 
                inset 0 0 0 2px rgba(120,90,60,0.2),
                inset 0 0 0 6px rgba(255,250,240,0.5),
                inset 0 0 0 8px rgba(120,90,60,0.15),
                inset 0 0 100px rgba(120,90,60,0.03),
                0 4px 20px rgba(60,40,20,0.15);
            position: relative;
        }
        #log-preview.frame-vintage::before,
        #log-preview.frame-vintage::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid rgba(120,90,60,0.25);
        }
        #log-preview.frame-vintage::before {
            top: 16px; left: 16px;
            border-right: none; border-bottom: none;
        }
        #log-preview.frame-vintage::after {
            bottom: 16px; right: 16px;
            border-left: none; border-top: none;
        }
        
        /* í´ë¼ë¡œì´ë“œ - ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ */
        #log-preview.frame-polaroid {
            padding-bottom: 48px !important;
            border: 1px solid rgba(0,0,0,0.08);
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.06),
                0 8px 24px rgba(0,0,0,0.1),
                0 16px 48px rgba(0,0,0,0.06);
            position: relative;
        }
        #log-preview.frame-polaroid::after {
            content: 'â™¡';
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: rgba(200,100,100,0.4);
        }
        
        /* ========== ë§ˆí¬ë‹¤ìš´ ê°•ì¡° ========== */ */
        .md-bold {
            font-weight: 700;
        }
        
        .md-italic {
            font-style: italic;
        }
        
        .md-highlight {
            background: linear-gradient(120deg, #ffd54f 0%, #ffeb3b 100%);
            padding: 0 4px;
            border-radius: 3px;
            color: #1d2129;
        }
        
        .md-emphasis {
            color: #e03131;
            font-weight: 600;
        }
        
        .md-underline {
            text-decoration: underline;
            text-decoration-color: currentColor;
            text-underline-offset: 2px;
        }
        
        .md-strike {
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        /* ========== ë§í’ì„  ì¶”ê°€ ìŠ¤íƒ€ì¼ ========== */
        .bubble.whisper {
            background: rgba(0,0,0,0.05) !important;
            color: var(--log-text) !important;
            font-size: 0.9em;
            opacity: 0.7;
        }
        
        .bubble.shout {
            font-weight: 700;
            font-size: 1.1em;
        }

        /* ========== ë¡œê·¸ ì œëª© ========== */
        .log-title {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--title-color);
        }

        .log-title h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--title-color);
        }

        .log-title p {
            font-size: 14px;
            opacity: 0.7;
            color: var(--title-color);
        }

        .log-meta {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            font-size: 12px;
        }

        .log-meta-item {
            background: rgba(0,0,0,0.05);
            padding: 4px 10px;
            border-radius: 12px;
            color: var(--log-text);
            opacity: 0.8;
        }

        .log-meta-item a {
            color: inherit;
            text-decoration: underline;
        }

        /* ========== ì‚½ì…ëœ ì´ë¯¸ì§€ ========== */
        .log-image {
            margin: 16px 0;
            text-align: center;
        }

        .log-image img {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ========== ëŒ€í™” ë¸”ë¡ ========== */
        .chat-block {
            margin-bottom: 12px;
        }

        .chat-block:last-child {
            margin-bottom: 0;
        }

        /* í™”ì ì´ë¦„ */
        .speaker-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .chat-block.ai .speaker-name {
            color: var(--name-ai-color);
        }

        .chat-block.user .speaker-name {
            color: var(--name-user-color);
            text-align: right;
        }

        /* ë§í’ì„  ì»¨í…Œì´ë„ˆ */
        .bubbles {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .chat-block.user .bubbles {
            align-items: flex-end;
        }

        .chat-block.ai .bubbles {
            align-items: flex-start;
        }

        /* ê°œë³„ ë§í’ì„  */
        .bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            word-break: break-word;
            white-space: pre-wrap;
        }

        /* AI ë§í’ì„  */
        .chat-block.ai .bubble {
            background: var(--bubble-ai-bg);
            color: var(--bubble-ai-text);
            border-bottom-left-radius: 6px;
        }

        /* USER ë§í’ì„  */
        .chat-block.user .bubble {
            background: var(--bubble-user-bg);
            color: var(--bubble-user-text);
            border-bottom-right-radius: 6px;
        }

        /* ëŒ€ì‚¬ ë§í’ì„  (ê¸°ë³¸) */
        .bubble.dialogue {
            /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            display: block;
        }

        /* ìƒê° ë§í’ì„  */
        .bubble.thought {
            background: transparent !important;
            border: 2px dashed var(--thought-color);
            color: var(--thought-color) !important;
            font-style: italic;
        }

        /* í†µì‹  ë§í’ì„  */
        .bubble.comm {
            background: transparent !important;
            border: 2px solid var(--comm-color);
            color: var(--comm-color) !important;
            position: relative;
            padding-left: 36px;
        }

        .bubble.comm::before {
            content: 'ğŸ“¡';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }

        /* ========== ë‚˜ë ˆì´ì…˜ (ì§€ë¬¸) ========== */
        .narration {
            text-align: center;
            padding: 6px 16px;
            margin: 4px 0;
            color: var(--log-text);
            font-style: italic;
            position: relative;
        }
        
        /* ë‚˜ë ˆì´ì…˜ ì•ì— ë§í’ì„ ì´ ìˆì„ ë•Œë§Œ ìœ„ìª½ ì„  í‘œì‹œ */
        .chat-block + .narration::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -4px;
            transform: translateX(-50%);
            width: 40px;
            height: 1px;
            background: currentColor;
            opacity: 0.2;
        }
        
        /* ë‚˜ë ˆì´ì…˜ ë’¤ì— ë§í’ì„ ì´ ìˆì„ ë•Œë§Œ ì•„ë˜ìª½ ì„  í‘œì‹œ */
        .narration:has(+ .chat-block)::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -4px;
            transform: translateX(-50%);
            width: 40px;
            height: 1px;
            background: currentColor;
            opacity: 0.2;
        }

        /* ========== êµ¬ë¶„ì„  ========== */
        .divider {
            text-align: center;
            margin: 12px 0;
            opacity: 0.3;
        }

        .divider::before {
            content: 'â€¢ â€¢ â€¢';
            letter-spacing: 8px;
        }

        /* ========== ë°˜ì‘í˜• ========== */
        @media (max-width: 900px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 50vh;
            }
            
            .preview-wrapper {
                padding: 20px;
            }
            
            #log-preview {
                width: 100%;
                max-width: 100%;
            }
        }

        /* ========== ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--input-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* ========== íƒ­ ì‹œìŠ¤í…œ ========== */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            background: var(--panel-border);
        }

        .tab.active {
            background: var(--accent);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== ì •ê·œì‹ ê·œì¹™ ë¦¬ìŠ¤íŠ¸ ========== */
        .rule-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rule-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .rule-item input {
            flex: 1;
        }

        .rule-item .btn-remove {
            width: 36px;
            height: 36px;
            padding: 0;
            background: #e03131;
            color: white;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .btn-add-rule {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 2px dashed var(--input-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-add-rule:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* ========== ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ ========== */
        .log-block {
            background: var(--panel-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .log-block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--input-bg);
            border-bottom: 1px solid var(--input-border);
            cursor: pointer;
        }
        
        .log-block-header:hover {
            background: var(--panel-border);
        }
        
        .log-block-title {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .log-block-title input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 13px;
            width: 150px;
            padding: 4px;
        }
        
        .log-block-title input:focus {
            outline: none;
            background: var(--panel-bg);
            border-radius: 4px;
        }
        
        .log-block-actions {
            display: flex;
            gap: 4px;
        }
        
        .log-block-actions button {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s, opacity 0.1s;
        }
        
        .log-block-actions button:hover {
            transform: scale(1.1);
            opacity: 0.9;
        }
        
        .log-block-actions .btn-toggle {
            background: var(--accent);
            color: white;
        }
        
        .log-block-actions .btn-delete {
            background: #e03131;
            color: white;
            font-size: 18px;
        }
        
        .log-block-actions .btn-move {
            background: var(--panel-border);
            color: var(--text-primary);
        }
        
        .log-block-content {
            padding: 12px;
        }
        
        .log-block-content.collapsed {
            display: none;
        }
        
        .log-block textarea {
            min-height: 100px;
        }
        
        .btn-add-block {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px dashed var(--accent);
            border-radius: 8px;
            color: var(--accent);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-add-block:hover {
            background: rgba(51, 154, 240, 0.1);
        }
        
        /* ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
        .mode-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .mode-toggle:hover {
            background: var(--panel-border);
        }
    </style>
</head>
<body>
    <!-- í†µí•© í—¤ë” -->
    <header class="app-header">
        <div class="header-left">
            <h1>ğŸ§ Log Cupcake</h1>
            <button class="mode-toggle" onclick="toggleDarkMode()" title="ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ ì „í™˜">ğŸŒ™</button>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="generateLog()">ğŸ”„ ìƒì„±</button>
            <button class="btn btn-success" onclick="saveImage()">ğŸ“· ì €ì¥</button>
        </div>
        <div class="header-divider"></div>
        <div class="header-right">
            <button class="btn btn-secondary preview-toggle" onclick="togglePreviewMode()">ğŸ“„ ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn btn-secondary" onclick="copyHTML()">ğŸ“‹ HTML ë³µì‚¬</button>
        </div>
    </header>
    
    <!-- ì•± ë°”ë”” (ì‚¬ì´ë“œë°” + ë©”ì¸) -->
    <div class="app-body">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-content">
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="tabs">
                <button class="tab active" data-tab="input">ğŸ“ ì…ë ¥</button>
                <button class="tab" data-tab="theme">ğŸ¨ í…Œë§ˆ</button>
                <button class="tab" data-tab="style">âš™ï¸ ìŠ¤íƒ€ì¼</button>
            </div>

            <!-- ì…ë ¥ íƒ­ -->
            <div id="tab-input" class="tab-content active">
                <!-- ì œëª© ì„¹ì…˜ -->
                <div class="section">
                    <div class="section-title">ì œëª© ì„¤ì •</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">ë¡œê·¸ ì œëª©</label>
                            <input type="text" id="log-title" placeholder="ì˜ˆ: Chapter 1. ì‹œì‘">
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë¶€ì œëª©</label>
                            <input type="text" id="log-subtitle" placeholder="ì˜ˆ: 2025ë…„ ì–´ëŠ ë‚ ">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">AI ëª¨ë¸</label>
                            <input type="text" id="ai-model-input" placeholder="ì§ì ‘ ì…ë ¥">
                            <select id="ai-model" style="width:100%; padding:8px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:6px; color:var(--text-primary); margin-top:4px; font-size:12px;">
                            <option value="">-- ëª¨ë¸ ì„ íƒ --</option>
                            <option value="Gemini 2.5 Pro">Gemini 2.5 Pro</option>
                            <option value="Gemini 2.5 Flash">Gemini 2.5 Flash</option>
                            <option value="Gemini 2.0 Flash">Gemini 2.0 Flash</option>
                            <option value="Gemini 3 Pro">Gemini 3 Pro</option>
                            <option value="Claude Sonnet 4">Claude Sonnet 4</option>
                            <option value="Claude Sonnet 4.5">Claude Sonnet 4.5</option>
                            <option value="Claude Haiku 4.5">Claude Haiku 4.5</option>
                            <option value="Claude Opus 4.5">Claude Opus 4.5</option>
                            <option value="Claude Opus 4.1">Claude Opus 4.1</option>
                            <option value="Claude Opus 4">Claude Opus 4</option>
                            <option value="GPT-4.1">GPT-4.1</option>
                            <option value="GPT-4o-latest">GPT-4o-latest</option>
                            <option value="GPT-5">GPT-5</option>
                            <option value="GPT-5-latest">GPT-5-latest</option>
                            <option value="GPT-5.1">GPT-5.1</option>
                            <option value="GPT-5.1-latest">GPT-5.1-latest</option>
                            <option value="DeepSeek">DeepSeek</option>
                        </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">í”„ë¡¬í”„íŠ¸ ì´ë¦„</label>
                            <input type="text" id="prompt-name" placeholder="ì˜ˆ: MyPrompt v2.0">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">ë²ˆì—­</label>
                            <input type="text" id="translation-input" placeholder="ì§ì ‘ ì…ë ¥">
                            <select id="translation" style="width:100%; padding:8px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:6px; color:var(--text-primary); margin-top:4px; font-size:12px;">
                                <option value="">-- ë²ˆì—­ê¸° ì„ íƒ --</option>
                                <option value="Gemini 2.5 Pro">Gemini 2.5 Pro</option>
                                <option value="Gemini 2.5 Flash">Gemini 2.5 Flash</option>
                                <option value="Gemini 2.0 Flash">Gemini 2.0 Flash</option>
                                <option value="Gemini 3 Pro">Gemini 3 Pro</option>
                                <option value="Claude Sonnet 4">Claude Sonnet 4</option>
                                <option value="Claude Sonnet 4.5">Claude Sonnet 4.5</option>
                                <option value="Claude Haiku 4.5">Claude Haiku 4.5</option>
                                <option value="Claude Opus 4.5">Claude Opus 4.5</option>
                                <option value="Claude Opus 4.1">Claude Opus 4.1</option>
                                <option value="Claude Opus 4">Claude Opus 4</option>
                                <option value="GPT-4.1">GPT-4.1</option>
                                <option value="GPT-4o-latest">GPT-4o-latest</option>
                                <option value="GPT-5">GPT-5</option>
                                <option value="GPT-5-latest">GPT-5-latest</option>
                                <option value="GPT-5.1">GPT-5.1</option>
                                <option value="GPT-5.1-latest">GPT-5.1-latest</option>
                                <option value="DeepSeek">DeepSeek</option>
                                <option value="DeepL">DeepL</option>
                                <option value="Papago">Papago</option>
                                <option value="Google ë²ˆì—­">Google ë²ˆì—­</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ìºë¦­í„° ë§í¬</label>
                            <input type="text" id="char-link" placeholder="https://...">
                        </div>
                    </div>
                </div>

                <!-- ìºë¦­í„° ì´ë¦„ -->
                <div class="section">
                    <div class="section-title">ìºë¦­í„° ì´ë¦„</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">AI ì´ë¦„</label>
                            <input type="text" id="name-ai" value="AI" placeholder="AI ìºë¦­í„° ì´ë¦„">
                        </div>
                        <div class="input-group">
                            <label class="input-label">USER ì´ë¦„</label>
                            <input type="text" id="name-user" value="USER" placeholder="ì‚¬ìš©ì ì´ë¦„">
                        </div>
                    </div>
                </div>

                <!-- ì´ë¯¸ì§€ ì‚½ì… -->
                <div class="section">
                    <div class="section-title">ì´ë¯¸ì§€ ì‚½ì…</div>
                    <div class="input-group">
                        <label class="input-label">ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ (ë¸”ë¡ ë²ˆí˜¸ ì§€ì •)</label>
                        <input type="file" id="image-file-input" accept="image/*" style="display:none;" multiple>
                        <button class="btn btn-secondary" onclick="document.getElementById('image-file-input').click()" style="width:100%;">ğŸ“ ì´ë¯¸ì§€ ì¶”ê°€</button>
                        <div id="image-list" style="margin-top:10px;"></div>
                    </div>
                </div>

                <!-- ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ -->
                <div class="section">
                    <div class="section-title">ë¡œê·¸ ë¸”ë¡</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.6;">
                        <b>í™”ì:</b> AI: / USER: | <b>ëŒ€ì‚¬:</b> "ëŒ€ì‚¬" | <b>ìƒê°:</b> 'ìƒê°'<br>
                        <b>í†µì‹ :</b> &gt; ë©”ì‹œì§€ | <b>ì†ì‚­ì„:</b> ((ë©”ì‹œì§€)) | <b>ì™¸ì¹¨:</b> ! ë©”ì‹œì§€<br>
                        <b>ë‚˜ë ˆì´ì…˜:</b> - í…ìŠ¤íŠ¸ | <b>êµ¬ë¶„ì„ :</b> ---<br>
                        <b>ë§ˆí¬ë‹¤ìš´:</b> **êµµê²Œ** *ê¸°ìš¸ì„* ^<span></span>í•˜ì´ë¼ì´íŠ¸^ ~~ì·¨ì†Œ~~
                    </div>
                    <div id="log-blocks-container">
                        <div class="log-block" data-block-id="1">
                            <div class="log-block-header" onclick="toggleBlock(this)">
                                <div class="log-block-title">
                                    <span>ğŸ“</span>
                                    <input type="text" value="ë¸”ë¡ 1" onclick="event.stopPropagation()" onchange="updateBlockTitle(this)">
                                </div>
                                <div class="log-block-actions">
                                    <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, -1)" title="ìœ„ë¡œ">â–²</button>
                                    <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, 1)" title="ì•„ë˜ë¡œ">â–¼</button>
                                    <button class="btn-toggle" title="ì ‘ê¸°/í¼ì¹˜ê¸°">â–¼</button>
                                    <button class="btn-delete" onclick="event.stopPropagation(); deleteBlock(this)" title="ì‚­ì œ">Ã—</button>
                                </div>
                            </div>
                            <div class="log-block-content">
                                <textarea class="log-block-input" placeholder='AI: "ì•ˆë…•í•˜ì„¸ìš”!"
USER: "ë°˜ê°€ì›Œìš”."
- ë‚˜ë ˆì´ì…˜ í…ìŠ¤íŠ¸'></textarea>
                            </div>
                        </div>
                    </div>
                    <button class="btn-add-block" onclick="addLogBlock()">â• ìƒˆ ë¸”ë¡ ì¶”ê°€</button>
                </div>

                <!-- ì •ê·œì‹ ì¹˜í™˜ -->
                <div class="section">
                    <div class="section-title">ë‹¨ì–´ ë³€í™˜ (ì •ê·œì‹)</div>
                    <div class="rule-list" id="rule-list">
                        <div class="rule-item">
                            <input type="text" placeholder="ì°¾ì„ ë‹¨ì–´" class="rule-find">
                            <span style="color: var(--text-secondary);">â†’</span>
                            <input type="text" placeholder="ë°”ê¿€ ë‹¨ì–´" class="rule-replace">
                            <button class="btn-remove" onclick="removeRule(this)">Ã—</button>
                        </div>
                    </div>
                    <button class="btn-add-rule" onclick="addRule()">+ ê·œì¹™ ì¶”ê°€</button>
                </div>
            </div>

            <!-- í…Œë§ˆ íƒ­ -->
            <div id="tab-theme" class="tab-content">
                <div class="section">
                    <div class="section-title">í”„ë¦¬ì…‹ í…Œë§ˆ</div>
                    <div class="theme-grid">
                        <button class="theme-btn active" data-theme="default"><span>ê¸°ë³¸</span></button>
                        <button class="theme-btn" data-theme="ocean"><span>ì˜¤ì…˜</span></button>
                        <button class="theme-btn" data-theme="forest"><span>í¬ë ˆìŠ¤íŠ¸</span></button>
                        <button class="theme-btn" data-theme="sunset"><span>ì„ ì…‹</span></button>
                        <button class="theme-btn" data-theme="rose"><span>ë¡œì¦ˆ</span></button>
                        <button class="theme-btn" data-theme="lavender"><span>ë¼ë²¤ë”</span></button>
                        <button class="theme-btn" data-theme="midnight"><span>ë¯¸ë“œë‚˜ì‡</span></button>
                        <button class="theme-btn" data-theme="graphite"><span>ê·¸ë˜íŒŒì´íŠ¸</span></button>
                        <button class="theme-btn" data-theme="discord"><span>ë””ìŠ¤ì½”ë“œ</span></button>
                        <button class="theme-btn" data-theme="kakao"><span>ì¹´ì¹´ì˜¤í†¡</span></button>
                    </div>
                </div>

                <!-- ì»¤ìŠ¤í…€ ìƒ‰ìƒ -->
                <div class="section">
                    <div class="section-title">ì»¤ìŠ¤í…€ ìƒ‰ìƒ</div>
                    <div class="color-grid">
                        <div class="color-item">
                            <label>ë¬˜ì‚¬(ë‚˜ë ˆì´ì…˜)</label>
                            <input type="color" id="color-text" value="#1d2129">
                            <input type="text" id="color-text-text" value="#1d2129" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ë§í’ì„ </label>
                            <input type="color" id="color-ai-bg" value="#f1f3f5">
                            <input type="text" id="color-ai-bg-text" value="#f1f3f5" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ë§í’ì„ </label>
                            <input type="color" id="color-user-bg" value="#339af0">
                            <input type="text" id="color-user-bg-text" value="#339af0" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ëŒ€ì‚¬</label>
                            <input type="color" id="color-ai-text" value="#1d2129">
                            <input type="text" id="color-ai-text-text" value="#1d2129" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ëŒ€ì‚¬</label>
                            <input type="color" id="color-user-text" value="#ffffff">
                            <input type="text" id="color-user-text-text" value="#ffffff" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ìƒê° ë§í’ì„ </label>
                            <input type="color" id="color-thought" value="#748ffc">
                            <input type="text" id="color-thought-text" value="#748ffc" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í†µì‹  ë§í’ì„ </label>
                            <input type="color" id="color-comm" value="#20c997">
                            <input type="text" id="color-comm-text" value="#20c997" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ë´‡ ì´ë¦„í‘œ</label>
                            <input type="color" id="color-name-ai" value="#495057">
                            <input type="text" id="color-name-ai-text" value="#495057" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>í¼ì†Œ ì´ë¦„í‘œ</label>
                            <input type="color" id="color-name-user" value="#339af0">
                            <input type="text" id="color-name-user-text" value="#339af0" style="display:none;">
                        </div>
                        <div class="color-item">
                            <label>ì œëª©/ë¶€ì œëª©</label>
                            <input type="color" id="color-title" value="#1d2129">
                            <input type="text" id="color-title-text" value="#1d2129" style="display:none;">
                        </div>
                    </div>
                    <div class="btn-group" style="margin-top: 12px;">
                        <button class="btn btn-primary" onclick="saveCustomTheme()">ğŸ’¾ í…Œë§ˆ ì €ì¥</button>
                    </div>
                    <div id="saved-themes" style="margin-top: 12px;"></div>
                </div>

                <!-- ë°°ê²½ ì„¤ì • -->
                <div class="section">
                    <div class="section-title">ë°°ê²½ ì„¤ì •</div>
                    <div class="input-group">
                        <label class="input-label">ë°°ê²½ íƒ€ì…</label>
                        <select id="bg-type" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                            <option value="solid">ë‹¨ìƒ‰</option>
                            <option value="gradient">ê·¸ë¼ë°ì´ì…˜</option>
                        </select>
                    </div>
                    <div id="bg-solid-options">
                        <div class="input-group">
                            <label class="input-label">ë°°ê²½ìƒ‰</label>
                            <div class="color-row">
                                <input type="color" id="bg-solid-color" value="#ffffff">
                                <input type="text" id="bg-solid-color-text" value="#ffffff">
                            </div>
                        </div>
                    </div>
                    <div id="bg-gradient-options" style="display:none;">
                        <div class="input-group">
                            <label class="input-label">ê·¸ë¼ë°ì´ì…˜ í”„ë¦¬ì…‹</label>
                            <select id="gradient-select" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                                <option value="custom">ì§ì ‘ ì„¤ì •</option>
                                <option value="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">í¼í”Œ ë“œë¦¼</option>
                                <option value="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">í”Œë¼ë¯¼ê³ </option>
                                <option value="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">ì˜¤ì…˜ ë¸”ë£¨</option>
                                <option value="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)">ë¯¼íŠ¸ ê·¸ë¦°</option>
                                <option value="linear-gradient(135deg, #fa709a 0%, #fee140 100%)">ì„ ì…‹ ê¸€ë¡œìš°</option>
                                <option value="linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)">íŒŒìŠ¤í…” ë“œë¦¼</option>
                                <option value="linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)">í”¼ì¹˜ í¬ë¦¼</option>
                                <option value="linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)">ë¼ë²¤ë” ë¯¸ìŠ¤íŠ¸</option>
                                <option value="linear-gradient(180deg, #2c3e50 0%, #4ca1af 100%)">ë§ˆì œìŠ¤í‹± ë‹¤í¬</option>
                                <option value="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)">ë‹¤í¬ ë°¤í•˜ëŠ˜</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ì‹œì‘ ìƒ‰ìƒ</label>
                            <div class="color-row">
                                <input type="color" id="gradient-start" value="#667eea">
                                <input type="text" id="gradient-start-text" value="#667eea">
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë ìƒ‰ìƒ</label>
                            <div class="color-row">
                                <input type="color" id="gradient-end" value="#764ba2">
                                <input type="text" id="gradient-end-text" value="#764ba2">
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">ë°©í–¥ (ë„)</label>
                            <input type="number" id="gradient-angle" value="135" min="0" max="360">
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="applyBackground()" style="width:100%; margin-top:8px;">ë°°ê²½ ì ìš©</button>
                </div>

                <!-- ì™¸ê³½ í…Œë§ˆ -->
                <div class="section">
                    <div class="section-title">ì™¸ê³½ í…Œë§ˆ</div>
                    <div class="input-group">
                        <label class="input-label">í”„ë ˆì„ ìŠ¤íƒ€ì¼</label>
                        <select id="frame-select" style="width:100%; padding:10px; background:var(--panel-bg); border:1px solid var(--input-border); border-radius:8px; color:var(--text-primary);">
                            <option value="none">ì—†ìŒ</option>
                            <option value="letter">í¸ì§€ì§€ ê°ì„±</option>
                            <option value="diary">ë‹¤ì´ì–´ë¦¬ ê°ì„±</option>
                            <option value="memo">ë©”ëª¨ì§€ ê°ì„±</option>
                            <option value="gold">ê¸ˆë°• í”„ë ˆì„</option>
                            <option value="ornate">ì¥ì‹ í”„ë ˆì„</option>
                            <option value="check">ì²´í¬ë¬´ëŠ¬</option>
                            <option value="tape">í…Œì´í”„ ë¶™ì´ê¸°</option>
                            <option value="vintage">ë¹ˆí‹°ì§€</option>
                            <option value="polaroid">í´ë¼ë¡œì´ë“œ</option>
                        </select>
                    </div>
                </div>

                <!-- ì „ì²´ í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° -->
                <div class="section">
                    <div class="section-title">í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="savePreset()">ğŸ’¾ í”„ë¦¬ì…‹ ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="exportPreset()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                    <div class="input-group" style="margin-top:12px;">
                        <input type="file" id="import-preset" accept=".json" style="display:none;">
                        <button class="btn btn-secondary" onclick="document.getElementById('import-preset').click()" style="width:100%;">ğŸ“¥ í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    </div>
                    <div id="saved-presets" style="margin-top: 12px;"></div>
                </div>
            </div>

            <!-- ìŠ¤íƒ€ì¼ íƒ­ -->
            <div id="tab-style" class="tab-content">
                <div class="section">
                    <div class="section-title">ë ˆì´ì•„ì›ƒ</div>
                    <div class="input-group">
                        <label class="input-label">ì»¨í…Œì´ë„ˆ ë„ˆë¹„ (px)</label>
                        <input type="number" id="style-width" value="1000" min="300" max="1500">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° (px)</label>
                        <input type="number" id="style-radius" value="16" min="0" max="50">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">íƒ€ì´í¬ê·¸ë˜í”¼</div>
                    <div class="input-group">
                        <label class="input-label">ê¸€ì í¬ê¸° (px)</label>
                        <input type="number" id="style-font-size" value="15" min="10" max="24">
                    </div>
                    <div class="input-group">
                        <label class="input-label">ì¤„ ê°„ê²©</label>
                        <input type="number" id="style-line-height" value="1.7" min="1" max="3" step="0.1">
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="applyStyles()" style="width: 100%;">ìŠ¤íƒ€ì¼ ì ìš©</button>
            </div>
        </div>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="preview-wrapper">
            <div id="log-preview" class="theme-default">
                <div style="text-align: center; color: var(--text-secondary); padding: 60px 20px;">
                    <p style="font-size: 48px; margin-bottom: 16px;">âœ¨</p>
                    <p>ì™¼ìª½ì—ì„œ ë¡œê·¸ë¥¼ ì…ë ¥í•˜ê³ <br>'ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
            </div>
            <div id="html-code-view" class="html-code-view"></div>
        </div>
    </main>
    </div>

    <script>
        // ========== íƒ­ ì‹œìŠ¤í…œ ==========
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // ========== í…Œë§ˆ ìƒ‰ìƒ ì •ì˜ ==========
        const themeColors = {
            'default': {
                logBg: '#ffffff', logText: '#1d2129',
                aiBg: '#f1f3f5', aiText: '#1d2129',
                userBg: '#339af0', userText: '#ffffff',
                thought: '#748ffc', comm: '#20c997',
                nameAi: '#495057', nameUser: '#339af0', title: '#1d2129'
            },
            'ocean': {
                logBg: '#e7f5ff', logText: '#1864ab',
                aiBg: '#d0ebff', aiText: '#1864ab',
                userBg: '#228be6', userText: '#ffffff',
                thought: '#4dabf7', comm: '#15aabf',
                nameAi: '#1864ab', nameUser: '#228be6', title: '#1864ab'
            },
            'forest': {
                logBg: '#ebfbee', logText: '#2b8a3e',
                aiBg: '#d3f9d8', aiText: '#2b8a3e',
                userBg: '#40c057', userText: '#ffffff',
                thought: '#69db7c', comm: '#38d9a9',
                nameAi: '#2b8a3e', nameUser: '#40c057', title: '#2b8a3e'
            },
            'sunset': {
                logBg: '#fff4e6', logText: '#d9480f',
                aiBg: '#ffe8cc', aiText: '#d9480f',
                userBg: '#fd7e14', userText: '#ffffff',
                thought: '#ffa94d', comm: '#ff922b',
                nameAi: '#d9480f', nameUser: '#fd7e14', title: '#d9480f'
            },
            'rose': {
                logBg: '#fff0f6', logText: '#c2255c',
                aiBg: '#ffdeeb', aiText: '#c2255c',
                userBg: '#f06595', userText: '#ffffff',
                thought: '#f783ac', comm: '#e64980',
                nameAi: '#c2255c', nameUser: '#f06595', title: '#c2255c'
            },
            'lavender': {
                logBg: '#f3f0ff', logText: '#5f3dc4',
                aiBg: '#e5dbff', aiText: '#5f3dc4',
                userBg: '#7950f2', userText: '#ffffff',
                thought: '#9775fa', comm: '#845ef7',
                nameAi: '#5f3dc4', nameUser: '#7950f2', title: '#5f3dc4'
            },
            'midnight': {
                logBg: '#0f0e17', logText: '#a7a9be',
                aiBg: '#1a1825', aiText: '#fffffe',
                userBg: '#7f5af0', userText: '#fffffe',
                thought: '#9d8cff', comm: '#2cb67d',
                nameAi: '#fffffe', nameUser: '#7f5af0', title: '#fffffe'
            },
            'graphite': {
                logBg: '#1c1917', logText: '#d6d3d1',
                aiBg: '#292524', aiText: '#fafaf9',
                userBg: '#c2410c', userText: '#ffffff',
                thought: '#fb923c', comm: '#4ade80',
                nameAi: '#fafaf9', nameUser: '#fb923c', title: '#fafaf9'
            },
            'discord': {
                logBg: '#313338', logText: '#dbdee1',
                aiBg: '#2b2d31', aiText: '#f2f3f5',
                userBg: '#5865f2', userText: '#ffffff',
                thought: '#949ba4', comm: '#23a559',
                nameAi: '#f2f3f5', nameUser: '#5865f2', title: '#f2f3f5'
            },
            'kakao': {
                logBg: '#b2c7d9', logText: '#1e1e1e',
                aiBg: '#ffffff', aiText: '#1e1e1e',
                userBg: '#fee500', userText: '#1e1e1e',
                thought: '#5a5a5a', comm: '#3182f6',
                nameAi: '#1e1e1e', nameUser: '#3182f6', title: '#1e1e1e'
            }
        };

        // ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì…ë ¥ë€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateColorInputs(colors) {
            document.getElementById('color-text').value = colors.logText;
            document.getElementById('color-text-text').value = colors.logText;
            document.getElementById('color-ai-bg').value = colors.aiBg;
            document.getElementById('color-ai-bg-text').value = colors.aiBg;
            document.getElementById('color-user-bg').value = colors.userBg;
            document.getElementById('color-user-bg-text').value = colors.userBg;
            document.getElementById('color-ai-text').value = colors.aiText;
            document.getElementById('color-ai-text-text').value = colors.aiText;
            document.getElementById('color-user-text').value = colors.userText;
            document.getElementById('color-user-text-text').value = colors.userText;
            document.getElementById('color-thought').value = colors.thought;
            document.getElementById('color-thought-text').value = colors.thought;
            document.getElementById('color-comm').value = colors.comm;
            document.getElementById('color-comm-text').value = colors.comm;
            document.getElementById('color-name-ai').value = colors.nameAi;
            document.getElementById('color-name-ai-text').value = colors.nameAi;
            document.getElementById('color-name-user').value = colors.nameUser;
            document.getElementById('color-name-user-text').value = colors.nameUser;
            document.getElementById('color-title').value = colors.title;
            document.getElementById('color-title-text').value = colors.title;
            
            // ë°°ê²½ìƒ‰ë„ ì—…ë°ì´íŠ¸
            document.getElementById('bg-solid-color').value = colors.logBg;
            document.getElementById('bg-solid-color-text').value = colors.logBg;
        }

        // ========== í…Œë§ˆ ì„ íƒ ==========
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const themeName = btn.dataset.theme;
                const colors = themeColors[themeName];
                
                if (colors) {
                    // ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì…ë ¥ë€ ì—…ë°ì´íŠ¸
                    updateColorInputs(colors);
                }
                
                const preview = document.getElementById('log-preview');
                // ëª¨ë“  í…Œë§ˆ í´ë˜ìŠ¤ ì œê±°
                preview.className = preview.className.replace(/theme-\S+/g, '').trim();
                
                // í”„ë ˆì„ í´ë˜ìŠ¤ëŠ” ìœ ì§€
                const frameClasses = preview.className.match(/frame-\S+/g) || [];
                preview.className = frameClasses.join(' ');
                
                // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼(ì»¤ìŠ¤í…€ ìƒ‰ìƒ) ì´ˆê¸°í™”
                preview.style.removeProperty('--log-bg');
                preview.style.removeProperty('--log-text');
                preview.style.removeProperty('--bubble-ai-bg');
                preview.style.removeProperty('--bubble-user-bg');
                preview.style.removeProperty('--bubble-ai-text');
                preview.style.removeProperty('--bubble-user-text');
                preview.style.removeProperty('--thought-color');
                preview.style.removeProperty('--comm-color');
                preview.style.removeProperty('--name-ai-color');
                preview.style.removeProperty('--name-user-color');
                preview.style.removeProperty('--title-color');
                preview.style.removeProperty('background');
                
                // ì„ íƒí•œ í…Œë§ˆ í´ë˜ìŠ¤ ì¶”ê°€ (ê¸°ë³¸ í¬í•¨)
                preview.classList.add('theme-' + themeName);
            });
        });

        // ========== ì •ê·œì‹ ê·œì¹™ ê´€ë¦¬ ==========
        function addRule() {
            const list = document.getElementById('rule-list');
            const item = document.createElement('div');
            item.className = 'rule-item';
            item.innerHTML = `
                <input type="text" placeholder="ì°¾ì„ ë‹¨ì–´" class="rule-find">
                <span style="color: var(--text-secondary);">â†’</span>
                <input type="text" placeholder="ë°”ê¿€ ë‹¨ì–´" class="rule-replace">
                <button class="btn-remove" onclick="removeRule(this)">Ã—</button>
            `;
            list.appendChild(item);
        }

        function removeRule(btn) {
            btn.parentElement.remove();
        }

        // ========== ìƒ‰ìƒ ì…ë ¥ ë™ê¸°í™” ==========
        const colorPairs = [
            ['color-text', 'color-text-text'],
            ['color-ai-bg', 'color-ai-bg-text'],
            ['color-user-bg', 'color-user-bg-text'],
            ['color-ai-text', 'color-ai-text-text'],
            ['color-user-text', 'color-user-text-text'],
            ['color-thought', 'color-thought-text'],
            ['color-comm', 'color-comm-text'],
            ['color-name-ai', 'color-name-ai-text'],
            ['color-name-user', 'color-name-user-text'],
            ['color-title', 'color-title-text'],
            ['bg-solid-color', 'bg-solid-color-text'],
            ['gradient-start', 'gradient-start-text'],
            ['gradient-end', 'gradient-end-text']
        ];

        colorPairs.forEach(([colorId, textId]) => {
            const colorInput = document.getElementById(colorId);
            const textInput = document.getElementById(textId);
            
            if (!colorInput || !textInput) return;
            
            colorInput.addEventListener('input', () => {
                textInput.value = colorInput.value;
                applyCustomColors();
            });
            
            textInput.addEventListener('input', () => {
                if (/^#[0-9A-Fa-f]{6}$/.test(textInput.value)) {
                    colorInput.value = textInput.value;
                    applyCustomColors();
                }
            });
        });

        // ========== ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì ìš© ==========
        function applyCustomColors() {
            const preview = document.getElementById('log-preview');
            preview.style.setProperty('--log-text', document.getElementById('color-text').value);
            preview.style.setProperty('--bubble-ai-bg', document.getElementById('color-ai-bg').value);
            preview.style.setProperty('--bubble-user-bg', document.getElementById('color-user-bg').value);
            preview.style.setProperty('--bubble-ai-text', document.getElementById('color-ai-text').value);
            preview.style.setProperty('--bubble-user-text', document.getElementById('color-user-text').value);
            preview.style.setProperty('--thought-color', document.getElementById('color-thought').value);
            preview.style.setProperty('--comm-color', document.getElementById('color-comm').value);
            preview.style.setProperty('--name-ai-color', document.getElementById('color-name-ai').value);
            preview.style.setProperty('--name-user-color', document.getElementById('color-name-user').value);
            preview.style.setProperty('--title-color', document.getElementById('color-title').value);
            
            // í…Œë§ˆ ë²„íŠ¼ ì„ íƒ í•´ì œ
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
        }

        // ========== ì»¤ìŠ¤í…€ í…Œë§ˆ ì €ì¥ ==========
        function saveCustomTheme() {
            const name = prompt('í…Œë§ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;
            
            const theme = {
                name: name,
                colors: {
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                }
            };
            
            let savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            savedThemes.push(theme);
            localStorage.setItem('customThemes', JSON.stringify(savedThemes));
            renderSavedThemes();
        }

        function renderSavedThemes() {
            const container = document.getElementById('saved-themes');
            const savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            
            if (savedThemes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<div style="font-size:12px; color:var(--text-secondary); margin-bottom:8px;">ì €ì¥ëœ í…Œë§ˆ:</div>' +
                savedThemes.map((t, i) => `
                    <div style="display:flex; gap:8px; margin-bottom:6px;">
                        <button class="btn btn-secondary" style="flex:1; padding:8px;" onclick="loadCustomTheme(${i})">${t.name}</button>
                        <button style="padding:8px 12px; background:#e03131; color:white; border:none; border-radius:8px; cursor:pointer;" onclick="deleteCustomTheme(${i})">Ã—</button>
                    </div>
                `).join('');
        }

        function loadCustomTheme(index) {
            const savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            const theme = savedThemes[index];
            if (!theme) return;
            
            document.getElementById('color-text').value = theme.colors.text;
            document.getElementById('color-text-text').value = theme.colors.text;
            document.getElementById('color-ai-bg').value = theme.colors.aiBg;
            document.getElementById('color-ai-bg-text').value = theme.colors.aiBg;
            document.getElementById('color-user-bg').value = theme.colors.userBg;
            document.getElementById('color-user-bg-text').value = theme.colors.userBg;
            document.getElementById('color-ai-text').value = theme.colors.aiText || '#1d2129';
            document.getElementById('color-ai-text-text').value = theme.colors.aiText || '#1d2129';
            document.getElementById('color-user-text').value = theme.colors.userText || '#ffffff';
            document.getElementById('color-user-text-text').value = theme.colors.userText || '#ffffff';
            document.getElementById('color-thought').value = theme.colors.thought;
            document.getElementById('color-thought-text').value = theme.colors.thought;
            document.getElementById('color-comm').value = theme.colors.comm;
            document.getElementById('color-comm-text').value = theme.colors.comm;
            document.getElementById('color-name-ai').value = theme.colors.nameAi;
            document.getElementById('color-name-ai-text').value = theme.colors.nameAi;
            document.getElementById('color-name-user').value = theme.colors.nameUser;
            document.getElementById('color-name-user-text').value = theme.colors.nameUser;
            document.getElementById('color-title').value = theme.colors.title;
            document.getElementById('color-title-text').value = theme.colors.title;
            
            applyCustomColors();
        }

        function deleteCustomTheme(index) {
            let savedThemes = JSON.parse(localStorage.getItem('customThemes') || '[]');
            savedThemes.splice(index, 1);
            localStorage.setItem('customThemes', JSON.stringify(savedThemes));
            renderSavedThemes();
        }

        // ========== ìŠ¤íƒ€ì¼ ì ìš© ==========
        function applyStyles() {
            const preview = document.getElementById('log-preview');
            preview.style.setProperty('--log-width', document.getElementById('style-width').value + 'px');
            preview.style.setProperty('--log-radius', document.getElementById('style-radius').value + 'px');
            preview.style.setProperty('--log-font-size', document.getElementById('style-font-size').value + 'px');
            preview.style.setProperty('--log-line-height', document.getElementById('style-line-height').value);
            
            preview.style.width = document.getElementById('style-width').value + 'px';
            preview.style.borderRadius = document.getElementById('style-radius').value + 'px';
            preview.style.fontSize = document.getElementById('style-font-size').value + 'px';
            preview.style.lineHeight = document.getElementById('style-line-height').value;
        }

        // ========== ì´ë¯¸ì§€ ì—…ë¡œë“œ ==========
        let uploadedImages = []; // {data: base64, blockNumber: number}
        
        document.getElementById('image-file-input').addEventListener('change', function(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            Array.from(files).forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`íŒŒì¼ "${file.name}"ì˜ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    // ë‹¤ìŒ ë¸”ë¡ ë²ˆí˜¸ ìë™ í• ë‹¹ (ê¸°ì¡´ ì´ë¯¸ì§€ ì¤‘ ê°€ì¥ í° ë²ˆí˜¸ + 1, ë˜ëŠ” 1)
                    const nextBlockNum = uploadedImages.length > 0 
                        ? Math.max(...uploadedImages.map(img => img.blockNumber)) + 1 
                        : 1;
                    uploadedImages.push({
                        data: event.target.result,
                        blockNumber: nextBlockNum,
                        name: file.name
                    });
                    renderImageList();
                    generateLog();
                };
                reader.readAsDataURL(file);
            });
            
            // ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
            e.target.value = '';
        });
        
        function renderImageList() {
            const container = document.getElementById('image-list');
            if (uploadedImages.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            let html = '<div style="display:flex; flex-direction:column; gap:8px;">';
            uploadedImages.forEach((img, index) => {
                html += `
                    <div class="image-item" style="display:flex; align-items:center; gap:8px; padding:8px; background:var(--input-bg); border-radius:8px; border:1px solid var(--border-color);">
                        <img src="${img.data}" style="width:50px; height:50px; object-fit:cover; border-radius:6px; flex-shrink:0;">
                        <div style="flex:1; min-width:0;">
                            <div style="font-size:11px; color:var(--text-secondary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(img.name)}</div>
                            <div style="display:flex; align-items:center; gap:4px; margin-top:4px;">
                                <span style="font-size:11px; color:var(--text-secondary);">ë¸”ë¡</span>
                                <input type="number" value="${img.blockNumber}" min="0" 
                                    onchange="updateImageBlockNumber(${index}, this.value)"
                                    style="width:50px; padding:4px 6px; font-size:12px; border:1px solid var(--border-color); border-radius:4px; background:var(--bg-color); color:var(--text-color);">
                                <span style="font-size:10px; color:var(--text-secondary);">ë²ˆ ì•ì— ì‚½ì…</span>
                            </div>
                        </div>
                        <button onclick="removeImage(${index})" style="padding:4px 8px; background:#e03131; color:white; border:none; border-radius:4px; cursor:pointer; font-size:12px;">âœ•</button>
                    </div>`;
            });
            html += '</div>';
            html += '<div style="font-size:10px; color:var(--text-secondary); margin-top:6px;">ğŸ’¡ 0ë²ˆ = ì œëª© ë°”ë¡œ ì•„ë˜, 1ë²ˆ = ì²« ë²ˆì§¸ ë¸”ë¡ ì•</div>';
            container.innerHTML = html;
        }
        
        function updateImageBlockNumber(index, value) {
            const num = parseInt(value) || 0;
            uploadedImages[index].blockNumber = num;
            generateLog();
        }
        
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            renderImageList();
            generateLog();
        }
        
        function clearAllImages() {
            uploadedImages = [];
            renderImageList();
            generateLog();
        }

        // ========== AIëª¨ë¸/ë²ˆì—­ ì„ íƒì‹œ ì…ë ¥ì°½ì— ë°˜ì˜ ==========
        document.getElementById('ai-model').addEventListener('change', function() {
            if (this.value) {
                document.getElementById('ai-model-input').value = this.value;
            }
        });
        
        document.getElementById('translation').addEventListener('change', function() {
            if (this.value) {
                document.getElementById('translation-input').value = this.value;
            }
        });

        // ========== ë°°ê²½ ì„¤ì • ==========
        document.getElementById('bg-type').addEventListener('change', function() {
            const solidOptions = document.getElementById('bg-solid-options');
            const gradientOptions = document.getElementById('bg-gradient-options');
            
            if (this.value === 'solid') {
                solidOptions.style.display = 'block';
                gradientOptions.style.display = 'none';
            } else {
                solidOptions.style.display = 'none';
                gradientOptions.style.display = 'block';
            }
        });
        
        // ë°°ê²½ ë‹¨ìƒ‰ ìƒ‰ìƒ ë™ê¸°í™”
        document.getElementById('bg-solid-color').addEventListener('input', function() {
            document.getElementById('bg-solid-color-text').value = this.value;
        });
        document.getElementById('bg-solid-color-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('bg-solid-color').value = this.value;
            }
        });
        
        // ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ë™ê¸°í™”
        document.getElementById('gradient-start').addEventListener('input', function() {
            document.getElementById('gradient-start-text').value = this.value;
        });
        document.getElementById('gradient-start-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('gradient-start').value = this.value;
            }
        });
        document.getElementById('gradient-end').addEventListener('input', function() {
            document.getElementById('gradient-end-text').value = this.value;
        });
        document.getElementById('gradient-end-text').addEventListener('input', function() {
            if (/^#[0-9A-Fa-f]{6}$/.test(this.value)) {
                document.getElementById('gradient-end').value = this.value;
            }
        });
        
        // ê·¸ë¼ë°ì´ì…˜ í”„ë¦¬ì…‹ ì„ íƒì‹œ ìƒ‰ìƒ ì¶”ì¶œ
        document.getElementById('gradient-select').addEventListener('change', function() {
            if (this.value !== 'custom') {
                // í”„ë¦¬ì…‹ì—ì„œ ìƒ‰ìƒ ì¶”ì¶œ
                const match = this.value.match(/#([0-9A-Fa-f]{6})/g);
                if (match && match.length >= 2) {
                    document.getElementById('gradient-start').value = match[0];
                    document.getElementById('gradient-start-text').value = match[0];
                    document.getElementById('gradient-end').value = match[1];
                    document.getElementById('gradient-end-text').value = match[1];
                }
            }
        });
        
        function applyBackground() {
            const preview = document.getElementById('log-preview');
            const bgType = document.getElementById('bg-type').value;
            
            if (bgType === 'solid') {
                const color = document.getElementById('bg-solid-color').value;
                preview.style.background = color;
                preview.style.setProperty('--log-bg', color);
            } else {
                const start = document.getElementById('gradient-start').value;
                const end = document.getElementById('gradient-end').value;
                const angle = document.getElementById('gradient-angle').value;
                const gradient = `linear-gradient(${angle}deg, ${start} 0%, ${end} 100%)`;
                preview.style.background = gradient;
            }
        }

        // ========== ì™¸ê³½ í…Œë§ˆ ì„ íƒ ==========
        document.getElementById('frame-select').addEventListener('change', function() {
            const preview = document.getElementById('log-preview');
            // ëª¨ë“  í”„ë ˆì„ í´ë˜ìŠ¤ ì œê±°
            preview.classList.remove('frame-letter', 'frame-diary', 'frame-memo', 'frame-gold', 'frame-ornate', 'frame-check', 'frame-tape', 'frame-vintage', 'frame-polaroid');
            
            if (this.value !== 'none') {
                preview.classList.add('frame-' + this.value);
            }
        });

        // ========== í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ==========
        function savePreset() {
            const name = prompt('í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!name) return;
            
            const preset = {
                name: name,
                colors: {
                    bg: document.getElementById('bg-solid-color').value,
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                },
                bgType: document.getElementById('bg-type').value,
                gradient: document.getElementById('gradient-select').value,
                gradientStart: document.getElementById('gradient-start').value,
                gradientEnd: document.getElementById('gradient-end').value,
                gradientAngle: document.getElementById('gradient-angle').value,
                frame: document.getElementById('frame-select').value,
                style: {
                    width: document.getElementById('style-width').value,
                    radius: document.getElementById('style-radius').value,
                    fontSize: document.getElementById('style-font-size').value,
                    lineHeight: document.getElementById('style-line-height').value
                }
            };
            
            let savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            savedPresets.push(preset);
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderSavedPresets();
        }

        function renderSavedPresets() {
            const container = document.getElementById('saved-presets');
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            
            if (savedPresets.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = '<div style="font-size:12px; color:var(--text-secondary); margin-bottom:8px;">ì €ì¥ëœ í”„ë¦¬ì…‹:</div>' +
                savedPresets.map((p, i) => `
                    <div style="display:flex; gap:8px; margin-bottom:6px;">
                        <button class="btn btn-secondary" style="flex:1; padding:8px;" onclick="loadPreset(${i})">${p.name}</button>
                        <button style="padding:8px 12px; background:#e03131; color:white; border:none; border-radius:8px; cursor:pointer;" onclick="deletePreset(${i})">Ã—</button>
                    </div>
                `).join('');
        }

        function loadPreset(index) {
            const savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            const preset = savedPresets[index];
            if (!preset) return;
            
            // ë°°ê²½ ìƒ‰ìƒ ì ìš©
            if (preset.colors.bg) {
                document.getElementById('bg-solid-color').value = preset.colors.bg;
                document.getElementById('bg-solid-color-text').value = preset.colors.bg;
            }
            if (preset.bgType) {
                document.getElementById('bg-type').value = preset.bgType;
                document.getElementById('bg-type').dispatchEvent(new Event('change'));
            }
            
            // ì»¤ìŠ¤í…€ ìƒ‰ìƒ ì ìš©
            document.getElementById('color-text').value = preset.colors.text;
            document.getElementById('color-text-text').value = preset.colors.text;
            document.getElementById('color-ai-bg').value = preset.colors.aiBg;
            document.getElementById('color-ai-bg-text').value = preset.colors.aiBg;
            document.getElementById('color-user-bg').value = preset.colors.userBg;
            document.getElementById('color-user-bg-text').value = preset.colors.userBg;
            document.getElementById('color-ai-text').value = preset.colors.aiText || '#1d2129';
            document.getElementById('color-ai-text-text').value = preset.colors.aiText || '#1d2129';
            document.getElementById('color-user-text').value = preset.colors.userText || '#ffffff';
            document.getElementById('color-user-text-text').value = preset.colors.userText || '#ffffff';
            document.getElementById('color-thought').value = preset.colors.thought;
            document.getElementById('color-thought-text').value = preset.colors.thought;
            document.getElementById('color-comm').value = preset.colors.comm;
            document.getElementById('color-comm-text').value = preset.colors.comm;
            document.getElementById('color-name-ai').value = preset.colors.nameAi;
            document.getElementById('color-name-ai-text').value = preset.colors.nameAi;
            document.getElementById('color-name-user').value = preset.colors.nameUser;
            document.getElementById('color-name-user-text').value = preset.colors.nameUser;
            document.getElementById('color-title').value = preset.colors.title;
            document.getElementById('color-title-text').value = preset.colors.title;
            
            // ê·¸ë¼ë°ì´ì…˜
            document.getElementById('gradient-select').value = preset.gradient || 'custom';
            if (preset.gradientStart) document.getElementById('gradient-start').value = preset.gradientStart;
            if (preset.gradientEnd) document.getElementById('gradient-end').value = preset.gradientEnd;
            if (preset.gradientAngle) document.getElementById('gradient-angle').value = preset.gradientAngle;
            
            // í”„ë ˆì„
            document.getElementById('frame-select').value = preset.frame || 'none';
            
            // ìŠ¤íƒ€ì¼
            if (preset.style) {
                document.getElementById('style-width').value = preset.style.width;
                document.getElementById('style-radius').value = preset.style.radius;
                document.getElementById('style-font-size').value = preset.style.fontSize;
                document.getElementById('style-line-height').value = preset.style.lineHeight;
            }
            
            applyCustomColors();
            applyBackground();
            applyStyles();
            document.getElementById('gradient-select').dispatchEvent(new Event('change'));
            document.getElementById('frame-select').dispatchEvent(new Event('change'));
        }

        function deletePreset(index) {
            let savedPresets = JSON.parse(localStorage.getItem('logPresets') || '[]');
            savedPresets.splice(index, 1);
            localStorage.setItem('logPresets', JSON.stringify(savedPresets));
            renderSavedPresets();
        }

        function exportPreset() {
            const preset = {
                colors: {
                    bg: document.getElementById('bg-solid-color').value,
                    text: document.getElementById('color-text').value,
                    aiBg: document.getElementById('color-ai-bg').value,
                    userBg: document.getElementById('color-user-bg').value,
                    aiText: document.getElementById('color-ai-text').value,
                    userText: document.getElementById('color-user-text').value,
                    thought: document.getElementById('color-thought').value,
                    comm: document.getElementById('color-comm').value,
                    nameAi: document.getElementById('color-name-ai').value,
                    nameUser: document.getElementById('color-name-user').value,
                    title: document.getElementById('color-title').value
                },
                bgType: document.getElementById('bg-type').value,
                gradient: document.getElementById('gradient-select').value,
                gradientStart: document.getElementById('gradient-start').value,
                gradientEnd: document.getElementById('gradient-end').value,
                gradientAngle: document.getElementById('gradient-angle').value,
                frame: document.getElementById('frame-select').value,
                style: {
                    width: document.getElementById('style-width').value,
                    radius: document.getElementById('style-radius').value,
                    fontSize: document.getElementById('style-font-size').value,
                    lineHeight: document.getElementById('style-line-height').value
                }
            };
            
            const blob = new Blob([JSON.stringify(preset, null, 2)], {type: 'application/json'});
            const link = document.createElement('a');
            link.download = 'logmaker-preset.json';
            link.href = URL.createObjectURL(blob);
            link.click();
        }

        document.getElementById('import-preset').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const preset = JSON.parse(event.target.result);
                    
                    // ë°°ê²½ ìƒ‰ìƒ ì ìš©
                    if (preset.colors) {
                        document.getElementById('bg-solid-color').value = preset.colors.bg || '#ffffff';
                        document.getElementById('bg-solid-color-text').value = preset.colors.bg || '#ffffff';
                        document.getElementById('color-text').value = preset.colors.text || '#1d2129';
                        document.getElementById('color-text-text').value = preset.colors.text || '#1d2129';
                        document.getElementById('color-ai-bg').value = preset.colors.aiBg || '#f1f3f5';
                        document.getElementById('color-ai-bg-text').value = preset.colors.aiBg || '#f1f3f5';
                        document.getElementById('color-user-bg').value = preset.colors.userBg || '#339af0';
                        document.getElementById('color-user-bg-text').value = preset.colors.userBg || '#339af0';
                        document.getElementById('color-ai-text').value = preset.colors.aiText || '#1d2129';
                        document.getElementById('color-ai-text-text').value = preset.colors.aiText || '#1d2129';
                        document.getElementById('color-user-text').value = preset.colors.userText || '#ffffff';
                        document.getElementById('color-user-text-text').value = preset.colors.userText || '#ffffff';
                        document.getElementById('color-thought').value = preset.colors.thought || '#748ffc';
                        document.getElementById('color-thought-text').value = preset.colors.thought || '#748ffc';
                        document.getElementById('color-comm').value = preset.colors.comm || '#20c997';
                        document.getElementById('color-comm-text').value = preset.colors.comm || '#20c997';
                        document.getElementById('color-name-ai').value = preset.colors.nameAi || '#495057';
                        document.getElementById('color-name-ai-text').value = preset.colors.nameAi || '#495057';
                        document.getElementById('color-name-user').value = preset.colors.nameUser || '#339af0';
                        document.getElementById('color-name-user-text').value = preset.colors.nameUser || '#339af0';
                        document.getElementById('color-title').value = preset.colors.title || '#1d2129';
                        document.getElementById('color-title-text').value = preset.colors.title || '#1d2129';
                    }
                    
                    // ë°°ê²½ íƒ€ì…
                    if (preset.bgType) {
                        document.getElementById('bg-type').value = preset.bgType;
                        document.getElementById('bg-type').dispatchEvent(new Event('change'));
                    }
                    
                    if (preset.gradient) document.getElementById('gradient-select').value = preset.gradient;
                    if (preset.gradientStart) document.getElementById('gradient-start').value = preset.gradientStart;
                    if (preset.gradientEnd) document.getElementById('gradient-end').value = preset.gradientEnd;
                    if (preset.gradientAngle) document.getElementById('gradient-angle').value = preset.gradientAngle;
                    if (preset.frame) document.getElementById('frame-select').value = preset.frame;
                    
                    if (preset.style) {
                        document.getElementById('style-width').value = preset.style.width || 1000;
                        document.getElementById('style-radius').value = preset.style.radius || 16;
                        document.getElementById('style-font-size').value = preset.style.fontSize || 15;
                        document.getElementById('style-line-height').value = preset.style.lineHeight || 1.7;
                    }
                    
                    applyCustomColors();
                    applyBackground();
                    applyStyles();
                    document.getElementById('gradient-select').dispatchEvent(new Event('change'));
                    document.getElementById('frame-select').dispatchEvent(new Event('change'));
                    
                    alert('í”„ë¦¬ì…‹ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                } catch (e) {
                    alert('í”„ë¦¬ì…‹ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
        });

        // ========== ë¡œê·¸ ë¸”ë¡ ê´€ë¦¬ ==========
        let blockIdCounter = 1;
        
        function addLogBlock() {
            blockIdCounter++;
            const container = document.getElementById('log-blocks-container');
            const block = document.createElement('div');
            block.className = 'log-block';
            block.dataset.blockId = blockIdCounter;
            block.innerHTML = `
                <div class="log-block-header" onclick="toggleBlock(this)">
                    <div class="log-block-title">
                        <span>ğŸ“</span>
                        <input type="text" value="ë¸”ë¡ ${blockIdCounter}" onclick="event.stopPropagation()" onchange="updateBlockTitle(this)">
                    </div>
                    <div class="log-block-actions">
                        <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, -1)" title="ìœ„ë¡œ">â–²</button>
                        <button class="btn-move" onclick="event.stopPropagation(); moveBlock(this, 1)" title="ì•„ë˜ë¡œ">â–¼</button>
                        <button class="btn-toggle" title="ì ‘ê¸°/í¼ì¹˜ê¸°">â–¼</button>
                        <button class="btn-delete" onclick="event.stopPropagation(); deleteBlock(this)" title="ì‚­ì œ">Ã—</button>
                    </div>
                </div>
                <div class="log-block-content">
                    <textarea class="log-block-input" placeholder='AI: "ëŒ€ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”"'></textarea>
                </div>
            `;
            container.appendChild(block);
            
            // ìƒˆ ë¸”ë¡ì— ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì´ë²¤íŠ¸ ì¶”ê°€
            const textarea = block.querySelector('.log-block-input');
            textarea.addEventListener('input', () => {
                clearTimeout(window.inputTimeout);
                window.inputTimeout = setTimeout(generateLog, 300);
            });
        }
        
        function deleteBlock(btn) {
            const block = btn.closest('.log-block');
            const container = document.getElementById('log-blocks-container');
            
            // ìµœì†Œ 1ê°œ ë¸”ë¡ì€ ìœ ì§€
            if (container.querySelectorAll('.log-block').length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ë¸”ë¡ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì´ ë¸”ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                block.remove();
                generateLog();
            }
        }
        
        function moveBlock(btn, direction) {
            const block = btn.closest('.log-block');
            const container = document.getElementById('log-blocks-container');
            const blocks = Array.from(container.querySelectorAll('.log-block'));
            const index = blocks.indexOf(block);
            
            if (direction === -1 && index > 0) {
                // ìœ„ë¡œ ì´ë™
                container.insertBefore(block, blocks[index - 1]);
            } else if (direction === 1 && index < blocks.length - 1) {
                // ì•„ë˜ë¡œ ì´ë™
                container.insertBefore(blocks[index + 1], block);
            }
            
            generateLog();
        }
        
        function toggleBlock(header) {
            const content = header.nextElementSibling;
            const toggleBtn = header.querySelector('.btn-toggle');
            
            content.classList.toggle('collapsed');
            toggleBtn.textContent = content.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
        }
        
        function updateBlockTitle(input) {
            // ì œëª© ë³€ê²½ ì‹œ ë³„ë„ ë™ì‘ í•„ìš” ì—†ìŒ
        }
        
        // ========== ë¡œê·¸ íŒŒì‹± ë° ìƒì„± ==========
        function generateLog() {
            // ê° ë¸”ë¡ì˜ ë‚´ìš©ì„ ê°œë³„ì ìœ¼ë¡œ ìˆ˜ì§‘
            const blockElements = document.querySelectorAll('.log-block-input');
            const blockContents = Array.from(blockElements).map(textarea => textarea.value);
            
            // ì •ê·œì‹ ì¹˜í™˜ì„ ê° ë¸”ë¡ì— ì ìš©
            const processedBlocks = blockContents.map(blockText => {
                document.querySelectorAll('.rule-item').forEach(item => {
                    const find = item.querySelector('.rule-find').value;
                    const replace = item.querySelector('.rule-replace').value;
                    if (find) {
                        try {
                            const regex = new RegExp(find, 'g');
                            blockText = blockText.replace(regex, replace);
                        } catch (e) {
                            console.error('ì •ê·œì‹ ì˜¤ë¥˜:', e);
                        }
                    }
                });
                return blockText;
            });

            const preview = document.getElementById('log-preview');
            let html = '';

            // ì œëª© ì¶”ê°€
            const title = document.getElementById('log-title').value;
            const subtitle = document.getElementById('log-subtitle').value;
            const aiModel = document.getElementById('ai-model-input').value;
            const promptName = document.getElementById('prompt-name').value;
            const translation = document.getElementById('translation-input').value;
            const charLink = document.getElementById('char-link').value;
            
            if (title || subtitle || aiModel || promptName || translation || charLink) {
                html += '<div class="log-title">';
                if (title) html += `<h2>${escapeHtml(title)}</h2>`;
                if (subtitle) html += `<p>${escapeHtml(subtitle)}</p>`;
                
                // ë©”íƒ€ ì •ë³´
                const metaItems = [];
                if (aiModel) metaItems.push(`ğŸ¤– ${escapeHtml(aiModel)}`);
                if (promptName) metaItems.push(`ğŸ“ ${escapeHtml(promptName)}`);
                if (translation) metaItems.push(`ğŸŒ ${escapeHtml(translation)}`);
                if (charLink) metaItems.push(`<a href="${escapeHtml(charLink)}" target="_blank">ğŸ”— ìºë¦­í„° ë§í¬</a>`);
                
                if (metaItems.length > 0) {
                    html += '<div class="log-meta">';
                    metaItems.forEach(item => {
                        html += `<span class="log-meta-item">${item}</span>`;
                    });
                    html += '</div>';
                }
                html += '</div>';
            }

            // ë¸”ë¡ ë²ˆí˜¸ 0ì— í• ë‹¹ëœ ì´ë¯¸ì§€ (ì œëª© ë°”ë¡œ ì•„ë˜)
            const headerImages = uploadedImages.filter(img => img.blockNumber === 0);
            headerImages.forEach(img => {
                html += `<div class="log-image"><img src="${img.data}" alt="Image"></div>`;
            });

            // ìºë¦­í„° ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const aiName = document.getElementById('name-ai').value || 'AI';
            const userName = document.getElementById('name-user').value || 'USER';

            // ê° ë¸”ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ ì²˜ë¦¬
            processedBlocks.forEach((blockText, blockIndex) => {
                const blockNumber = blockIndex + 1; // 1-based ë¸”ë¡ ë²ˆí˜¸
                
                // ì´ ë¸”ë¡ ì•ì— ì‚½ì…í•  ì´ë¯¸ì§€ë“¤
                const blockImages = uploadedImages.filter(img => img.blockNumber === blockNumber);
                blockImages.forEach(img => {
                    html += `<div class="log-image"><img src="${img.data}" alt="Image"></div>`;
                });
                
                // ë¸”ë¡ ì‚¬ì´ êµ¬ë¶„ì„  (ì²« ë²ˆì§¸ ë¸”ë¡ì´ ì•„ë‹Œ ê²½ìš°)
                if (blockIndex > 0) {
                    html += '<div class="divider"></div>';
                }
                
                const lines = blockText.split('\n');
                let currentSpeaker = null;
                let currentBubbles = [];

                function flushBubbles() {
                    if (currentSpeaker && currentBubbles.length > 0) {
                        const speakerClass = currentSpeaker === 'AI' ? 'ai' : 'user';
                        const displayName = currentSpeaker === 'AI' ? aiName : userName;
                        
                        html += `<div class="chat-block ${speakerClass}">`;
                        html += `<div class="speaker-name">${escapeHtml(displayName)}</div>`;
                        html += '<div class="bubbles">';
                        currentBubbles.forEach(bubble => {
                            html += bubble;
                        });
                        html += '</div></div>';
                        
                        currentBubbles = [];
                    }
                }

                lines.forEach(line => {
                    line = line.trim();
                    if (!line) return;

                    // êµ¬ë¶„ì„ 
                    if (line === '---' || line === '***') {
                        flushBubbles();
                        currentSpeaker = null;
                        html += '<div class="divider"></div>';
                        return;
                    }

                    // ë‚˜ë ˆì´ì…˜ (- ë˜ëŠ” * ë¡œ ì‹œì‘)
                    if (line.startsWith('-') || (line.startsWith('*') && !line.endsWith('*'))) {
                        flushBubbles();
                        currentSpeaker = null;
                        const narrationText = line.substring(1).trim();
                        html += `<div class="narration">${processMarkdown(narrationText)}</div>`;
                        return;
                    }

                    // AI ë˜ëŠ” USER ëŒ€í™”
                    const match = line.match(/^(AI|USER)\s*:\s*(.+)$/i);
                    if (match) {
                        const speaker = match[1].toUpperCase();
                        let content = match[2].trim();

                        // ìƒˆë¡œìš´ í™”ìë©´ ì´ì „ ë§í’ì„ ë“¤ ì¶œë ¥
                        if (speaker !== currentSpeaker) {
                            flushBubbles();
                            currentSpeaker = speaker;
                        }

                        // í†µì‹  ë©”ì‹œì§€ (> ë¡œ ì‹œì‘)
                        if (content.startsWith('>')) {
                            content = content.substring(1).trim();
                            currentBubbles.push(`<div class="bubble comm">${processMarkdown(content)}</div>`);
                        }
                        // ì†ì‚­ì„ ((...) ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                        else if (content.startsWith('((') && content.endsWith('))')) {
                            content = content.slice(2, -2).trim();
                            currentBubbles.push(`<div class="bubble whisper">${processMarkdown(content)}</div>`);
                        }
                        // ì™¸ì¹¨ (! ë¡œ ì‹œì‘)
                        else if (content.startsWith('!')) {
                            content = content.substring(1).trim();
                            currentBubbles.push(`<div class="bubble shout">${processMarkdown(content)}</div>`);
                        }
                        // ìƒê° ('...' ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                        else if ((content.startsWith("'") && content.endsWith("'")) || 
                                 (content.startsWith("'") && content.endsWith("'"))) {
                            content = content.slice(1, -1);
                            currentBubbles.push(`<div class="bubble thought">${processMarkdown(content)}</div>`);
                        }
                        // ëŒ€ì‚¬ ("..." ë¡œ ê°ì‹¸ì§„ ê²½ìš°)
                        else if ((content.startsWith('"') && content.endsWith('"')) ||
                                (content.startsWith('"') && content.endsWith('"'))) {
                            content = content.slice(1, -1);
                            currentBubbles.push(`<div class="bubble dialogue">${processMarkdown(content)}</div>`);
                        }
                        // ê·¸ ì™¸ (í–‰ë™/ë¬˜ì‚¬ - ì•„ë¬´ í‘œì‹œ ì—†ì´ ê·¸ëƒ¥ ì“°ê¸°)
                        else {
                            currentBubbles.push(`<div class="bubble dialogue">${processMarkdown(content)}</div>`);
                        }
                        return;
                    }

                    // ê·¸ ì™¸ ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” ë‚˜ë ˆì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬
                    flushBubbles();
                    currentSpeaker = null;
                    html += `<div class="narration">${processMarkdown(line)}</div>`;
                });

                // ë‚¨ì€ ë§í’ì„  ì¶œë ¥
                flushBubbles();
            });

            preview.innerHTML = html || '<div style="text-align: center; color: var(--text-secondary); padding: 60px;">ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
        function processMarkdown(text) {
            let result = escapeHtml(text);
            
            // **êµµê²Œ**
            result = result.replace(/\*\*(.+?)\*\*/g, '<span class="md-bold">$1</span>');
            
            // *ê¸°ìš¸ì„* (ë‹¨, **ëŠ” ì œì™¸)
            result = result.replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<span class="md-italic">$1</span>');
            
            // ^í•˜ì´ë¼ì´íŠ¸^
            result = result.replace(/\^(.+?)\^/g, '<span class="md-highlight">$1</span>');
            
            // $ê°•ì¡°$
            result = result.replace(/\$(.+?)\$/g, '<span class="md-emphasis">$1</span>');
            
            // __ë°‘ì¤„__
            result = result.replace(/__(.+?)__/g, '<span class="md-underline">$1</span>');
            
            // ~~ì·¨ì†Œ~~
            result = result.replace(/~~(.+?)~~/g, '<span class="md-strike">$1</span>');
            
            return result;
        }

        // ========== ì´ë¯¸ì§€ ì €ì¥ ==========
        function saveImage() {
            const preview = document.getElementById('log-preview');
            html2canvas(preview, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'log-' + new Date().toISOString().slice(0, 10) + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // ========== HTML ë³µì‚¬ ==========
        function copyHTML() {
            const preview = document.getElementById('log-preview');
            navigator.clipboard.writeText(preview.innerHTML).then(() => {
                alert('HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
        
        // ========== ë¯¸ë¦¬ë³´ê¸°/HTML í† ê¸€ ==========
        let isHtmlMode = false;
        
        function togglePreviewMode() {
            isHtmlMode = !isHtmlMode;
            const wrapper = document.querySelector('.preview-wrapper');
            const toggleBtn = document.querySelector('.preview-toggle');
            const htmlView = document.getElementById('html-code-view');
            const preview = document.getElementById('log-preview');
            
            if (isHtmlMode) {
                wrapper.classList.add('html-mode');
                toggleBtn.classList.add('active');
                toggleBtn.innerHTML = 'ğŸ’» HTML ì½”ë“œ';
                // HTML ì½”ë“œ ì—…ë°ì´íŠ¸
                updateHtmlView();
            } else {
                wrapper.classList.remove('html-mode');
                toggleBtn.classList.remove('active');
                toggleBtn.innerHTML = 'ğŸ“„ ë¯¸ë¦¬ë³´ê¸°';
            }
        }
        
        function updateHtmlView() {
            const preview = document.getElementById('log-preview');
            const htmlView = document.getElementById('html-code-view');
            // HTMLì„ ì´ì¨ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬í•˜ì—¬ í‘œì‹œ
            const escaped = preview.innerHTML
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            htmlView.innerHTML = escaped;
        }

        // ========== ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ==========
        // ì²« ë²ˆì§¸ ë¸”ë¡ì˜ textareaì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.log-block-input').forEach(textarea => {
            textarea.addEventListener('input', () => {
                // ë””ë°”ìš´ìŠ¤ ì²˜ë¦¬
                clearTimeout(window.inputTimeout);
                window.inputTimeout = setTimeout(generateLog, 300);
            });
        });

        // ì´ˆê¸° ì˜ˆì œ (ì²« ë²ˆì§¸ ë¸”ë¡ì— ì„¤ì •)
        document.querySelector('.log-block-input').value = `AI: "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."
USER: "ë°˜ê°€ì›Œìš”. ì˜ ë¶€íƒí•´ìš”."
AI: 'ì´ ì‚¬ëŒì€ **ì¢‹ì€ ì‚¬ëŒ** ê°™ì•„ ë³´ì—¬...'
- ì ì‹œ ì¹¨ë¬µì´ í˜ë €ë‹¤.
AI: "ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
USER: 'ë­˜ ë¬¼ì–´ë³´ì§€?'
---
AI: > ì›ê²© í†µì‹ ì´ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.
USER: > ìˆ˜ì‹  í™•ì¸í–ˆìŠµë‹ˆë‹¤.
AI: ((ì¡°ìš©íˆ ì†ì‚­ì…ë‹ˆë‹¤...))
USER: ! ê¹œì§ ë†€ëì–´!
AI: ë¹™ê·¸ë ˆ ì›ƒëŠ”ë‹¤`;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒì„±
        window.onload = function() {
            applyStyles(); // ìŠ¤íƒ€ì¼ ë¨¼ì € ì ìš©
            generateLog();
            renderSavedThemes();
            renderSavedPresets();
            
            // ì €ì¥ëœ ëª¨ë“œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const savedMode = localStorage.getItem('logmaker-mode');
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                document.querySelector('.mode-toggle').textContent = 'â˜€ï¸';
            }
        };
        
        // ========== ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ í† ê¸€ ==========
        function toggleDarkMode() {
            const body = document.body;
            const btn = document.querySelector('.mode-toggle');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                btn.textContent = 'â˜€ï¸';
                localStorage.setItem('logmaker-mode', 'light');
            } else {
                btn.textContent = 'ğŸŒ™';
                localStorage.setItem('logmaker-mode', 'dark');
            }
        }
    </script>
</body>
</html>
